<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="generator" content="ApiGen 2.8.0">
	<meta name="robots" content="noindex">

	<title>File modules/Process/ProcessPageEditImageSelect/ProcessPageEditImageSelect.module | ProcessWire 3 API (master branch)</title>

	<script type="text/javascript" src="resources/combined.js?3667647988"></script>
	<script type="text/javascript" src="elementlist.js?4161422296"></script>
	<link rel="stylesheet" type="text/css" media="all" href="resources/style.css?2921310712">

</head>

<body>
<div id="left">
	<div id="menu">
		<a href="index.html" title="Overview">
			<span>Overview version 3.0.123 master</span>
		</a>


		<div id="groups">
			<h3>Namespaces</h3>
			<ul>
				<li><a href="namespace-Michelf.html">Michelf</a>
						</li>
				<li><a href="namespace-None.html">None</a>
						</li>
				<li><a href="namespace-PHP.html">PHP</a>
						</li>
				<li class="active"><a href="namespace-ProcessWire.html">ProcessWire</a>
						</li>
			</ul>
		</div>

		<hr>


		<div id="elements">
			<h3>Classes</h3>
			<ul>
				<li><a href="class-ProcessWire.AdminTheme.html">AdminTheme</a></li>
				<li><a href="class-ProcessWire.AdminThemeDefault.html">AdminThemeDefault</a></li>
				<li><a href="class-ProcessWire.AdminThemeDefaultHelpers.html">AdminThemeDefaultHelpers</a></li>
				<li><a href="class-ProcessWire.AdminThemeFramework.html">AdminThemeFramework</a></li>
				<li><a href="class-ProcessWire.AdminThemeReno.html">AdminThemeReno</a></li>
				<li><a href="class-ProcessWire.AdminThemeRenoHelpers.html">AdminThemeRenoHelpers</a></li>
				<li><a href="class-ProcessWire.AdminThemeUikit.html">AdminThemeUikit</a></li>
				<li><a href="class-ProcessWire.AdminThemeUikitConfigHelper.html">AdminThemeUikitConfigHelper</a></li>
				<li><a href="class-ProcessWire.Breadcrumb.html">Breadcrumb</a></li>
				<li><a href="class-ProcessWire.Breadcrumbs.html">Breadcrumbs</a></li>
				<li><a href="class-ProcessWire.CacheFile.html">CacheFile</a></li>
				<li><a href="class-ProcessWire.Comment.html">Comment</a></li>
				<li><a href="class-ProcessWire.CommentArray.html">CommentArray</a></li>
				<li><a href="class-ProcessWire.CommentFilter.html">CommentFilter</a></li>
				<li><a href="class-ProcessWire.CommentFilterAkismet.html">CommentFilterAkismet</a></li>
				<li><a href="class-ProcessWire.CommentForm.html">CommentForm</a></li>
				<li><a href="class-ProcessWire.CommentList.html">CommentList</a></li>
				<li><a href="class-ProcessWire.CommentNotifications.html">CommentNotifications</a></li>
				<li><a href="class-ProcessWire.CommentStars.html">CommentStars</a></li>
				<li><a href="class-ProcessWire.Config.html">Config</a></li>
				<li><a href="class-ProcessWire.Database.html">Database</a></li>
				<li><a href="class-ProcessWire.DatabaseMysqli.html">DatabaseMysqli</a></li>
				<li><a href="class-ProcessWire.DatabaseQuery.html">DatabaseQuery</a></li>
				<li><a href="class-ProcessWire.DatabaseQuerySelect.html">DatabaseQuerySelect</a></li>
				<li><a href="class-ProcessWire.DatabaseQuerySelectFulltext.html">DatabaseQuerySelectFulltext</a></li>
				<li><a href="class-ProcessWire.DatabaseStopwords.html">DatabaseStopwords</a></li>
				<li><a href="class-ProcessWire.Debug.html">Debug</a></li>
				<li><a href="class-ProcessWire.Field.html">Field</a></li>
				<li><a href="class-ProcessWire.Fieldgroup.html">Fieldgroup</a></li>
				<li><a href="class-ProcessWire.Fieldgroups.html">Fieldgroups</a></li>
				<li><a href="class-ProcessWire.FieldgroupsArray.html">FieldgroupsArray</a></li>
				<li><a href="class-ProcessWire.Fields.html">Fields</a></li>
				<li><a href="class-ProcessWire.FieldsArray.html">FieldsArray</a></li>
				<li><a href="class-ProcessWire.FieldSelectorInfo.html">FieldSelectorInfo</a></li>
				<li><a href="class-ProcessWire.FieldsetPage.html">FieldsetPage</a></li>
				<li><a href="class-ProcessWire.Fieldtype.html">Fieldtype</a></li>
				<li><a href="class-ProcessWire.FieldtypeCache.html">FieldtypeCache</a></li>
				<li><a href="class-ProcessWire.FieldtypeCheckbox.html">FieldtypeCheckbox</a></li>
				<li><a href="class-ProcessWire.FieldtypeComments.html">FieldtypeComments</a></li>
				<li><a href="class-ProcessWire.FieldtypeDatetime.html">FieldtypeDatetime</a></li>
				<li><a href="class-ProcessWire.FieldtypeEmail.html">FieldtypeEmail</a></li>
				<li><a href="class-ProcessWire.FieldtypeFieldsetClose.html">FieldtypeFieldsetClose</a></li>
				<li><a href="class-ProcessWire.FieldtypeFieldsetOpen.html">FieldtypeFieldsetOpen</a></li>
				<li><a href="class-ProcessWire.FieldtypeFieldsetPage.html">FieldtypeFieldsetPage</a></li>
				<li><a href="class-ProcessWire.FieldtypeFieldsetTabOpen.html">FieldtypeFieldsetTabOpen</a></li>
				<li><a href="class-ProcessWire.FieldtypeFile.html">FieldtypeFile</a></li>
				<li><a href="class-ProcessWire.FieldtypeFloat.html">FieldtypeFloat</a></li>
				<li><a href="class-ProcessWire.FieldtypeImage.html">FieldtypeImage</a></li>
				<li><a href="class-ProcessWire.FieldtypeInteger.html">FieldtypeInteger</a></li>
				<li><a href="class-ProcessWire.FieldtypeModule.html">FieldtypeModule</a></li>
				<li><a href="class-ProcessWire.FieldtypeMulti.html">FieldtypeMulti</a></li>
				<li><a href="class-ProcessWire.FieldtypeNotifications.html">FieldtypeNotifications</a></li>
				<li><a href="class-ProcessWire.FieldtypeOptions.html">FieldtypeOptions</a></li>
				<li><a href="class-ProcessWire.FieldtypePage.html">FieldtypePage</a></li>
				<li><a href="class-ProcessWire.FieldtypePageTable.html">FieldtypePageTable</a></li>
				<li><a href="class-ProcessWire.FieldtypePageTitle.html">FieldtypePageTitle</a></li>
				<li><a href="class-ProcessWire.FieldtypePageTitleLanguage.html">FieldtypePageTitleLanguage</a></li>
				<li><a href="class-ProcessWire.FieldtypePassword.html">FieldtypePassword</a></li>
				<li><a href="class-ProcessWire.FieldtypeRepeater.html">FieldtypeRepeater</a></li>
				<li><a href="class-ProcessWire.FieldtypeRepeaterConfigHelper.html">FieldtypeRepeaterConfigHelper</a></li>
				<li><a href="class-ProcessWire.Fieldtypes.html">Fieldtypes</a></li>
				<li><a href="class-ProcessWire.FieldtypeSelector.html">FieldtypeSelector</a></li>
				<li><a href="class-ProcessWire.FieldtypeText.html">FieldtypeText</a></li>
				<li><a href="class-ProcessWire.FieldtypeTextarea.html">FieldtypeTextarea</a></li>
				<li><a href="class-ProcessWire.FieldtypeTextareaHelper.html">FieldtypeTextareaHelper</a></li>
				<li><a href="class-ProcessWire.FieldtypeTextareaLanguage.html">FieldtypeTextareaLanguage</a></li>
				<li><a href="class-ProcessWire.FieldtypeTextLanguage.html">FieldtypeTextLanguage</a></li>
				<li><a href="class-ProcessWire.FieldtypeURL.html">FieldtypeURL</a></li>
				<li><a href="class-ProcessWire.FileCompiler.html">FileCompiler</a></li>
				<li><a href="class-ProcessWire.FileCompilerModule.html">FileCompilerModule</a></li>
				<li><a href="class-ProcessWire.FileCompilerTags.html">FileCompilerTags</a></li>
				<li><a href="class-ProcessWire.FileLog.html">FileLog</a></li>
				<li><a href="class-ProcessWire.FilenameArray.html">FilenameArray</a></li>
				<li><a href="class-ProcessWire.FileValidatorModule.html">FileValidatorModule</a></li>
				<li><a href="class-ProcessWire.Fuel.html">Fuel</a></li>
				<li><a href="class-ProcessWire.HookEvent.html">HookEvent</a></li>
				<li><a href="class-ProcessWire.ImageInspector.html">ImageInspector</a></li>
				<li><a href="class-ProcessWire.ImageSizer.html">ImageSizer</a></li>
				<li><a href="class-ProcessWire.ImageSizerEngine.html">ImageSizerEngine</a></li>
				<li><a href="class-ProcessWire.ImageSizerEngineAnimatedGif.html">ImageSizerEngineAnimatedGif</a></li>
				<li><a href="class-ProcessWire.ImageSizerEngineGD.html">ImageSizerEngineGD</a></li>
				<li><a href="class-ProcessWire.ImageSizerEngineIMagick.html">ImageSizerEngineIMagick</a></li>
				<li><a href="class-ProcessWire.Inputfield.html">Inputfield</a></li>
				<li><a href="class-ProcessWire.InputfieldAsmSelect.html">InputfieldAsmSelect</a></li>
				<li><a href="class-ProcessWire.InputfieldButton.html">InputfieldButton</a></li>
				<li><a href="class-ProcessWire.InputfieldCheckbox.html">InputfieldCheckbox</a></li>
				<li><a href="class-ProcessWire.InputfieldCheckboxes.html">InputfieldCheckboxes</a></li>
				<li><a href="class-ProcessWire.InputfieldCKEditor.html">InputfieldCKEditor</a></li>
				<li><a href="class-ProcessWire.InputfieldCommentsAdmin.html">InputfieldCommentsAdmin</a></li>
				<li><a href="class-ProcessWire.InputfieldDatetime.html">InputfieldDatetime</a></li>
				<li><a href="class-ProcessWire.InputfieldEmail.html">InputfieldEmail</a></li>
				<li><a href="class-ProcessWire.InputfieldFieldset.html">InputfieldFieldset</a></li>
				<li><a href="class-ProcessWire.InputfieldFieldsetClose.html">InputfieldFieldsetClose</a></li>
				<li><a href="class-ProcessWire.InputfieldFieldsetOpen.html">InputfieldFieldsetOpen</a></li>
				<li><a href="class-ProcessWire.InputfieldFieldsetTabOpen.html">InputfieldFieldsetTabOpen</a></li>
				<li><a href="class-ProcessWire.InputfieldFile.html">InputfieldFile</a></li>
				<li><a href="class-ProcessWire.InputfieldFloat.html">InputfieldFloat</a></li>
				<li><a href="class-ProcessWire.InputfieldForm.html">InputfieldForm</a></li>
				<li><a href="class-ProcessWire.InputfieldHidden.html">InputfieldHidden</a></li>
				<li><a href="class-ProcessWire.InputfieldIcon.html">InputfieldIcon</a></li>
				<li><a href="class-ProcessWire.InputfieldImage.html">InputfieldImage</a></li>
				<li><a href="class-ProcessWire.InputfieldInteger.html">InputfieldInteger</a></li>
				<li><a href="class-ProcessWire.InputfieldMarkup.html">InputfieldMarkup</a></li>
				<li><a href="class-ProcessWire.InputfieldName.html">InputfieldName</a></li>
				<li><a href="class-ProcessWire.InputfieldPage.html">InputfieldPage</a></li>
				<li><a href="class-ProcessWire.InputfieldPageAutocomplete.html">InputfieldPageAutocomplete</a></li>
				<li><a href="class-ProcessWire.InputfieldPageListSelect.html">InputfieldPageListSelect</a></li>
				<li><a href="class-ProcessWire.InputfieldPageListSelectMultiple.html">InputfieldPageListSelectMultiple</a></li>
				<li><a href="class-ProcessWire.InputfieldPageName.html">InputfieldPageName</a></li>
				<li><a href="class-ProcessWire.InputfieldPageTable.html">InputfieldPageTable</a></li>
				<li><a href="class-ProcessWire.InputfieldPageTableAjax.html">InputfieldPageTableAjax</a></li>
				<li><a href="class-ProcessWire.InputfieldPageTitle.html">InputfieldPageTitle</a></li>
				<li><a href="class-ProcessWire.InputfieldPassword.html">InputfieldPassword</a></li>
				<li><a href="class-ProcessWire.InputfieldRadios.html">InputfieldRadios</a></li>
				<li><a href="class-ProcessWire.InputfieldRepeater.html">InputfieldRepeater</a></li>
				<li><a href="class-ProcessWire.InputfieldsArray.html">InputfieldsArray</a></li>
				<li><a href="class-ProcessWire.InputfieldSelect.html">InputfieldSelect</a></li>
				<li><a href="class-ProcessWire.InputfieldSelectMultiple.html">InputfieldSelectMultiple</a></li>
				<li><a href="class-ProcessWire.InputfieldSelector.html">InputfieldSelector</a></li>
				<li><a href="class-ProcessWire.InputfieldSubmit.html">InputfieldSubmit</a></li>
				<li><a href="class-ProcessWire.InputfieldText.html">InputfieldText</a></li>
				<li><a href="class-ProcessWire.InputfieldTextarea.html">InputfieldTextarea</a></li>
				<li><a href="class-ProcessWire.InputfieldURL.html">InputfieldURL</a></li>
				<li><a href="class-ProcessWire.InputfieldWrapper.html">InputfieldWrapper</a></li>
				<li><a href="class-ProcessWire.ISEAG_GIFDecoder.html">ISEAG_GIFDecoder</a></li>
				<li><a href="class-ProcessWire.ISEAG_GIFEncoder.html">ISEAG_GIFEncoder</a></li>
				<li><a href="class-ProcessWire.JqueryCore.html">JqueryCore</a></li>
				<li><a href="class-ProcessWire.JqueryMagnific.html">JqueryMagnific</a></li>
				<li><a href="class-ProcessWire.JqueryTableSorter.html">JqueryTableSorter</a></li>
				<li><a href="class-ProcessWire.JqueryUI.html">JqueryUI</a></li>
				<li><a href="class-ProcessWire.JqueryWireTabs.html">JqueryWireTabs</a></li>
				<li><a href="class-ProcessWire.Language.html">Language</a></li>
				<li><a href="class-ProcessWire.LanguageParser.html">LanguageParser</a></li>
				<li><a href="class-ProcessWire.Languages.html">Languages</a></li>
				<li><a href="class-ProcessWire.LanguagesPageFieldValue.html">LanguagesPageFieldValue</a></li>
				<li><a href="class-ProcessWire.LanguageSupport.html">LanguageSupport</a></li>
				<li><a href="class-ProcessWire.LanguageSupportFields.html">LanguageSupportFields</a></li>
				<li><a href="class-ProcessWire.LanguageSupportInstall.html">LanguageSupportInstall</a></li>
				<li><a href="class-ProcessWire.LanguageSupportPageNames.html">LanguageSupportPageNames</a></li>
				<li><a href="class-ProcessWire.LanguageTabs.html">LanguageTabs</a></li>
				<li><a href="class-ProcessWire.LanguageTranslator.html">LanguageTranslator</a></li>
				<li><a href="class-ProcessWire.LazyCron.html">LazyCron</a></li>
				<li><a href="class-ProcessWire.LogEntriesArray.html">LogEntriesArray</a></li>
				<li><a href="class-ProcessWire.MarkupAdminDataTable.html">MarkupAdminDataTable</a></li>
				<li><a href="class-ProcessWire.MarkupCache.html">MarkupCache</a></li>
				<li><a href="class-ProcessWire.MarkupFieldtype.html">MarkupFieldtype</a></li>
				<li><a href="class-ProcessWire.MarkupHTMLPurifier.html">MarkupHTMLPurifier</a></li>
				<li><a href="class-ProcessWire.MarkupPageArray.html">MarkupPageArray</a></li>
				<li><a href="class-ProcessWire.MarkupPageFields.html">MarkupPageFields</a></li>
				<li><a href="class-ProcessWire.MarkupPagerNav.html">MarkupPagerNav</a></li>
				<li><a href="class-ProcessWire.MarkupQA.html">MarkupQA</a></li>
				<li><a href="class-ProcessWire.MarkupRSS.html">MarkupRSS</a></li>
				<li><a href="class-ProcessWire.ModuleConfig.html">ModuleConfig</a></li>
				<li><a href="class-ProcessWire.ModuleJS.html">ModuleJS</a></li>
				<li><a href="class-ProcessWire.ModulePlaceholder.html">ModulePlaceholder</a></li>
				<li><a href="class-ProcessWire.Modules.html">Modules</a></li>
				<li><a href="class-ProcessWire.ModulesDuplicates.html">ModulesDuplicates</a></li>
				<li><a href="class-ProcessWire.Notice.html">Notice</a></li>
				<li><a href="class-ProcessWire.NoticeError.html">NoticeError</a></li>
				<li><a href="class-ProcessWire.NoticeMessage.html">NoticeMessage</a></li>
				<li><a href="class-ProcessWire.Notices.html">Notices</a></li>
				<li><a href="class-ProcessWire.NoticeWarning.html">NoticeWarning</a></li>
				<li><a href="class-ProcessWire.Notification.html">Notification</a></li>
				<li><a href="class-ProcessWire.NotificationArray.html">NotificationArray</a></li>
				<li><a href="class-ProcessWire.NullField.html">NullField</a></li>
				<li><a href="class-ProcessWire.NullPage.html">NullPage</a></li>
				<li><a href="class-ProcessWire.Page.html">Page</a></li>
				<li><a href="class-ProcessWire.PageAccess.html">PageAccess</a></li>
				<li><a href="class-ProcessWire.PageAction.html">PageAction</a></li>
				<li><a href="class-ProcessWire.PageArray.html">PageArray</a></li>
				<li><a href="class-ProcessWire.PageArrayIterator.html">PageArrayIterator</a></li>
				<li><a href="class-ProcessWire.PageBookmarks.html">PageBookmarks</a></li>
				<li><a href="class-ProcessWire.PageComparison.html">PageComparison</a></li>
				<li><a href="class-ProcessWire.Pagefile.html">Pagefile</a></li>
				<li><a href="class-ProcessWire.Pagefiles.html">Pagefiles</a></li>
				<li><a href="class-ProcessWire.PagefilesManager.html">PagefilesManager</a></li>
				<li><a href="class-ProcessWire.PageFinder.html">PageFinder</a></li>
				<li><a href="class-ProcessWire.PageFrontEdit.html">PageFrontEdit</a></li>
				<li><a href="class-ProcessWire.PageFrontEditConfig.html">PageFrontEditConfig</a></li>
				<li><a href="class-ProcessWire.Pageimage.html">Pageimage</a></li>
				<li><a href="class-ProcessWire.Pageimages.html">Pageimages</a></li>
				<li><a href="class-ProcessWire.PagePathHistory.html">PagePathHistory</a></li>
				<li><a href="class-ProcessWire.PagePaths.html">PagePaths</a></li>
				<li><a href="class-ProcessWire.PagePermissions.html">PagePermissions</a></li>
				<li><a href="class-ProcessWire.PageRender.html">PageRender</a></li>
				<li><a href="class-ProcessWire.PagerNav.html">PagerNav</a></li>
				<li><a href="class-ProcessWire.PagerNavItem.html">PagerNavItem</a></li>
				<li><a href="class-ProcessWire.Pages.html">Pages</a></li>
				<li><a href="class-ProcessWire.PagesAccess.html">PagesAccess</a></li>
				<li><a href="class-ProcessWire.PagesEditor.html">PagesEditor</a></li>
				<li><a href="class-ProcessWire.PagesExportImport.html">PagesExportImport</a></li>
				<li><a href="class-ProcessWire.PagesLoader.html">PagesLoader</a></li>
				<li><a href="class-ProcessWire.PagesLoaderCache.html">PagesLoaderCache</a></li>
				<li><a href="class-ProcessWire.PagesNames.html">PagesNames</a></li>
				<li><a href="class-ProcessWire.PagesSortfields.html">PagesSortfields</a></li>
				<li><a href="class-ProcessWire.PagesTrash.html">PagesTrash</a></li>
				<li><a href="class-ProcessWire.PagesType.html">PagesType</a></li>
				<li><a href="class-ProcessWire.PageTraversal.html">PageTraversal</a></li>
				<li><a href="class-ProcessWire.PaginatedArray.html">PaginatedArray</a></li>
				<li><a href="class-ProcessWire.Password.html">Password</a></li>
				<li><a href="class-ProcessWire.Paths.html">Paths</a></li>
				<li><a href="class-ProcessWire.Permission.html">Permission</a></li>
				<li><a href="class-ProcessWire.Permissions.html">Permissions</a></li>
				<li><a href="class-ProcessWire.Process.html">Process</a></li>
				<li><a href="class-ProcessWire.ProcessCommentsManager.html">ProcessCommentsManager</a></li>
				<li><a href="class-ProcessWire.ProcessController.html">ProcessController</a></li>
				<li><a href="class-ProcessWire.ProcessField.html">ProcessField</a></li>
				<li><a href="class-ProcessWire.ProcessFieldExportImport.html">ProcessFieldExportImport</a></li>
				<li><a href="class-ProcessWire.ProcessForgotPassword.html">ProcessForgotPassword</a></li>
				<li><a href="class-ProcessWire.ProcessHome.html">ProcessHome</a></li>
				<li><a href="class-ProcessWire.ProcessLanguage.html">ProcessLanguage</a></li>
				<li><a href="class-ProcessWire.ProcessLanguageTranslator.html">ProcessLanguageTranslator</a></li>
				<li><a href="class-ProcessWire.ProcessList.html">ProcessList</a></li>
				<li><a href="class-ProcessWire.ProcessLogger.html">ProcessLogger</a></li>
				<li><a href="class-ProcessWire.ProcessLogin.html">ProcessLogin</a></li>
				<li><a href="class-ProcessWire.ProcessModule.html">ProcessModule</a></li>
				<li><a href="class-ProcessWire.ProcessModuleInstall.html">ProcessModuleInstall</a></li>
				<li><a href="class-ProcessWire.ProcessPageAdd.html">ProcessPageAdd</a></li>
				<li><a href="class-ProcessWire.ProcessPageClone.html">ProcessPageClone</a></li>
				<li><a href="class-ProcessWire.ProcessPageEdit.html">ProcessPageEdit</a></li>
				<li class="active"><a href="class-ProcessWire.ProcessPageEditImageSelect.html">ProcessPageEditImageSelect</a></li>
				<li><a href="class-ProcessWire.ProcessPageEditLink.html">ProcessPageEditLink</a></li>
				<li><a href="class-ProcessWire.ProcessPageList.html">ProcessPageList</a></li>
				<li><a href="class-ProcessWire.ProcessPageListActions.html">ProcessPageListActions</a></li>
				<li><a href="class-ProcessWire.ProcessPageLister.html">ProcessPageLister</a></li>
				<li><a href="class-ProcessWire.ProcessPageListerBookmarks.html">ProcessPageListerBookmarks</a></li>
				<li><a href="class-ProcessWire.ProcessPageListRender.html">ProcessPageListRender</a></li>
				<li><a href="class-ProcessWire.ProcessPageListRenderJSON.html">ProcessPageListRenderJSON</a></li>
				<li><a href="class-ProcessWire.ProcessPageSearch.html">ProcessPageSearch</a></li>
				<li><a href="class-ProcessWire.ProcessPageSearchLive.html">ProcessPageSearchLive</a></li>
				<li><a href="class-ProcessWire.ProcessPagesExportImport.html">ProcessPagesExportImport</a></li>
				<li><a href="class-ProcessWire.ProcessPageSort.html">ProcessPageSort</a></li>
				<li><a href="class-ProcessWire.ProcessPageTrash.html">ProcessPageTrash</a></li>
				<li><a href="class-ProcessWire.ProcessPageType.html">ProcessPageType</a></li>
				<li><a href="class-ProcessWire.ProcessPageView.html">ProcessPageView</a></li>
				<li><a href="class-ProcessWire.ProcessPermission.html">ProcessPermission</a></li>
				<li><a href="class-ProcessWire.ProcessProfile.html">ProcessProfile</a></li>
				<li><a href="class-ProcessWire.ProcessRecentPages.html">ProcessRecentPages</a></li>
				<li><a href="class-ProcessWire.ProcessRole.html">ProcessRole</a></li>
				<li><a href="class-ProcessWire.ProcessSessionDB.html">ProcessSessionDB</a></li>
				<li><a href="class-ProcessWire.ProcessTemplate.html">ProcessTemplate</a></li>
				<li><a href="class-ProcessWire.ProcessTemplateExportImport.html">ProcessTemplateExportImport</a></li>
				<li><a href="class-ProcessWire.ProcessUser.html">ProcessUser</a></li>
				<li><a href="class-ProcessWire.ProcessUserConfig.html">ProcessUserConfig</a></li>
				<li><a href="class-ProcessWire.ProcessWire.html">ProcessWire</a></li>
				<li><a href="class-ProcessWire.Punycode.html">Punycode</a></li>
				<li><a href="class-ProcessWire.PWGIF.html">PWGIF</a></li>
				<li><a href="class-ProcessWire.PWGIFCOLORTABLE.html">PWGIFCOLORTABLE</a></li>
				<li><a href="class-ProcessWire.PWGIFFILEHEADER.html">PWGIFFILEHEADER</a></li>
				<li><a href="class-ProcessWire.PWGIFIMAGE.html">PWGIFIMAGE</a></li>
				<li><a href="class-ProcessWire.PWGIFIMAGEHEADER.html">PWGIFIMAGEHEADER</a></li>
				<li><a href="class-ProcessWire.PWGIFLZW.html">PWGIFLZW</a></li>
				<li><a href="class-ProcessWire.PWPNG.html">PWPNG</a></li>
				<li><a href="class-ProcessWire.RepeaterPage.html">RepeaterPage</a></li>
				<li><a href="class-ProcessWire.RepeaterPageArray.html">RepeaterPageArray</a></li>
				<li><a href="class-ProcessWire.Role.html">Role</a></li>
				<li><a href="class-ProcessWire.Roles.html">Roles</a></li>
				<li><a href="class-ProcessWire.Sanitizer.html">Sanitizer</a></li>
				<li><a href="class-ProcessWire.SelectableOption.html">SelectableOption</a></li>
				<li><a href="class-ProcessWire.SelectableOptionArray.html">SelectableOptionArray</a></li>
				<li><a href="class-ProcessWire.SelectableOptionConfig.html">SelectableOptionConfig</a></li>
				<li><a href="class-ProcessWire.SelectableOptionManager.html">SelectableOptionManager</a></li>
				<li><a href="class-ProcessWire.Selector.html">Selector</a></li>
				<li><a href="class-ProcessWire.SelectorBitwiseAnd.html">SelectorBitwiseAnd</a></li>
				<li><a href="class-ProcessWire.SelectorContains.html">SelectorContains</a></li>
				<li><a href="class-ProcessWire.SelectorContainsLike.html">SelectorContainsLike</a></li>
				<li><a href="class-ProcessWire.SelectorContainsWords.html">SelectorContainsWords</a></li>
				<li><a href="class-ProcessWire.SelectorEnds.html">SelectorEnds</a></li>
				<li><a href="class-ProcessWire.SelectorEndsLike.html">SelectorEndsLike</a></li>
				<li><a href="class-ProcessWire.SelectorEqual.html">SelectorEqual</a></li>
				<li><a href="class-ProcessWire.SelectorGreaterThan.html">SelectorGreaterThan</a></li>
				<li><a href="class-ProcessWire.SelectorGreaterThanEqual.html">SelectorGreaterThanEqual</a></li>
				<li><a href="class-ProcessWire.SelectorLessThan.html">SelectorLessThan</a></li>
				<li><a href="class-ProcessWire.SelectorLessThanEqual.html">SelectorLessThanEqual</a></li>
				<li><a href="class-ProcessWire.SelectorNotEqual.html">SelectorNotEqual</a></li>
				<li><a href="class-ProcessWire.Selectors.html">Selectors</a></li>
				<li><a href="class-ProcessWire.SelectorStarts.html">SelectorStarts</a></li>
				<li><a href="class-ProcessWire.SelectorStartsLike.html">SelectorStartsLike</a></li>
				<li><a href="class-ProcessWire.Session.html">Session</a></li>
				<li><a href="class-ProcessWire.SessionCSRF.html">SessionCSRF</a></li>
				<li><a href="class-ProcessWire.SessionHandlerDB.html">SessionHandlerDB</a></li>
				<li><a href="class-ProcessWire.SessionLoginThrottle.html">SessionLoginThrottle</a></li>
				<li><a href="class-ProcessWire.SystemNotifications.html">SystemNotifications</a></li>
				<li><a href="class-ProcessWire.SystemNotificationsConfig.html">SystemNotificationsConfig</a></li>
				<li><a href="class-ProcessWire.SystemUpdate.html">SystemUpdate</a></li>
				<li><a href="class-ProcessWire.SystemUpdate1.html">SystemUpdate1</a></li>
				<li><a href="class-ProcessWire.SystemUpdate10.html">SystemUpdate10</a></li>
				<li><a href="class-ProcessWire.SystemUpdate11.html">SystemUpdate11</a></li>
				<li><a href="class-ProcessWire.SystemUpdate12.html">SystemUpdate12</a></li>
				<li><a href="class-ProcessWire.SystemUpdate13.html">SystemUpdate13</a></li>
				<li><a href="class-ProcessWire.SystemUpdate14.html">SystemUpdate14</a></li>
				<li><a href="class-ProcessWire.SystemUpdate15.html">SystemUpdate15</a></li>
				<li><a href="class-ProcessWire.SystemUpdate16.html">SystemUpdate16</a></li>
				<li><a href="class-ProcessWire.SystemUpdate4.html">SystemUpdate4</a></li>
				<li><a href="class-ProcessWire.SystemUpdate5.html">SystemUpdate5</a></li>
				<li><a href="class-ProcessWire.SystemUpdate6.html">SystemUpdate6</a></li>
				<li><a href="class-ProcessWire.SystemUpdate7.html">SystemUpdate7</a></li>
				<li><a href="class-ProcessWire.SystemUpdate9.html">SystemUpdate9</a></li>
				<li><a href="class-ProcessWire.SystemUpdater.html">SystemUpdater</a></li>
				<li><a href="class-ProcessWire.Template.html">Template</a></li>
				<li><a href="class-ProcessWire.TemplateFile.html">TemplateFile</a></li>
				<li><a href="class-ProcessWire.Templates.html">Templates</a></li>
				<li><a href="class-ProcessWire.TemplatesArray.html">TemplatesArray</a></li>
				<li><a href="class-ProcessWire.Textformatter.html">Textformatter</a></li>
				<li><a href="class-ProcessWire.TextformatterEntities.html">TextformatterEntities</a></li>
				<li><a href="class-ProcessWire.TextformatterMarkdownExtra.html">TextformatterMarkdownExtra</a></li>
				<li><a href="class-ProcessWire.TextformatterNewlineBR.html">TextformatterNewlineBR</a></li>
				<li><a href="class-ProcessWire.TextformatterNewlineUL.html">TextformatterNewlineUL</a></li>
				<li><a href="class-ProcessWire.TextformatterPstripper.html">TextformatterPstripper</a></li>
				<li><a href="class-ProcessWire.TextformatterSmartypants.html">TextformatterSmartypants</a></li>
				<li><a href="class-ProcessWire.TextformatterStripTags.html">TextformatterStripTags</a></li>
				<li><a href="class-ProcessWire.Tfa.html">Tfa</a></li>
				<li><a href="class-ProcessWire.User.html">User</a></li>
				<li><a href="class-ProcessWire.Users.html">Users</a></li>
				<li><a href="class-ProcessWire.Wire.html">Wire</a></li>
				<li><a href="class-ProcessWire.WireAction.html">WireAction</a></li>
				<li><a href="class-ProcessWire.WireArray.html">WireArray</a></li>
				<li><a href="class-ProcessWire.WireCache.html">WireCache</a></li>
				<li><a href="class-ProcessWire.WireClassLoader.html">WireClassLoader</a></li>
				<li><a href="class-ProcessWire.WireData.html">WireData</a></li>
				<li><a href="class-ProcessWire.WireDatabaseBackup.html">WireDatabaseBackup</a></li>
				<li><a href="class-ProcessWire.WireDatabasePDO.html">WireDatabasePDO</a></li>
				<li><a href="class-ProcessWire.WireDateTime.html">WireDateTime</a></li>
				<li><a href="class-ProcessWire.WireDebugInfo.html">WireDebugInfo</a></li>
				<li><a href="class-ProcessWire.WireFileTools.html">WireFileTools</a></li>
				<li><a href="class-ProcessWire.WireHooks.html">WireHooks</a></li>
				<li><a href="class-ProcessWire.WireHttp.html">WireHttp</a></li>
				<li><a href="class-ProcessWire.WireInput.html">WireInput</a></li>
				<li><a href="class-ProcessWire.WireInputData.html">WireInputData</a></li>
				<li><a href="class-ProcessWire.WireLog.html">WireLog</a></li>
				<li><a href="class-ProcessWire.WireMail.html">WireMail</a></li>
				<li><a href="class-ProcessWire.WireMailTools.html">WireMailTools</a></li>
				<li><a href="class-ProcessWire.WireMarkupRegions.html">WireMarkupRegions</a></li>
				<li><a href="class-ProcessWire.WireRandom.html">WireRandom</a></li>
				<li><a href="class-ProcessWire.WireSaveableItems.html">WireSaveableItems</a></li>
				<li><a href="class-ProcessWire.WireSaveableItemsLookup.html">WireSaveableItemsLookup</a></li>
				<li><a href="class-ProcessWire.WireSessionHandler.html">WireSessionHandler</a></li>
				<li><a href="class-ProcessWire.WireShutdown.html">WireShutdown</a></li>
				<li><a href="class-ProcessWire.WireTempDir.html">WireTempDir</a></li>
				<li><a href="class-ProcessWire.WireTextTools.html">WireTextTools</a></li>
				<li><a href="class-ProcessWire.WireUpload.html">WireUpload</a></li>
			</ul>

			<h3>Interfaces</h3>
			<ul>
				<li><a href="class-ProcessWire._Module.html">_Module</a></li>
				<li><a href="class-ProcessWire.CommentFormInterface.html">CommentFormInterface</a></li>
				<li><a href="class-ProcessWire.CommentListInterface.html">CommentListInterface</a></li>
				<li><a href="class-ProcessWire.ConfigurableModule.html">ConfigurableModule</a></li>
				<li><a href="class-ProcessWire.Exportable.html">Exportable</a></li>
				<li><a href="class-ProcessWire.FieldtypeLanguageInterface.html">FieldtypeLanguageInterface</a></li>
				<li><a href="class-ProcessWire.FieldtypePageTitleCompatible.html">FieldtypePageTitleCompatible</a></li>
				<li><a href="class-ProcessWire.HasLookupItems.html">HasLookupItems</a></li>
				<li><a href="class-ProcessWire.InputfieldHasArrayValue.html">InputfieldHasArrayValue</a></li>
				<li><a href="class-ProcessWire.InputfieldHasSortableValue.html">InputfieldHasSortableValue</a></li>
				<li><a href="class-ProcessWire.InputfieldItemList.html">InputfieldItemList</a></li>
				<li><a href="class-ProcessWire.InputfieldPageListSelection.html">InputfieldPageListSelection</a></li>
				<li><a href="class-ProcessWire.LanguagesValueInterface.html">LanguagesValueInterface</a></li>
				<li><a href="class-ProcessWire.Module.html">Module</a></li>
				<li><a href="class-ProcessWire.PageFieldValueInterface.html">PageFieldValueInterface</a></li>
				<li><a href="class-ProcessWire.Saveable.html">Saveable</a></li>
				<li><a href="class-ProcessWire.SearchableModule.html">SearchableModule</a></li>
				<li><a href="class-ProcessWire.WireDatabase.html">WireDatabase</a></li>
				<li><a href="class-ProcessWire.WireFuelable.html">WireFuelable</a></li>
				<li><a href="class-ProcessWire.WireMailInterface.html">WireMailInterface</a></li>
				<li><a href="class-ProcessWire.WireMatchable.html">WireMatchable</a></li>
				<li><a href="class-ProcessWire.WireNoticeable.html">WireNoticeable</a></li>
				<li><a href="class-ProcessWire.WirePageEditor.html">WirePageEditor</a></li>
				<li><a href="class-ProcessWire.WirePaginatable.html">WirePaginatable</a></li>
				<li><a href="class-ProcessWire.WireProfilerInterface.html">WireProfilerInterface</a></li>
				<li><a href="class-ProcessWire.WireTrackable.html">WireTrackable</a></li>
				<li><a href="class-ProcessWire.WireTranslatable.html">WireTranslatable</a></li>
			</ul>


			<h3>Exceptions</h3>
			<ul>
				<li><a href="class-ProcessWire.PageFinderException.html">PageFinderException</a></li>
				<li><a href="class-ProcessWire.PageFinderSyntaxException.html">PageFinderSyntaxException</a></li>
				<li><a href="class-ProcessWire.ProcessController404Exception.html">ProcessController404Exception</a></li>
				<li><a href="class-ProcessWire.ProcessControllerPermissionException.html">ProcessControllerPermissionException</a></li>
				<li><a href="class-ProcessWire.Wire404Exception.html">Wire404Exception</a></li>
				<li><a href="class-ProcessWire.WireCSRFException.html">WireCSRFException</a></li>
				<li><a href="class-ProcessWire.WireDatabaseException.html">WireDatabaseException</a></li>
				<li><a href="class-ProcessWire.WireException.html">WireException</a></li>
				<li><a href="class-ProcessWire.WirePermissionException.html">WirePermissionException</a></li>
			</ul>


			<h3>Functions</h3>
			<ul>
				<li><a href="function-ProcessWire.__.html">__</a></li>
				<li><a href="function-ProcessWire._checkForHttpHostError.html">_checkForHttpHostError</a></li>
				<li><a href="function-ProcessWire._checkForTwoFactorAuth.html">_checkForTwoFactorAuth</a></li>
				<li><a href="function-ProcessWire._hookSessionRedirectModal.html">_hookSessionRedirectModal</a></li>
				<li><a href="function-ProcessWire._n.html">_n</a></li>
				<li><a href="function-ProcessWire._wireDataAPI.html">_wireDataAPI</a></li>
				<li><a href="function-ProcessWire._wirePagesAPI.html">_wirePagesAPI</a></li>
				<li><a href="function-ProcessWire._x.html">_x</a></li>
				<li><a href="function-ProcessWire.cache.html">cache</a></li>
				<li><a href="function-ProcessWire.config.html">config</a></li>
				<li><a href="function-ProcessWire.database.html">database</a></li>
				<li><a href="function-ProcessWire.datetime.html">datetime</a></li>
				<li><a href="function-ProcessWire.fields.html">fields</a></li>
				<li><a href="function-ProcessWire.FieldsetPageInstructions.html">FieldsetPageInstructions</a></li>
				<li><a href="function-ProcessWire.files.html">files</a></li>
				<li><a href="function-ProcessWire.hookMarkupPagerNavRender.html">hookMarkupPagerNavRender</a></li>
				<li><a href="function-ProcessWire.input.html">input</a></li>
				<li><a href="function-ProcessWire.inputCookie.html">inputCookie</a></li>
				<li><a href="function-ProcessWire.InputfieldPageName_saveModuleConfigData.html">InputfieldPageName_saveModuleConfigData</a></li>
				<li><a href="function-ProcessWire.inputGet.html">inputGet</a></li>
				<li><a href="function-ProcessWire.inputPost.html">inputPost</a></li>
				<li><a href="function-ProcessWire.languages.html">languages</a></li>
				<li><a href="function-ProcessWire.modules.html">modules</a></li>
				<li><a href="function-ProcessWire.page.html">page</a></li>
				<li><a href="function-ProcessWire.PageArray.html">PageArray</a></li>
				<li><a href="function-ProcessWire.pages.html">pages</a></li>
				<li><a href="function-ProcessWire.paths.html">paths</a></li>
				<li><a href="function-ProcessWire.permissions.html">permissions</a></li>
				<li><a href="function-ProcessWire.profiler.html">profiler</a></li>
				<li><a href="function-ProcessWire.region.html">region</a></li>
				<li><a href="function-ProcessWire.roles.html">roles</a></li>
				<li><a href="function-ProcessWire.sanitizer.html">sanitizer</a></li>
				<li><a href="function-ProcessWire.session.html">session</a></li>
				<li><a href="function-ProcessWire.setting.html">setting</a></li>
				<li><a href="function-ProcessWire.tabIndent.html">tabIndent</a></li>
				<li><a href="function-ProcessWire.templates.html">templates</a></li>
				<li><a href="function-ProcessWire.urls.html">urls</a></li>
				<li><a href="function-ProcessWire.user.html">user</a></li>
				<li><a href="function-ProcessWire.users.html">users</a></li>
				<li><a href="function-ProcessWire.wire.html">wire</a></li>
				<li><a href="function-ProcessWire.WireArray.html">WireArray</a></li>
				<li><a href="function-ProcessWire.wireBytesStr.html">wireBytesStr</a></li>
				<li><a href="function-ProcessWire.wireCache.html">wireCache</a></li>
				<li><a href="function-ProcessWire.wireChmod.html">wireChmod</a></li>
				<li><a href="function-ProcessWire.wireClassExists.html">wireClassExists</a></li>
				<li><a href="function-ProcessWire.wireClassImplements.html">wireClassImplements</a></li>
				<li><a href="function-ProcessWire.wireClassName.html">wireClassName</a></li>
				<li><a href="function-ProcessWire.wireClassParents.html">wireClassParents</a></li>
				<li><a href="function-ProcessWire.wireConfig.html">wireConfig</a></li>
				<li><a href="function-ProcessWire.wireCopy.html">wireCopy</a></li>
				<li><a href="function-ProcessWire.wireCount.html">wireCount</a></li>
				<li><a href="function-ProcessWire.wireDatabase.html">wireDatabase</a></li>
				<li><a href="function-ProcessWire.wireDate.html">wireDate</a></li>
				<li><a href="function-ProcessWire.wireDatetime.html">wireDatetime</a></li>
				<li><a href="function-ProcessWire.wireDecodeJSON.html">wireDecodeJSON</a></li>
				<li><a href="function-ProcessWire.wireEncodeJSON.html">wireEncodeJSON</a></li>
				<li><a href="function-ProcessWire.wireFields.html">wireFields</a></li>
				<li><a href="function-ProcessWire.wireFiles.html">wireFiles</a></li>
				<li><a href="function-ProcessWire.wireIconMarkup.html">wireIconMarkup</a></li>
				<li><a href="function-ProcessWire.wireIconMarkupFile.html">wireIconMarkupFile</a></li>
				<li><a href="function-ProcessWire.wireIncludeFile.html">wireIncludeFile</a></li>
				<li><a href="function-ProcessWire.wireInput.html">wireInput</a></li>
				<li><a href="function-ProcessWire.wireInputCookie.html">wireInputCookie</a></li>
				<li><a href="function-ProcessWire.wireInputGet.html">wireInputGet</a></li>
				<li><a href="function-ProcessWire.wireInputPost.html">wireInputPost</a></li>
				<li><a href="function-ProcessWire.wireInstanceOf.html">wireInstanceOf</a></li>
				<li><a href="function-ProcessWire.wireIsCallable.html">wireIsCallable</a></li>
				<li><a href="function-ProcessWire.wireLanguages.html">wireLanguages</a></li>
				<li><a href="function-ProcessWire.wireLog.html">wireLog</a></li>
				<li><a href="function-ProcessWire.wireMail.html">wireMail</a></li>
				<li><a href="function-ProcessWire.wireMethodExists.html">wireMethodExists</a></li>
				<li><a href="function-ProcessWire.wireMinArray.html">wireMinArray</a></li>
				<li><a href="function-ProcessWire.wireMkdir.html">wireMkdir</a></li>
				<li><a href="function-ProcessWire.wireModules.html">wireModules</a></li>
				<li><a href="function-ProcessWire.wirePage.html">wirePage</a></li>
				<li><a href="function-ProcessWire.wirePages.html">wirePages</a></li>
				<li><a href="function-ProcessWire.wirePaths.html">wirePaths</a></li>
				<li><a href="function-ProcessWire.wirePermissions.html">wirePermissions</a></li>
				<li><a href="function-ProcessWire.wirePopulateStringTags.html">wirePopulateStringTags</a></li>
				<li><a href="function-ProcessWire.wireProfiler.html">wireProfiler</a></li>
				<li><a href="function-ProcessWire.wireRegion.html">wireRegion</a></li>
				<li><a href="function-ProcessWire.wireRelativeTimeStr.html">wireRelativeTimeStr</a></li>
				<li><a href="function-ProcessWire.wireRenderFile.html">wireRenderFile</a></li>
				<li><a href="function-ProcessWire.wireRmdir.html">wireRmdir</a></li>
				<li><a href="function-ProcessWire.wireRoles.html">wireRoles</a></li>
				<li><a href="function-ProcessWire.wireSanitizer.html">wireSanitizer</a></li>
				<li><a href="function-ProcessWire.wireSendFile.html">wireSendFile</a></li>
				<li><a href="function-ProcessWire.wireSession.html">wireSession</a></li>
				<li><a href="function-ProcessWire.wireTempDir.html">wireTempDir</a></li>
				<li><a href="function-ProcessWire.wireTemplates.html">wireTemplates</a></li>
				<li><a href="function-ProcessWire.wireUnzipFile.html">wireUnzipFile</a></li>
				<li><a href="function-ProcessWire.wireUrls.html">wireUrls</a></li>
				<li><a href="function-ProcessWire.wireUser.html">wireUser</a></li>
				<li><a href="function-ProcessWire.wireUsers.html">wireUsers</a></li>
				<li><a href="function-ProcessWire.wireZipFile.html">wireZipFile</a></li>
			</ul>
		</div>
	</div>
</div>

<div id="splitter"></div>

<div id="right">
<div id="rightInner">	
	<div id="switch">
	<span id="switch_sel">
		<a id="light" href="#" class="themes" title="Light theme"></a>
		<a id="dark" href="#" class="themes" title="Dark theme"></a>
	</span>
	</div>

	<form id="search">
		<input type="hidden" name="cx" value="">
		<input type="hidden" name="ie" value="UTF-8">
		<input type="text" name="q" class="text">
		<input type="submit" value="Search">
	</form>

	<div id="navigation">
		<ul>
			<li>
				<a href="index.html" title="Overview"><span>Overview</span></a>
			</li>
			<li>
				<a href="namespace-ProcessWire.html" title="Summary of ProcessWire"><span>Namespace</span></a>
			</li>
			<li>
				<a href="class-ProcessWire.ProcessPageEditImageSelect.html" title="Summary of ProcessWire\ProcessPageEditImageSelect"><span>Class</span></a>
			</li>
		</ul>
		<ul>
			<li>
				<a href="tree.html" title="Tree view of classes, interfaces, traits and exceptions"><span>Tree</span></a>
			</li>
			<li>
				<a href="todo.html" title="Todo list"><span>Todo</span></a>
			</li>
		</ul>
		<ul>
		</ul>
	</div>

<pre><code><span id="1" class="l"><a class="l" href="#1">   1: </a><span class="xlang">&lt;?php</span> <span class="php-keyword1">namespace</span> ProcessWire;
</span><span id="2" class="l"><a class="l" href="#2">   2: </a>
</span><span id="3" class="l"><a class="l" href="#3">   3: </a><span class="php-comment">/**
</span></span><span id="4" class="l"><a class="l" href="#4">   4: </a><span class="php-comment"> * ProcessWire Image Select + Edit Process
</span></span><span id="5" class="l"><a class="l" href="#5">   5: </a><span class="php-comment"> *
</span></span><span id="6" class="l"><a class="l" href="#6">   6: </a><span class="php-comment"> * Provides the image selecting and editing capability for rich text editors (TinyMCE/CKEditor)
</span></span><span id="7" class="l"><a class="l" href="#7">   7: </a><span class="php-comment"> * 
</span></span><span id="8" class="l"><a class="l" href="#8">   8: </a><span class="php-comment"> * ProcessWire 3.x, Copyright 2018 by Ryan Cramer
</span></span><span id="9" class="l"><a class="l" href="#9">   9: </a><span class="php-comment"> * https://processwire.com
</span></span><span id="10" class="l"><a class="l" href="#10">  10: </a><span class="php-comment"> * 
</span></span><span id="11" class="l"><a class="l" href="#11">  11: </a><span class="php-comment"> * @property int $hidpiDefault HiDPI/Retina checkbox default checked?
</span></span><span id="12" class="l"><a class="l" href="#12">  12: </a><span class="php-comment"> * @property int $noThumbs Do not generate thumbnail images (make image selection will use full-size images).
</span></span><span id="13" class="l"><a class="l" href="#13">  13: </a><span class="php-comment"> * @property string skipFields Space separated field names to skip for selection of images. 
</span></span><span id="14" class="l"><a class="l" href="#14">  14: </a><span class="php-comment"> * @property int $noSizeAttrs Skip width attributes on image tags? (not recommended if you want HiDPI support)
</span></span><span id="15" class="l"><a class="l" href="#15">  15: </a><span class="php-comment"> * @property string $alignLeftClass Align left class (align_left recommended)
</span></span><span id="16" class="l"><a class="l" href="#16">  16: </a><span class="php-comment"> * @property string $alignRightClass Align right class (align_right recommended)
</span></span><span id="17" class="l"><a class="l" href="#17">  17: </a><span class="php-comment"> * @property string $alignCenterClass Align center class (align_center recommended)
</span></span><span id="18" class="l"><a class="l" href="#18">  18: </a><span class="php-comment"> * 
</span></span><span id="19" class="l"><a class="l" href="#19">  19: </a><span class="php-comment"> * @method string execute()
</span></span><span id="20" class="l"><a class="l" href="#20">  20: </a><span class="php-comment"> * @method string executeEdit()
</span></span><span id="21" class="l"><a class="l" href="#21">  21: </a><span class="php-comment"> * 
</span></span><span id="22" class="l"><a class="l" href="#22">  22: </a><span class="php-comment"> */</span>
</span><span id="23" class="l"><a class="l" href="#23">  23: </a>
</span><span id="24" class="l"><a class="l" href="#24">  24: </a><span class="php-keyword1">class</span> <a id="ProcessPageEditImageSelect" href="#ProcessPageEditImageSelect">ProcessPageEditImageSelect</a> <span class="php-keyword1">extends</span> Process <span class="php-keyword1">implements</span> ConfigurableModule {
</span><span id="25" class="l"><a class="l" href="#25">  25: </a>    
</span><span id="26" class="l"><a class="l" href="#26">  26: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> <a id="_getModuleInfo" href="#_getModuleInfo">getModuleInfo</a>() {
</span><span id="27" class="l"><a class="l" href="#27">  27: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">array</span>(
</span><span id="28" class="l"><a class="l" href="#28">  28: </a>            <span class="php-quote">'title'</span> =&gt; <span class="php-quote">'Page Edit Image'</span>,
</span><span id="29" class="l"><a class="l" href="#29">  29: </a>            <span class="php-quote">'summary'</span> =&gt; <span class="php-quote">'Provides image manipulation functions for image fields and rich text editors.'</span>,
</span><span id="30" class="l"><a class="l" href="#30">  30: </a>            <span class="php-quote">'version'</span> =&gt; <span class="php-num">120</span>,
</span><span id="31" class="l"><a class="l" href="#31">  31: </a>            <span class="php-quote">'permanent'</span> =&gt; <span class="php-keyword1">true</span>,
</span><span id="32" class="l"><a class="l" href="#32">  32: </a>            <span class="php-quote">'permission'</span> =&gt; <span class="php-quote">'page-edit'</span>,
</span><span id="33" class="l"><a class="l" href="#33">  33: </a>        );
</span><span id="34" class="l"><a class="l" href="#34">  34: </a>    }
</span><span id="35" class="l"><a class="l" href="#35">  35: </a>
</span><span id="36" class="l"><a class="l" href="#36">  36: </a>    <span class="php-comment">/**
</span></span><span id="37" class="l"><a class="l" href="#37">  37: </a><span class="php-comment">     * Max image width when outputting &lt;img&gt; tags, derives value from $_GET[winwidth]
</span></span><span id="38" class="l"><a class="l" href="#38">  38: </a><span class="php-comment">     * 
</span></span><span id="39" class="l"><a class="l" href="#39">  39: </a><span class="php-comment">     * @var int
</span></span><span id="40" class="l"><a class="l" href="#40">  40: </a><span class="php-comment">     * 
</span></span><span id="41" class="l"><a class="l" href="#41">  41: </a><span class="php-comment">     */</span>
</span><span id="42" class="l"><a class="l" href="#42">  42: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$maxImageWidth" href="#$maxImageWidth">$maxImageWidth</a></span> = <span class="php-num">835</span>;
</span><span id="43" class="l"><a class="l" href="#43">  43: </a>
</span><span id="44" class="l"><a class="l" href="#44">  44: </a>    <span class="php-comment">/**
</span></span><span id="45" class="l"><a class="l" href="#45">  45: </a><span class="php-comment">     * Page that the image lives on
</span></span><span id="46" class="l"><a class="l" href="#46">  46: </a><span class="php-comment">     * 
</span></span><span id="47" class="l"><a class="l" href="#47">  47: </a><span class="php-comment">     * @var Page|null
</span></span><span id="48" class="l"><a class="l" href="#48">  48: </a><span class="php-comment">     * 
</span></span><span id="49" class="l"><a class="l" href="#49">  49: </a><span class="php-comment">     */</span>
</span><span id="50" class="l"><a class="l" href="#50">  50: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$page" href="#$page">$page</a></span> = <span class="php-keyword1">null</span>;
</span><span id="51" class="l"><a class="l" href="#51">  51: </a>    
</span><span id="52" class="l"><a class="l" href="#52">  52: </a>    <span class="php-comment">/**
</span></span><span id="53" class="l"><a class="l" href="#53">  53: </a><span class="php-comment">     * If $page is a repeater item, then $masterPage is the Page the repeater lives on 
</span></span><span id="54" class="l"><a class="l" href="#54">  54: </a><span class="php-comment">     * 
</span></span><span id="55" class="l"><a class="l" href="#55">  55: </a><span class="php-comment">     * @var Page|null
</span></span><span id="56" class="l"><a class="l" href="#56">  56: </a><span class="php-comment">     * 
</span></span><span id="57" class="l"><a class="l" href="#57">  57: </a><span class="php-comment">     */</span>
</span><span id="58" class="l"><a class="l" href="#58">  58: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$masterPage" href="#$masterPage">$masterPage</a></span> = <span class="php-keyword1">null</span>;
</span><span id="59" class="l"><a class="l" href="#59">  59: </a>    
</span><span id="60" class="l"><a class="l" href="#60">  60: </a>    <span class="php-comment">/**
</span></span><span id="61" class="l"><a class="l" href="#61">  61: </a><span class="php-comment">     * The page being edited, if different from $page
</span></span><span id="62" class="l"><a class="l" href="#62">  62: </a><span class="php-comment">     * 
</span></span><span id="63" class="l"><a class="l" href="#63">  63: </a><span class="php-comment">     * @var Page|null
</span></span><span id="64" class="l"><a class="l" href="#64">  64: </a><span class="php-comment">     *
</span></span><span id="65" class="l"><a class="l" href="#65">  65: </a><span class="php-comment">     */</span>
</span><span id="66" class="l"><a class="l" href="#66">  66: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$editorPage" href="#$editorPage">$editorPage</a></span> = <span class="php-keyword1">null</span>;
</span><span id="67" class="l"><a class="l" href="#67">  67: </a>    <span class="php-comment">//protected $defaultClass = 'Pageimage';</span>
</span><span id="68" class="l"><a class="l" href="#68">  68: </a>    <span class="php-comment">//protected $file = '';</span>
</span><span id="69" class="l"><a class="l" href="#69">  69: </a>
</span><span id="70" class="l"><a class="l" href="#70">  70: </a>    <span class="php-comment">/**
</span></span><span id="71" class="l"><a class="l" href="#71">  71: </a><span class="php-comment">     * If editing a filename that is a variation, this is the width determined from the filename (123x456)
</span></span><span id="72" class="l"><a class="l" href="#72">  72: </a><span class="php-comment">     * 
</span></span><span id="73" class="l"><a class="l" href="#73">  73: </a><span class="php-comment">     * @var int
</span></span><span id="74" class="l"><a class="l" href="#74">  74: </a><span class="php-comment">     * 
</span></span><span id="75" class="l"><a class="l" href="#75">  75: </a><span class="php-comment">     */</span>
</span><span id="76" class="l"><a class="l" href="#76">  76: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$editWidth" href="#$editWidth">$editWidth</a></span> = <span class="php-num">0</span>;
</span><span id="77" class="l"><a class="l" href="#77">  77: </a>    
</span><span id="78" class="l"><a class="l" href="#78">  78: </a>    <span class="php-comment">/**
</span></span><span id="79" class="l"><a class="l" href="#79">  79: </a><span class="php-comment">     * If editing a filename that is a variation, this is the height determined from the filename (123x456)
</span></span><span id="80" class="l"><a class="l" href="#80">  80: </a><span class="php-comment">     *
</span></span><span id="81" class="l"><a class="l" href="#81">  81: </a><span class="php-comment">     * @var int
</span></span><span id="82" class="l"><a class="l" href="#82">  82: </a><span class="php-comment">     *
</span></span><span id="83" class="l"><a class="l" href="#83">  83: </a><span class="php-comment">     */</span>
</span><span id="84" class="l"><a class="l" href="#84">  84: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$editHeight" href="#$editHeight">$editHeight</a></span> = <span class="php-num">0</span>;
</span><span id="85" class="l"><a class="l" href="#85">  85: </a>
</span><span id="86" class="l"><a class="l" href="#86">  86: </a>    <span class="php-comment">/**
</span></span><span id="87" class="l"><a class="l" href="#87">  87: </a><span class="php-comment">     * Whether or not HiDPI mode will be used or resizes
</span></span><span id="88" class="l"><a class="l" href="#88">  88: </a><span class="php-comment">     * 
</span></span><span id="89" class="l"><a class="l" href="#89">  89: </a><span class="php-comment">     * @var bool
</span></span><span id="90" class="l"><a class="l" href="#90">  90: </a><span class="php-comment">     * 
</span></span><span id="91" class="l"><a class="l" href="#91">  91: </a><span class="php-comment">     */</span>
</span><span id="92" class="l"><a class="l" href="#92">  92: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$hidpi" href="#$hidpi">$hidpi</a></span> = <span class="php-keyword1">false</span>;
</span><span id="93" class="l"><a class="l" href="#93">  93: </a>
</span><span id="94" class="l"><a class="l" href="#94">  94: </a>    <span class="php-comment">/**
</span></span><span id="95" class="l"><a class="l" href="#95">  95: </a><span class="php-comment">     * Extensions to match in a regex for files in $_GET[file]
</span></span><span id="96" class="l"><a class="l" href="#96">  96: </a><span class="php-comment">     * 
</span></span><span id="97" class="l"><a class="l" href="#97">  97: </a><span class="php-comment">     * @var string
</span></span><span id="98" class="l"><a class="l" href="#98">  98: </a><span class="php-comment">     * 
</span></span><span id="99" class="l"><a class="l" href="#99">  99: </a><span class="php-comment">     */</span>
</span><span id="100" class="l"><a class="l" href="#100"> 100: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$extensions" href="#$extensions">$extensions</a></span> = <span class="php-quote">'jpg|jpeg|gif|png|svg'</span>;
</span><span id="101" class="l"><a class="l" href="#101"> 101: </a>
</span><span id="102" class="l"><a class="l" href="#102"> 102: </a>    <span class="php-comment">/**
</span></span><span id="103" class="l"><a class="l" href="#103"> 103: </a><span class="php-comment">     * Common translation labels (see init)
</span></span><span id="104" class="l"><a class="l" href="#104"> 104: </a><span class="php-comment">     * 
</span></span><span id="105" class="l"><a class="l" href="#105"> 105: </a><span class="php-comment">     * @var array
</span></span><span id="106" class="l"><a class="l" href="#106"> 106: </a><span class="php-comment">     * 
</span></span><span id="107" class="l"><a class="l" href="#107"> 107: </a><span class="php-comment">     */</span>
</span><span id="108" class="l"><a class="l" href="#108"> 108: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$labels" href="#$labels">$labels</a></span> = <span class="php-keyword1">array</span>();
</span><span id="109" class="l"><a class="l" href="#109"> 109: </a>
</span><span id="110" class="l"><a class="l" href="#110"> 110: </a>    <span class="php-comment">/**
</span></span><span id="111" class="l"><a class="l" href="#111"> 111: </a><span class="php-comment">     * Are we in Rich Text editor mode? Determined from $_GET[rte]
</span></span><span id="112" class="l"><a class="l" href="#112"> 112: </a><span class="php-comment">     * 
</span></span><span id="113" class="l"><a class="l" href="#113"> 113: </a><span class="php-comment">     * @var bool
</span></span><span id="114" class="l"><a class="l" href="#114"> 114: </a><span class="php-comment">     * 
</span></span><span id="115" class="l"><a class="l" href="#115"> 115: </a><span class="php-comment">     */</span>
</span><span id="116" class="l"><a class="l" href="#116"> 116: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$rte" href="#$rte">$rte</a></span> = <span class="php-keyword1">true</span>;
</span><span id="117" class="l"><a class="l" href="#117"> 117: </a>
</span><span id="118" class="l"><a class="l" href="#118"> 118: </a>    <span class="php-comment">/**
</span></span><span id="119" class="l"><a class="l" href="#119"> 119: </a><span class="php-comment">     * Field of type FieldtypeImage that edited image is part of
</span></span><span id="120" class="l"><a class="l" href="#120"> 120: </a><span class="php-comment">     * 
</span></span><span id="121" class="l"><a class="l" href="#121"> 121: </a><span class="php-comment">     * @var Field|null
</span></span><span id="122" class="l"><a class="l" href="#122"> 122: </a><span class="php-comment">     * 
</span></span><span id="123" class="l"><a class="l" href="#123"> 123: </a><span class="php-comment">     */</span>
</span><span id="124" class="l"><a class="l" href="#124"> 124: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$field" href="#$field">$field</a></span> = <span class="php-keyword1">null</span>;
</span><span id="125" class="l"><a class="l" href="#125"> 125: </a>
</span><span id="126" class="l"><a class="l" href="#126"> 126: </a>    <span class="php-comment">/**
</span></span><span id="127" class="l"><a class="l" href="#127"> 127: </a><span class="php-comment">     * Name of field of type FieldtypeImage that edited image is part of 
</span></span><span id="128" class="l"><a class="l" href="#128"> 128: </a><span class="php-comment">     * 
</span></span><span id="129" class="l"><a class="l" href="#129"> 129: </a><span class="php-comment">     * @var string
</span></span><span id="130" class="l"><a class="l" href="#130"> 130: </a><span class="php-comment">     * 
</span></span><span id="131" class="l"><a class="l" href="#131"> 131: </a><span class="php-comment">     */</span>
</span><span id="132" class="l"><a class="l" href="#132"> 132: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$fieldName" href="#$fieldName">$fieldName</a></span> = <span class="php-quote">''</span>;
</span><span id="133" class="l"><a class="l" href="#133"> 133: </a>
</span><span id="134" class="l"><a class="l" href="#134"> 134: </a>    <span class="php-comment">/**
</span></span><span id="135" class="l"><a class="l" href="#135"> 135: </a><span class="php-comment">     * If file being edited is a variation, $original is basename of the file it originated from 
</span></span><span id="136" class="l"><a class="l" href="#136"> 136: </a><span class="php-comment">     * 
</span></span><span id="137" class="l"><a class="l" href="#137"> 137: </a><span class="php-comment">     * @var string
</span></span><span id="138" class="l"><a class="l" href="#138"> 138: </a><span class="php-comment">     * 
</span></span><span id="139" class="l"><a class="l" href="#139"> 139: </a><span class="php-comment">     */</span>
</span><span id="140" class="l"><a class="l" href="#140"> 140: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$original" href="#$original">$original</a></span> = <span class="php-quote">''</span>;
</span><span id="141" class="l"><a class="l" href="#141"> 141: </a>
</span><span id="142" class="l"><a class="l" href="#142"> 142: </a>    <span class="php-comment">/**
</span></span><span id="143" class="l"><a class="l" href="#143"> 143: </a><span class="php-comment">     * Caption text for image when in RTE mode, can be provided in $_GET[caption]
</span></span><span id="144" class="l"><a class="l" href="#144"> 144: </a><span class="php-comment">     * 
</span></span><span id="145" class="l"><a class="l" href="#145"> 145: </a><span class="php-comment">     * @var string
</span></span><span id="146" class="l"><a class="l" href="#146"> 146: </a><span class="php-comment">     * 
</span></span><span id="147" class="l"><a class="l" href="#147"> 147: </a><span class="php-comment">     */</span>
</span><span id="148" class="l"><a class="l" href="#148"> 148: </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$caption" href="#$caption">$caption</a></span> = <span class="php-quote">''</span>;
</span><span id="149" class="l"><a class="l" href="#149"> 149: </a>
</span><span id="150" class="l"><a class="l" href="#150"> 150: </a>    <span class="php-comment">/**
</span></span><span id="151" class="l"><a class="l" href="#151"> 151: </a><span class="php-comment">     * Default module config settings
</span></span><span id="152" class="l"><a class="l" href="#152"> 152: </a><span class="php-comment">     * 
</span></span><span id="153" class="l"><a class="l" href="#153"> 153: </a><span class="php-comment">     * @var array
</span></span><span id="154" class="l"><a class="l" href="#154"> 154: </a><span class="php-comment">     * 
</span></span><span id="155" class="l"><a class="l" href="#155"> 155: </a><span class="php-comment">     */</span>
</span><span id="156" class="l"><a class="l" href="#156"> 156: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-var"><a id="$defaultConfig" href="#$defaultConfig">$defaultConfig</a></span> = <span class="php-keyword1">array</span>(
</span><span id="157" class="l"><a class="l" href="#157"> 157: </a>        <span class="php-quote">'hidpiDefault'</span> =&gt; <span class="php-num">0</span>, 
</span><span id="158" class="l"><a class="l" href="#158"> 158: </a>        <span class="php-quote">'skipFields'</span> =&gt; <span class="php-quote">''</span>,
</span><span id="159" class="l"><a class="l" href="#159"> 159: </a>        <span class="php-quote">'noSizeAttrs'</span> =&gt; <span class="php-num">0</span>,
</span><span id="160" class="l"><a class="l" href="#160"> 160: </a>        <span class="php-quote">'noThumbs'</span> =&gt; <span class="php-num">0</span>, 
</span><span id="161" class="l"><a class="l" href="#161"> 161: </a>        <span class="php-quote">'alignLeftClass'</span> =&gt; <span class="php-quote">'align_left'</span>,
</span><span id="162" class="l"><a class="l" href="#162"> 162: </a>        <span class="php-quote">'alignRightClass'</span> =&gt; <span class="php-quote">'align_right'</span>,
</span><span id="163" class="l"><a class="l" href="#163"> 163: </a>        <span class="php-quote">'alignCenterClass'</span> =&gt; <span class="php-quote">'align_center'</span>,
</span><span id="164" class="l"><a class="l" href="#164"> 164: </a>        );
</span><span id="165" class="l"><a class="l" href="#165"> 165: </a>
</span><span id="166" class="l"><a class="l" href="#166"> 166: </a>    <span class="php-comment">/**
</span></span><span id="167" class="l"><a class="l" href="#167"> 167: </a><span class="php-comment">     * Construct and set default configuration
</span></span><span id="168" class="l"><a class="l" href="#168"> 168: </a><span class="php-comment">     * 
</span></span><span id="169" class="l"><a class="l" href="#169"> 169: </a><span class="php-comment">     */</span>
</span><span id="170" class="l"><a class="l" href="#170"> 170: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="___construct" href="#___construct">__construct</a>() {
</span><span id="171" class="l"><a class="l" href="#171"> 171: </a>        <span class="php-keyword1">foreach</span>(self::<span class="php-var">$defaultConfig</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$value</span>) <span class="php-var">$this</span>-&gt;set(<span class="php-var">$key</span>, <span class="php-var">$value</span>);
</span><span id="172" class="l"><a class="l" href="#172"> 172: </a>        <span class="php-var">$this</span>-&gt;labels = <span class="php-keyword1">array</span>(
</span><span id="173" class="l"><a class="l" href="#173"> 173: </a>            <span class="php-quote">'width'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Width:'</span>),
</span><span id="174" class="l"><a class="l" href="#174"> 174: </a>            <span class="php-quote">'height'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Height:'</span>),
</span><span id="175" class="l"><a class="l" href="#175"> 175: </a>            <span class="php-quote">'top'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Top:'</span>),
</span><span id="176" class="l"><a class="l" href="#176"> 176: </a>            <span class="php-quote">'left'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Left:'</span>),
</span><span id="177" class="l"><a class="l" href="#177"> 177: </a>            <span class="php-quote">'hidpi'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'HiDPI/Retina'</span>),
</span><span id="178" class="l"><a class="l" href="#178"> 178: </a>            <span class="php-quote">'description'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Image description (alt attribute)'</span>),
</span><span id="179" class="l"><a class="l" href="#179"> 179: </a>            <span class="php-quote">'linkOriginal'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Link to larger/original version'</span>),
</span><span id="180" class="l"><a class="l" href="#180"> 180: </a>            <span class="php-quote">'resize'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Resize'</span>),
</span><span id="181" class="l"><a class="l" href="#181"> 181: </a>            <span class="php-quote">'useResize'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Save at this size?'</span>), 
</span><span id="182" class="l"><a class="l" href="#182"> 182: </a>            <span class="php-quote">'crop'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Crop'</span>),
</span><span id="183" class="l"><a class="l" href="#183"> 183: </a>            <span class="php-quote">'saveCrop'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Apply'</span>),
</span><span id="184" class="l"><a class="l" href="#184"> 184: </a>            <span class="php-quote">'max'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Maximize/full width'</span>),
</span><span id="185" class="l"><a class="l" href="#185"> 185: </a>            <span class="php-quote">'min'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Minimize/fit to screen'</span>),
</span><span id="186" class="l"><a class="l" href="#186"> 186: </a>            <span class="php-quote">'cancel'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Cancel'</span>),
</span><span id="187" class="l"><a class="l" href="#187"> 187: </a>            <span class="php-quote">'alignLeft'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Align Left'</span>),
</span><span id="188" class="l"><a class="l" href="#188"> 188: </a>            <span class="php-quote">'alignRight'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Align Right'</span>),
</span><span id="189" class="l"><a class="l" href="#189"> 189: </a>            <span class="php-quote">'alignCenter'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Align Center'</span>),
</span><span id="190" class="l"><a class="l" href="#190"> 190: </a>            <span class="php-quote">'saveReplace'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Save and Replace'</span>),
</span><span id="191" class="l"><a class="l" href="#191"> 191: </a>            <span class="php-quote">'saveCopy'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Save as Copy'</span>), 
</span><span id="192" class="l"><a class="l" href="#192"> 192: </a>            <span class="php-quote">'saving'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Saving...'</span>),
</span><span id="193" class="l"><a class="l" href="#193"> 193: </a>            <span class="php-quote">'updating'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Updating...'</span>), 
</span><span id="194" class="l"><a class="l" href="#194"> 194: </a>            <span class="php-quote">'yes'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Yes'</span>), 
</span><span id="195" class="l"><a class="l" href="#195"> 195: </a>            <span class="php-quote">'noUse'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'No, use %s'</span>),
</span><span id="196" class="l"><a class="l" href="#196"> 196: </a>            <span class="php-quote">'caption'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Caption?'</span>), 
</span><span id="197" class="l"><a class="l" href="#197"> 197: </a>            <span class="php-quote">'captionTip'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Caption text is entered in the editor after you insert the image.'</span>), 
</span><span id="198" class="l"><a class="l" href="#198"> 198: </a>            <span class="php-quote">'captionText'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Caption text here'</span>),
</span><span id="199" class="l"><a class="l" href="#199"> 199: </a>            <span class="php-quote">'rotateRight'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Rotate to the right'</span>), 
</span><span id="200" class="l"><a class="l" href="#200"> 200: </a>            <span class="php-quote">'rotateLeft'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Rotate to the left'</span>), 
</span><span id="201" class="l"><a class="l" href="#201"> 201: </a>            <span class="php-quote">'flipHorizontal'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Flip horizontal'</span>),
</span><span id="202" class="l"><a class="l" href="#202"> 202: </a>            <span class="php-quote">'flipVertical'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Flip vertical'</span>),
</span><span id="203" class="l"><a class="l" href="#203"> 203: </a>            <span class="php-quote">'noAccess'</span> =&gt; <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'You do not have access to edit images on this page.'</span>),
</span><span id="204" class="l"><a class="l" href="#204"> 204: </a>            <span class="php-quote">'demoMode'</span> =&gt; <span class="php-quote">&quot;Image editing functions are disabled in demo mode&quot;</span>,
</span><span id="205" class="l"><a class="l" href="#205"> 205: </a>        );
</span><span id="206" class="l"><a class="l" href="#206"> 206: </a>    }
</span><span id="207" class="l"><a class="l" href="#207"> 207: </a>
</span><span id="208" class="l"><a class="l" href="#208"> 208: </a>    <span class="php-comment">/**
</span></span><span id="209" class="l"><a class="l" href="#209"> 209: </a><span class="php-comment">     * Initialize and populate required variables from GET variables
</span></span><span id="210" class="l"><a class="l" href="#210"> 210: </a><span class="php-comment">     * 
</span></span><span id="211" class="l"><a class="l" href="#211"> 211: </a><span class="php-comment">     * @throws WireException
</span></span><span id="212" class="l"><a class="l" href="#212"> 212: </a><span class="php-comment">     * 
</span></span><span id="213" class="l"><a class="l" href="#213"> 213: </a><span class="php-comment">     */</span>
</span><span id="214" class="l"><a class="l" href="#214"> 214: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_init" href="#_init">init</a>() {
</span><span id="215" class="l"><a class="l" href="#215"> 215: </a>
</span><span id="216" class="l"><a class="l" href="#216"> 216: </a>        <span class="php-comment">// throw new WireException($this-&gt;labels['demoMode']);</span>
</span><span id="217" class="l"><a class="l" href="#217"> 217: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;config-&gt;demo) {
</span><span id="218" class="l"><a class="l" href="#218"> 218: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;urlSegmentStr != <span class="php-quote">'variations'</span>) {
</span><span id="219" class="l"><a class="l" href="#219"> 219: </a>                <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-var">$this</span>-&gt;labels[<span class="php-quote">'demoMode'</span>]);
</span><span id="220" class="l"><a class="l" href="#220"> 220: </a>            }
</span><span id="221" class="l"><a class="l" href="#221"> 221: </a>        }
</span><span id="222" class="l"><a class="l" href="#222"> 222: </a>        
</span><span id="223" class="l"><a class="l" href="#223"> 223: </a>        <span class="php-var">$this</span>-&gt;modules-&gt;get(<span class="php-quote">&quot;ProcessPageList&quot;</span>);
</span><span id="224" class="l"><a class="l" href="#224"> 224: </a>    
</span><span id="225" class="l"><a class="l" href="#225"> 225: </a>        <span class="php-var">$this</span>-&gt;rte = <span class="php-var">$this</span>-&gt;input-&gt;get(<span class="php-quote">'rte'</span>) !== <span class="php-keyword1">null</span> &amp;&amp; <span class="php-var">$this</span>-&gt;input-&gt;get(<span class="php-quote">'rte'</span>) == <span class="php-quote">&quot;0&quot;</span> ? <span class="php-keyword1">false</span> : <span class="php-keyword1">true</span>;
</span><span id="226" class="l"><a class="l" href="#226"> 226: </a>        <span class="php-var">$id</span> = (int) <span class="php-var">$this</span>-&gt;input-&gt;get-&gt;id; 
</span><span id="227" class="l"><a class="l" href="#227"> 227: </a>        <span class="php-var">$editID</span> = (int) <span class="php-var">$this</span>-&gt;input-&gt;get-&gt;edit_page_id; 
</span><span id="228" class="l"><a class="l" href="#228"> 228: </a>        
</span><span id="229" class="l"><a class="l" href="#229"> 229: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$editID</span>) {
</span><span id="230" class="l"><a class="l" href="#230"> 230: </a>            <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'session'</span>)-&gt;set(<span class="php-var">$this</span>, <span class="php-quote">'edit_page_id'</span>, <span class="php-var">$editID</span>); 
</span><span id="231" class="l"><a class="l" href="#231"> 231: </a>        } <span class="php-keyword1">else</span> {
</span><span id="232" class="l"><a class="l" href="#232"> 232: </a>            <span class="php-var">$editID</span> = (int) <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'session'</span>)-&gt;get(<span class="php-var">$this</span>, <span class="php-quote">'edit_page_id'</span>); 
</span><span id="233" class="l"><a class="l" href="#233"> 233: </a>        }
</span><span id="234" class="l"><a class="l" href="#234"> 234: </a>        
</span><span id="235" class="l"><a class="l" href="#235"> 235: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$editID</span>) {
</span><span id="236" class="l"><a class="l" href="#236"> 236: </a>            <span class="php-var">$this</span>-&gt;editorPage = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'pages'</span>)-&gt;get(<span class="php-var">$editID</span>); 
</span><span id="237" class="l"><a class="l" href="#237"> 237: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;editorPage-&gt;editable()) {
</span><span id="238" class="l"><a class="l" href="#238"> 238: </a>                <span class="php-var">$this</span>-&gt;editorPage = <span class="php-keyword1">null</span>;
</span><span id="239" class="l"><a class="l" href="#239"> 239: </a>                <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'session'</span>)-&gt;remove(<span class="php-var">$this</span>, <span class="php-quote">'edit_page_id'</span>); 
</span><span id="240" class="l"><a class="l" href="#240"> 240: </a>            }
</span><span id="241" class="l"><a class="l" href="#241"> 241: </a>        }
</span><span id="242" class="l"><a class="l" href="#242"> 242: </a>    
</span><span id="243" class="l"><a class="l" href="#243"> 243: </a>        <span class="php-var">$fieldName</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'sanitizer'</span>)-&gt;fieldName(<span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'field'</span>)); 
</span><span id="244" class="l"><a class="l" href="#244"> 244: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$fieldName</span>) {
</span><span id="245" class="l"><a class="l" href="#245"> 245: </a>            <span class="php-var">$this</span>-&gt;fieldName = <span class="php-var">$fieldName</span>; <span class="php-comment">// original</span>
</span><span id="246" class="l"><a class="l" href="#246"> 246: </a>            <span class="php-keyword1">if</span>(<span class="php-keyword2">strpos</span>(<span class="php-var">$fieldName</span>, <span class="php-quote">'_repeater'</span>) &amp;&amp; <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/_repeater\d+$/'</span>, <span class="php-var">$fieldName</span>, <span class="php-var">$matches</span>)) {
</span><span id="247" class="l"><a class="l" href="#247"> 247: </a>                <span class="php-var">$fieldName</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$matches</span>[<span class="php-num">0</span>], <span class="php-quote">''</span>, <span class="php-var">$fieldName</span>);
</span><span id="248" class="l"><a class="l" href="#248"> 248: </a>            } <span class="php-keyword1">else</span> <span class="php-keyword1">if</span>(<span class="php-keyword2">strpos</span>(<span class="php-var">$fieldName</span>, <span class="php-quote">'_LPID'</span>)) {
</span><span id="249" class="l"><a class="l" href="#249"> 249: </a>                <span class="php-keyword1">list</span>(<span class="php-var">$fieldName</span>, <span class="php-var">$lpid</span>) = <span class="php-keyword2">explode</span>(<span class="php-quote">'_LPID'</span>, <span class="php-var">$fieldName</span>);
</span><span id="250" class="l"><a class="l" href="#250"> 250: </a>                <span class="php-keyword1">if</span>(<span class="php-var">$lpid</span>) {} <span class="php-comment">// ignore</span>
</span><span id="251" class="l"><a class="l" href="#251"> 251: </a>            }
</span><span id="252" class="l"><a class="l" href="#252"> 252: </a>            <span class="php-var">$this</span>-&gt;field = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'fields'</span>)-&gt;get(<span class="php-var">$fieldName</span>); 
</span><span id="253" class="l"><a class="l" href="#253"> 253: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;field) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Unknown field </span><span class="php-var">$fieldName</span><span class="php-quote">&quot;</span>); 
</span><span id="254" class="l"><a class="l" href="#254"> 254: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;field-&gt;type <span class="php-keyword1">instanceof</span> FieldtypeImage) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Field </span><span class="php-var">$fieldName</span><span class="php-quote"> is not an instance of FieldtypeImage&quot;</span>); 
</span><span id="255" class="l"><a class="l" href="#255"> 255: </a>        }
</span><span id="256" class="l"><a class="l" href="#256"> 256: </a>        
</span><span id="257" class="l"><a class="l" href="#257"> 257: </a>        <span class="php-comment">// if no ID was specified, then retrieive ID from filename path, if it's there</span>
</span><span id="258" class="l"><a class="l" href="#258"> 258: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;input-&gt;get-&gt;<span class="php-keyword2">file</span> &amp;&amp; <span class="php-keyword2">preg_match</span>(<span class="php-quote">'{[/,]}'</span>, <span class="php-var">$this</span>-&gt;input-&gt;get-&gt;<span class="php-keyword2">file</span>)) {
</span><span id="259" class="l"><a class="l" href="#259"> 259: </a>            
</span><span id="260" class="l"><a class="l" href="#260"> 260: </a>            <span class="php-keyword1">if</span>(<span class="php-keyword2">preg_match</span>(<span class="php-quote">'{(\d+)[/,][^/,]+\.('</span> . <span class="php-var">$this</span>-&gt;extensions . <span class="php-quote">')$}iD'</span>, <span class="php-var">$this</span>-&gt;input-&gt;get-&gt;<span class="php-keyword2">file</span>, <span class="php-var">$matches</span>)) {
</span><span id="261" class="l"><a class="l" href="#261"> 261: </a>                <span class="php-comment">// ..........ID.../,filename.ext</span>
</span><span id="262" class="l"><a class="l" href="#262"> 262: </a>                <span class="php-comment">// format: 123/filename.jpg OR 123,filename.jpg</span>
</span><span id="263" class="l"><a class="l" href="#263"> 263: </a>                <span class="php-comment">// also covers new pagefileSecure URLs</span>
</span><span id="264" class="l"><a class="l" href="#264"> 264: </a>                <span class="php-var">$id</span> = (int) <span class="php-var">$matches</span>[<span class="php-num">1</span>]; 
</span><span id="265" class="l"><a class="l" href="#265"> 265: </a>                
</span><span id="266" class="l"><a class="l" href="#266"> 266: </a>            } <span class="php-keyword1">else</span> <span class="php-keyword1">if</span>(<span class="php-keyword2">preg_match</span>(<span class="php-quote">'{(/[\d/]+)/([-_.a-z0-9]+)\.('</span> . <span class="php-var">$this</span>-&gt;extensions . <span class="php-quote">')$}iD'</span>, <span class="php-var">$this</span>-&gt;input-&gt;get-&gt;<span class="php-keyword2">file</span>, <span class="php-var">$matches</span>)) {
</span><span id="267" class="l"><a class="l" href="#267"> 267: </a>                <span class="php-comment">// .................ID........filename........ext</span>
</span><span id="268" class="l"><a class="l" href="#268"> 268: </a>                <span class="php-comment">// extended asset path format: 1/2/3/filename.jpg</span>
</span><span id="269" class="l"><a class="l" href="#269"> 269: </a>                <span class="php-var">$id</span> = PagefilesManager::dirToPageID(<span class="php-var">$matches</span>[<span class="php-num">1</span>]); 
</span><span id="270" class="l"><a class="l" href="#270"> 270: </a>
</span><span id="271" class="l"><a class="l" href="#271"> 271: </a>            } <span class="php-keyword1">else</span> <span class="php-keyword1">if</span>(<span class="php-keyword2">preg_match</span>(<span class="php-quote">'{^'</span> . <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'config'</span>)-&gt;urls-&gt;root . <span class="php-quote">'([-_./a-zA-Z0-9]*/)'</span> . <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'config'</span>)-&gt;pagefileUrlPrefix . <span class="php-quote">'[^/]+\.('</span> . <span class="php-var">$this</span>-&gt;extensions . <span class="php-quote">')$}iD'</span>, <span class="php-var">$this</span>-&gt;input-&gt;get-&gt;<span class="php-keyword2">file</span>, <span class="php-var">$matches</span>)) {
</span><span id="272" class="l"><a class="l" href="#272"> 272: </a>                <span class="php-comment">// .............................../....................path/to/page.........................-?....................filename..........ext</span>
</span><span id="273" class="l"><a class="l" href="#273"> 273: </a>                <span class="php-comment">// legacy pagefileSecure URL format: /path/to/page/filename.jpg</span>
</span><span id="274" class="l"><a class="l" href="#274"> 274: </a>                <span class="php-comment">// @todo: does this still need to be here or can it be dropped?</span>
</span><span id="275" class="l"><a class="l" href="#275"> 275: </a>                <span class="php-var">$this</span>-&gt;page = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'pages'</span>)-&gt;get(<span class="php-quote">'/'</span> . <span class="php-var">$matches</span>[<span class="php-num">1</span>]);
</span><span id="276" class="l"><a class="l" href="#276"> 276: </a>                <span class="php-var">$id</span> = <span class="php-var">$this</span>-&gt;page-&gt;id;
</span><span id="277" class="l"><a class="l" href="#277"> 277: </a>            }
</span><span id="278" class="l"><a class="l" href="#278"> 278: </a>        }
</span><span id="279" class="l"><a class="l" href="#279"> 279: </a>        
</span><span id="280" class="l"><a class="l" href="#280"> 280: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$id</span>) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;No page specified&quot;</span>);
</span><span id="281" class="l"><a class="l" href="#281"> 281: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;page) <span class="php-var">$this</span>-&gt;page = <span class="php-var">$this</span>-&gt;pages-&gt;get(<span class="php-var">$id</span>); 
</span><span id="282" class="l"><a class="l" href="#282"> 282: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;page) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;No page specified&quot;</span>); 
</span><span id="283" class="l"><a class="l" href="#283"> 283: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;page-&gt;id) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Unknown page&quot;</span>); 
</span><span id="284" class="l"><a class="l" href="#284"> 284: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;editorPage) <span class="php-var">$this</span>-&gt;editorPage = <span class="php-var">$this</span>-&gt;page;
</span><span id="285" class="l"><a class="l" href="#285"> 285: </a>        
</span><span id="286" class="l"><a class="l" href="#286"> 286: </a>        <span class="php-comment">// if $this-&gt;page is a repeater item (for example), $this-&gt;masterPage is page it lives on</span>
</span><span id="287" class="l"><a class="l" href="#287"> 287: </a>        <span class="php-var">$p</span> = <span class="php-keyword1">null</span>;
</span><span id="288" class="l"><a class="l" href="#288"> 288: </a>        <span class="php-keyword1">if</span>(wireInstanceOf(<span class="php-var">$this</span>-&gt;page, <span class="php-quote">'RepeaterPage'</span>)) {
</span><span id="289" class="l"><a class="l" href="#289"> 289: </a>            <span class="php-comment">/** @var RepeaterPage $p */</span>
</span><span id="290" class="l"><a class="l" href="#290"> 290: </a>            <span class="php-var">$p</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="291" class="l"><a class="l" href="#291"> 291: </a>            <span class="php-keyword1">while</span>(wireInstanceOf(<span class="php-var">$p</span>, <span class="php-quote">'RepeaterPage'</span>)) {
</span><span id="292" class="l"><a class="l" href="#292"> 292: </a>                <span class="php-var">$p</span> = <span class="php-var">$p</span>-&gt;getForPage();
</span><span id="293" class="l"><a class="l" href="#293"> 293: </a>            }
</span><span id="294" class="l"><a class="l" href="#294"> 294: </a>        }
</span><span id="295" class="l"><a class="l" href="#295"> 295: </a>        <span class="php-var">$this</span>-&gt;masterPage = <span class="php-var">$p</span> &amp;&amp; <span class="php-var">$p</span>-&gt;id ? <span class="php-var">$p</span> : <span class="php-var">$this</span>-&gt;page; 
</span><span id="296" class="l"><a class="l" href="#296"> 296: </a>        
</span><span id="297" class="l"><a class="l" href="#297"> 297: </a>        <span class="php-comment">// note we use hasPermission('page-view') rather than viewable() here because</span>
</span><span id="298" class="l"><a class="l" href="#298"> 298: </a>        <span class="php-comment">// we want to allow pages without template files</span>
</span><span id="299" class="l"><a class="l" href="#299"> 299: </a>        <span class="php-var">$user</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'user'</span>);
</span><span id="300" class="l"><a class="l" href="#300"> 300: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$user</span>-&gt;hasPermission(<span class="php-quote">'page-view'</span>, <span class="php-var">$this</span>-&gt;page)) {
</span><span id="301" class="l"><a class="l" href="#301"> 301: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;page-&gt;id === <span class="php-var">$user</span>-&gt;id &amp;&amp; <span class="php-var">$fieldName</span>
</span><span id="302" class="l"><a class="l" href="#302"> 302: </a>                &amp;&amp; <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'PagePermissions'</span>)-&gt;userFieldEditable(<span class="php-var">$fieldName</span>)) {
</span><span id="303" class="l"><a class="l" href="#303"> 303: </a>                <span class="php-comment">// user editing allowed images field in their profile</span>
</span><span id="304" class="l"><a class="l" href="#304"> 304: </a>            } <span class="php-keyword1">else</span> <span class="php-keyword1">if</span>(wireInstanceOf(<span class="php-var">$this</span>-&gt;page, <span class="php-quote">'RepeaterPage'</span>)) {
</span><span id="305" class="l"><a class="l" href="#305"> 305: </a>                <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;masterPage-&gt;editable()) {
</span><span id="306" class="l"><a class="l" href="#306"> 306: </a>                    <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-var">$this</span>-&gt;labels[<span class="php-quote">'noAccess'</span>]);
</span><span id="307" class="l"><a class="l" href="#307"> 307: </a>                }
</span><span id="308" class="l"><a class="l" href="#308"> 308: </a>            } <span class="php-keyword1">else</span> {
</span><span id="309" class="l"><a class="l" href="#309"> 309: </a>                <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-var">$this</span>-&gt;labels[<span class="php-quote">'noAccess'</span>]);
</span><span id="310" class="l"><a class="l" href="#310"> 310: </a>            }
</span><span id="311" class="l"><a class="l" href="#311"> 311: </a>        }
</span><span id="312" class="l"><a class="l" href="#312"> 312: </a>
</span><span id="313" class="l"><a class="l" href="#313"> 313: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;input-&gt;get-&gt;winwidth) <span class="php-var">$this</span>-&gt;maxImageWidth = ((int) <span class="php-var">$this</span>-&gt;input-&gt;get-&gt;winwidth) - <span class="php-num">70</span>; 
</span><span id="314" class="l"><a class="l" href="#314"> 314: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;maxImageWidth &lt; <span class="php-num">400</span>) <span class="php-var">$this</span>-&gt;maxImageWidth = <span class="php-num">400</span>; 
</span><span id="315" class="l"><a class="l" href="#315"> 315: </a>        
</span><span id="316" class="l"><a class="l" href="#316"> 316: </a>        <span class="php-var">$this</span>-&gt;hidpi = ((int) <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'hidpi'</span>)) ? <span class="php-keyword1">true</span> : <span class="php-keyword1">false</span>;
</span><span id="317" class="l"><a class="l" href="#317"> 317: </a>        <span class="php-var">$hidpi</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'hidpi'</span>);
</span><span id="318" class="l"><a class="l" href="#318"> 318: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$hidpi</span> === <span class="php-keyword1">null</span> &amp;&amp; <span class="php-var">$this</span>-&gt;hidpiDefault) <span class="php-var">$hidpi</span> = <span class="php-keyword1">true</span>; 
</span><span id="319" class="l"><a class="l" href="#319"> 319: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;rte) <span class="php-var">$hidpi</span> = <span class="php-keyword1">false</span>; <span class="php-comment">// hidpi not applicable outside of RTE mode</span>
</span><span id="320" class="l"><a class="l" href="#320"> 320: </a>        <span class="php-var">$this</span>-&gt;hidpi = <span class="php-var">$hidpi</span> ? <span class="php-keyword1">true</span> : <span class="php-keyword1">false</span>;
</span><span id="321" class="l"><a class="l" href="#321"> 321: </a>    
</span><span id="322" class="l"><a class="l" href="#322"> 322: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;rte) <span class="php-var">$this</span>-&gt;caption = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'caption'</span>) ? <span class="php-keyword1">true</span> : <span class="php-keyword1">false</span>; 
</span><span id="323" class="l"><a class="l" href="#323"> 323: </a>        
</span><span id="324" class="l"><a class="l" href="#324"> 324: </a>        <span class="php-comment">// original used by InputfieldImage </span>
</span><span id="325" class="l"><a class="l" href="#325"> 325: </a>        <span class="php-var">$original</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'original'</span>); 
</span><span id="326" class="l"><a class="l" href="#326"> 326: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$original</span>) {
</span><span id="327" class="l"><a class="l" href="#327"> 327: </a>            <span class="php-var">$original</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'sanitizer'</span>)-&gt;filename(<span class="php-var">$original</span>);
</span><span id="328" class="l"><a class="l" href="#328"> 328: </a>            <span class="php-keyword1">if</span>(<span class="php-keyword2">is_file</span>(<span class="php-var">$this</span>-&gt;page-&gt;filesManager()-&gt;path . <span class="php-var">$original</span>)) {
</span><span id="329" class="l"><a class="l" href="#329"> 329: </a>                <span class="php-var">$this</span>-&gt;original = <span class="php-var">$original</span>;
</span><span id="330" class="l"><a class="l" href="#330"> 330: </a>            }
</span><span id="331" class="l"><a class="l" href="#331"> 331: </a>        }
</span><span id="332" class="l"><a class="l" href="#332"> 332: </a>
</span><span id="333" class="l"><a class="l" href="#333"> 333: </a>        parent::init();
</span><span id="334" class="l"><a class="l" href="#334"> 334: </a>    }
</span><span id="335" class="l"><a class="l" href="#335"> 335: </a>    
</span><span id="336" class="l"><a class="l" href="#336"> 336: </a>    <span class="php-comment">/**
</span></span><span id="337" class="l"><a class="l" href="#337"> 337: </a><span class="php-comment">     * Return the Pageimage object being edited
</span></span><span id="338" class="l"><a class="l" href="#338"> 338: </a><span class="php-comment">     * 
</span></span><span id="339" class="l"><a class="l" href="#339"> 339: </a><span class="php-comment">     * @param bool $getVariation Returns the variation specified in the URL. Otherwise returns original (default). 
</span></span><span id="340" class="l"><a class="l" href="#340"> 340: </a><span class="php-comment">     * @return Pageimage
</span></span><span id="341" class="l"><a class="l" href="#341"> 341: </a><span class="php-comment">     * @throws WireException
</span></span><span id="342" class="l"><a class="l" href="#342"> 342: </a><span class="php-comment">     * 
</span></span><span id="343" class="l"><a class="l" href="#343"> 343: </a><span class="php-comment">     */</span>
</span><span id="344" class="l"><a class="l" href="#344"> 344: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_getPageimage" href="#_getPageimage">getPageimage</a>(<span class="php-var">$getVariation</span> = <span class="php-keyword1">false</span>) {
</span><span id="345" class="l"><a class="l" href="#345"> 345: </a>
</span><span id="346" class="l"><a class="l" href="#346"> 346: </a>        <span class="php-var">$images</span> = <span class="php-var">$this</span>-&gt;getImages(<span class="php-var">$this</span>-&gt;page);
</span><span id="347" class="l"><a class="l" href="#347"> 347: </a>        <span class="php-var">$file</span> = <span class="php-keyword2">basename</span>(<span class="php-var">$this</span>-&gt;input-&gt;get-&gt;<span class="php-keyword2">file</span>);
</span><span id="348" class="l"><a class="l" href="#348"> 348: </a>        <span class="php-var">$variationFilename</span> = <span class="php-quote">''</span>;
</span><span id="349" class="l"><a class="l" href="#349"> 349: </a>        
</span><span id="350" class="l"><a class="l" href="#350"> 350: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword2">strpos</span>(<span class="php-var">$file</span>, <span class="php-quote">','</span>) === <span class="php-keyword1">false</span>) {
</span><span id="351" class="l"><a class="l" href="#351"> 351: </a>            <span class="php-comment">// prepend ID if it's not there, needed for ajax in-editor resize</span>
</span><span id="352" class="l"><a class="l" href="#352"> 352: </a>            <span class="php-var">$originalFilename</span> = <span class="php-var">$file</span>;
</span><span id="353" class="l"><a class="l" href="#353"> 353: </a>            <span class="php-var">$file</span> = <span class="php-var">$this</span>-&gt;page-&gt;id . <span class="php-quote">','</span> . <span class="php-var">$file</span>; 
</span><span id="354" class="l"><a class="l" href="#354"> 354: </a>        } <span class="php-keyword1">else</span> {
</span><span id="355" class="l"><a class="l" href="#355"> 355: </a>            <span class="php-comment">// already has a &quot;123,&quot; at beginning</span>
</span><span id="356" class="l"><a class="l" href="#356"> 356: </a>            <span class="php-keyword1">list</span>(<span class="php-var">$pageID</span>, <span class="php-var">$originalFilename</span>) = <span class="php-keyword2">explode</span>(<span class="php-quote">','</span>, <span class="php-var">$file</span>);
</span><span id="357" class="l"><a class="l" href="#357"> 357: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$pageID</span>) {} <span class="php-comment">// ignore</span>
</span><span id="358" class="l"><a class="l" href="#358"> 358: </a>        }
</span><span id="359" class="l"><a class="l" href="#359"> 359: </a>        
</span><span id="360" class="l"><a class="l" href="#360"> 360: </a>        <span class="php-var">$originalFilename</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'sanitizer'</span>)-&gt;filename(<span class="php-var">$originalFilename</span>, <span class="php-keyword1">false</span>, <span class="php-num">1024</span>);
</span><span id="361" class="l"><a class="l" href="#361"> 361: </a>        
</span><span id="362" class="l"><a class="l" href="#362"> 362: </a>        <span class="php-comment">// if requested file does not match one of our allowed extensions, abort</span>
</span><span id="363" class="l"><a class="l" href="#363"> 363: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/\.('</span> . <span class="php-var">$this</span>-&gt;extensions . <span class="php-quote">')$/iD'</span>, <span class="php-var">$file</span>, <span class="php-var">$matches</span>)) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Unknown image file&quot;</span>); 
</span><span id="364" class="l"><a class="l" href="#364"> 364: </a>
</span><span id="365" class="l"><a class="l" href="#365"> 365: </a>        <span class="php-comment">// get the original, non resized version, if present</span>
</span><span id="366" class="l"><a class="l" href="#366"> 366: </a>        <span class="php-comment">// format:            w x h    crop       -suffix</span>
</span><span id="367" class="l"><a class="l" href="#367"> 367: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/(\.(\d+)x(\d+)([a-z0-9]*)(-[-_.a-z0-9]+)?)\.'</span> . <span class="php-var">$matches</span>[<span class="php-num">1</span>] . <span class="php-quote">'$/'</span>, <span class="php-var">$file</span>, <span class="php-var">$matches</span>)) {
</span><span id="368" class="l"><a class="l" href="#368"> 368: </a>            <span class="php-comment">// filename referenced in $_GET['file'] IS a variation</span>
</span><span id="369" class="l"><a class="l" href="#369"> 369: </a>            <span class="php-comment">// Follows format: original.600x400-suffix1-suffix2.ext</span>
</span><span id="370" class="l"><a class="l" href="#370"> 370: </a>            <span class="php-var">$this</span>-&gt;editWidth = (int) <span class="php-var">$matches</span>[<span class="php-num">2</span>];
</span><span id="371" class="l"><a class="l" href="#371"> 371: </a>            <span class="php-var">$this</span>-&gt;editHeight = (int) <span class="php-var">$matches</span>[<span class="php-num">3</span>];
</span><span id="372" class="l"><a class="l" href="#372"> 372: </a>            <span class="php-var">$variationFilename</span> = <span class="php-var">$originalFilename</span>; 
</span><span id="373" class="l"><a class="l" href="#373"> 373: </a>            <span class="php-var">$originalFilename</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$matches</span>[<span class="php-num">1</span>], <span class="php-quote">''</span>, <span class="php-var">$originalFilename</span>); <span class="php-comment">// remove dimensions and optional suffix</span>
</span><span id="374" class="l"><a class="l" href="#374"> 374: </a>        } <span class="php-keyword1">else</span> {
</span><span id="375" class="l"><a class="l" href="#375"> 375: </a>            <span class="php-comment">// filename referenced in $_GET['file'] is NOT a variation</span>
</span><span id="376" class="l"><a class="l" href="#376"> 376: </a>            <span class="php-var">$getVariation</span> = <span class="php-keyword1">false</span>; 
</span><span id="377" class="l"><a class="l" href="#377"> 377: </a>        }
</span><span id="378" class="l"><a class="l" href="#378"> 378: </a>
</span><span id="379" class="l"><a class="l" href="#379"> 379: </a>        <span class="php-comment">// update $file as sanitized version and with original filename only</span>
</span><span id="380" class="l"><a class="l" href="#380"> 380: </a>        <span class="php-var">$file</span> = <span class="php-quote">&quot;</span><span class="php-var">{$this-&gt;page-&gt;id}</span><span class="php-quote">,</span><span class="php-var">$originalFilename</span><span class="php-quote">&quot;</span>; 
</span><span id="381" class="l"><a class="l" href="#381"> 381: </a>        
</span><span id="382" class="l"><a class="l" href="#382"> 382: </a>        <span class="php-comment">// if requested file is not one that we have, abort</span>
</span><span id="383" class="l"><a class="l" href="#383"> 383: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword2">array_key_exists</span>(<span class="php-var">$file</span>, <span class="php-var">$images</span>)) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Cannot find image file '</span><span class="php-var">$originalFilename</span><span class="php-quote">' on page: </span><span class="php-var">{$this-&gt;page-&gt;path}</span><span class="php-quote">&quot;</span>);
</span><span id="384" class="l"><a class="l" href="#384"> 384: </a>
</span><span id="385" class="l"><a class="l" href="#385"> 385: </a>        <span class="php-comment">// return original</span>
</span><span id="386" class="l"><a class="l" href="#386"> 386: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$getVariation</span>) <span class="php-keyword1">return</span> <span class="php-var">$images</span>[<span class="php-var">$file</span>];
</span><span id="387" class="l"><a class="l" href="#387"> 387: </a>        
</span><span id="388" class="l"><a class="l" href="#388"> 388: </a>        <span class="php-comment">// get variation</span>
</span><span id="389" class="l"><a class="l" href="#389"> 389: </a>        <span class="php-var">$original</span> = <span class="php-var">$images</span>[<span class="php-var">$file</span>]; 
</span><span id="390" class="l"><a class="l" href="#390"> 390: </a>        <span class="php-var">$variationPathname</span> = <span class="php-var">$original</span>-&gt;pagefiles-&gt;path() . <span class="php-var">$variationFilename</span>; 
</span><span id="391" class="l"><a class="l" href="#391"> 391: </a>        <span class="php-var">$pageimage</span> = <span class="php-keyword1">null</span>;
</span><span id="392" class="l"><a class="l" href="#392"> 392: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword2">is_file</span>(<span class="php-var">$variationPathname</span>)) <span class="php-var">$pageimage</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-keyword1">new</span> Pageimage(<span class="php-var">$original</span>-&gt;pagefiles, <span class="php-var">$variationPathname</span>)); 
</span><span id="393" class="l"><a class="l" href="#393"> 393: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$pageimage</span>) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Unrecognized variation file: </span><span class="php-var">$file</span><span class="php-quote">&quot;</span>); 
</span><span id="394" class="l"><a class="l" href="#394"> 394: </a>        
</span><span id="395" class="l"><a class="l" href="#395"> 395: </a>        <span class="php-keyword1">return</span> <span class="php-var">$pageimage</span>; 
</span><span id="396" class="l"><a class="l" href="#396"> 396: </a>    }
</span><span id="397" class="l"><a class="l" href="#397"> 397: </a>
</span><span id="398" class="l"><a class="l" href="#398"> 398: </a>    <span class="php-comment">/**
</span></span><span id="399" class="l"><a class="l" href="#399"> 399: </a><span class="php-comment">     * Get all Pageimage objects on page
</span></span><span id="400" class="l"><a class="l" href="#400"> 400: </a><span class="php-comment">     * 
</span></span><span id="401" class="l"><a class="l" href="#401"> 401: </a><span class="php-comment">     * @param Page $page
</span></span><span id="402" class="l"><a class="l" href="#402"> 402: </a><span class="php-comment">     * @param array|WireArray $fields
</span></span><span id="403" class="l"><a class="l" href="#403"> 403: </a><span class="php-comment">     * @param int $level Recursion level (internal use)
</span></span><span id="404" class="l"><a class="l" href="#404"> 404: </a><span class="php-comment">     * @return array
</span></span><span id="405" class="l"><a class="l" href="#405"> 405: </a><span class="php-comment">     * 
</span></span><span id="406" class="l"><a class="l" href="#406"> 406: </a><span class="php-comment">     */</span>
</span><span id="407" class="l"><a class="l" href="#407"> 407: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_getImages" href="#_getImages">getImages</a>(Page <span class="php-var">$page</span>, <span class="php-var">$fields</span> = <span class="php-keyword1">array</span>(), <span class="php-var">$level</span> = <span class="php-num">0</span>) {
</span><span id="408" class="l"><a class="l" href="#408"> 408: </a>        
</span><span id="409" class="l"><a class="l" href="#409"> 409: </a>        <span class="php-var">$allImages</span> = <span class="php-keyword1">array</span>();
</span><span id="410" class="l"><a class="l" href="#410"> 410: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$page</span>-&gt;id) <span class="php-keyword1">return</span> <span class="php-var">$allImages</span>; 
</span><span id="411" class="l"><a class="l" href="#411"> 411: </a>        
</span><span id="412" class="l"><a class="l" href="#412"> 412: </a>        <span class="php-var">$numImages</span> = <span class="php-num">0</span>;
</span><span id="413" class="l"><a class="l" href="#413"> 413: </a>        <span class="php-var">$numImageFields</span> = <span class="php-num">0</span>;
</span><span id="414" class="l"><a class="l" href="#414"> 414: </a>        <span class="php-var">$skipFields</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;urlSegment1 ? <span class="php-keyword1">array</span>() : <span class="php-keyword2">explode</span>(<span class="php-quote">' '</span>, <span class="php-var">$this</span>-&gt;skipFields);
</span><span id="415" class="l"><a class="l" href="#415"> 415: </a>    
</span><span id="416" class="l"><a class="l" href="#416"> 416: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword1">empty</span>(<span class="php-var">$fields</span>)) {
</span><span id="417" class="l"><a class="l" href="#417"> 417: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;field) {
</span><span id="418" class="l"><a class="l" href="#418"> 418: </a>                <span class="php-var">$fields</span> = <span class="php-keyword1">array</span>(<span class="php-var">$this</span>-&gt;field);
</span><span id="419" class="l"><a class="l" href="#419"> 419: </a>                <span class="php-var">$skipFields</span> = <span class="php-keyword1">array</span>();
</span><span id="420" class="l"><a class="l" href="#420"> 420: </a>            } <span class="php-keyword1">else</span> {
</span><span id="421" class="l"><a class="l" href="#421"> 421: </a>                <span class="php-var">$fields</span> = <span class="php-var">$page</span>-&gt;fields;
</span><span id="422" class="l"><a class="l" href="#422"> 422: </a>            }
</span><span id="423" class="l"><a class="l" href="#423"> 423: </a>        }
</span><span id="424" class="l"><a class="l" href="#424"> 424: </a>
</span><span id="425" class="l"><a class="l" href="#425"> 425: </a>        <span class="php-keyword1">foreach</span>(<span class="php-var">$fields</span> <span class="php-keyword1">as</span> <span class="php-var">$field</span>) {
</span><span id="426" class="l"><a class="l" href="#426"> 426: </a>
</span><span id="427" class="l"><a class="l" href="#427"> 427: </a>            <span class="php-keyword1">if</span>(<span class="php-keyword2">in_array</span>(<span class="php-var">$field</span>-&gt;name, <span class="php-var">$skipFields</span>)) <span class="php-keyword1">continue</span>; 
</span><span id="428" class="l"><a class="l" href="#428"> 428: </a>
</span><span id="429" class="l"><a class="l" href="#429"> 429: </a>            <span class="php-keyword1">if</span>(wireInstanceOf(<span class="php-var">$field</span>-&gt;type, <span class="php-quote">'FieldtypeRepeater'</span>)) {
</span><span id="430" class="l"><a class="l" href="#430"> 430: </a>                <span class="php-comment">// get images that are possibly in a repeater</span>
</span><span id="431" class="l"><a class="l" href="#431"> 431: </a>                <span class="php-var">$repeaterValue</span> = <span class="php-var">$page</span>-&gt;get(<span class="php-var">$field</span>-&gt;name); 
</span><span id="432" class="l"><a class="l" href="#432"> 432: </a>                <span class="php-keyword1">if</span>(<span class="php-var">$repeaterValue</span> <span class="php-keyword1">instanceof</span> Page) <span class="php-var">$repeaterValue</span> = <span class="php-keyword1">array</span>(<span class="php-var">$repeaterValue</span>); 
</span><span id="433" class="l"><a class="l" href="#433"> 433: </a>                <span class="php-keyword1">if</span>(<span class="php-var">$repeaterValue</span>) <span class="php-keyword1">foreach</span>(<span class="php-var">$repeaterValue</span> <span class="php-keyword1">as</span> <span class="php-var">$p</span>) {
</span><span id="434" class="l"><a class="l" href="#434"> 434: </a>                    <span class="php-var">$images</span> = <span class="php-var">$this</span>-&gt;getImages(<span class="php-var">$p</span>, <span class="php-var">$p</span>-&gt;fields, <span class="php-var">$level</span>+<span class="php-num">1</span>); 
</span><span id="435" class="l"><a class="l" href="#435"> 435: </a>                    <span class="php-keyword1">if</span>(!<span class="php-keyword2">count</span>(<span class="php-var">$images</span>)) <span class="php-keyword1">continue</span>; 
</span><span id="436" class="l"><a class="l" href="#436"> 436: </a>                    <span class="php-var">$allImages</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$allImages</span>, <span class="php-var">$images</span>);
</span><span id="437" class="l"><a class="l" href="#437"> 437: </a>                    <span class="php-var">$numImages</span> += <span class="php-keyword2">count</span>(<span class="php-var">$images</span>); 
</span><span id="438" class="l"><a class="l" href="#438"> 438: </a>                    <span class="php-var">$numImageFields</span>++;
</span><span id="439" class="l"><a class="l" href="#439"> 439: </a>                }
</span><span id="440" class="l"><a class="l" href="#440"> 440: </a>                <span class="php-keyword1">continue</span>; 
</span><span id="441" class="l"><a class="l" href="#441"> 441: </a>            }
</span><span id="442" class="l"><a class="l" href="#442"> 442: </a>
</span><span id="443" class="l"><a class="l" href="#443"> 443: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$field</span>-&gt;type <span class="php-keyword1">instanceof</span> FieldtypeImage) <span class="php-keyword1">continue</span>; 
</span><span id="444" class="l"><a class="l" href="#444"> 444: </a>            <span class="php-var">$numImageFields</span>++;
</span><span id="445" class="l"><a class="l" href="#445"> 445: </a>            <span class="php-var">$images</span> = <span class="php-var">$page</span>-&gt;getUnformatted(<span class="php-var">$field</span>-&gt;name); 
</span><span id="446" class="l"><a class="l" href="#446"> 446: </a>            <span class="php-keyword1">if</span>(!wireCount(<span class="php-var">$images</span>)) <span class="php-keyword1">continue</span>; 
</span><span id="447" class="l"><a class="l" href="#447"> 447: </a>
</span><span id="448" class="l"><a class="l" href="#448"> 448: </a>            <span class="php-keyword1">foreach</span>(<span class="php-var">$images</span> <span class="php-keyword1">as</span> <span class="php-var">$image</span>) {
</span><span id="449" class="l"><a class="l" href="#449"> 449: </a>                <span class="php-var">$numImages</span>++;
</span><span id="450" class="l"><a class="l" href="#450"> 450: </a>                <span class="php-var">$key</span> = <span class="php-var">$page</span>-&gt;id . <span class="php-quote">','</span> . <span class="php-var">$image</span>-&gt;<span class="php-keyword2">basename</span>;  <span class="php-comment">// page_id,basename for repeater support</span>
</span><span id="451" class="l"><a class="l" href="#451"> 451: </a>                <span class="php-var">$allImages</span>[<span class="php-var">$key</span>] = <span class="php-var">$image</span>; 
</span><span id="452" class="l"><a class="l" href="#452"> 452: </a>            }
</span><span id="453" class="l"><a class="l" href="#453"> 453: </a>        }
</span><span id="454" class="l"><a class="l" href="#454"> 454: </a>
</span><span id="455" class="l"><a class="l" href="#455"> 455: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$level</span>) {
</span><span id="456" class="l"><a class="l" href="#456"> 456: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$numImageFields</span>) <span class="php-var">$this</span>-&gt;message(<span class="php-var">$this</span>-&gt;_(<span class="php-quote">&quot;There are no image fields on this page. Choose another page to select images from.&quot;</span>)); <span class="php-comment">// Message when page has no image fields</span>
</span><span id="457" class="l"><a class="l" href="#457"> 457: </a>                <span class="php-keyword1">else</span> <span class="php-keyword1">if</span>(!<span class="php-var">$numImages</span>) <span class="php-var">$this</span>-&gt;message(<span class="php-var">$this</span>-&gt;_(<span class="php-quote">&quot;There are no images present on this page. Upload an image, or select images from another page.&quot;</span>));  <span class="php-comment">// Message when page has no images</span>
</span><span id="458" class="l"><a class="l" href="#458"> 458: </a>        }
</span><span id="459" class="l"><a class="l" href="#459"> 459: </a>
</span><span id="460" class="l"><a class="l" href="#460"> 460: </a>        <span class="php-keyword1">return</span> <span class="php-var">$allImages</span>; 
</span><span id="461" class="l"><a class="l" href="#461"> 461: </a>    }
</span><span id="462" class="l"><a class="l" href="#462"> 462: </a>
</span><span id="463" class="l"><a class="l" href="#463"> 463: </a>    <span class="php-comment">/**
</span></span><span id="464" class="l"><a class="l" href="#464"> 464: </a><span class="php-comment">     * Get all editable image fields on the page
</span></span><span id="465" class="l"><a class="l" href="#465"> 465: </a><span class="php-comment">     * 
</span></span><span id="466" class="l"><a class="l" href="#466"> 466: </a><span class="php-comment">     * @param Page $page
</span></span><span id="467" class="l"><a class="l" href="#467"> 467: </a><span class="php-comment">     * @param bool $excludeFullFields Exclude fields that are already full? (i.e. can't add more images to them)
</span></span><span id="468" class="l"><a class="l" href="#468"> 468: </a><span class="php-comment">     * @return array of Field objects for image fields
</span></span><span id="469" class="l"><a class="l" href="#469"> 469: </a><span class="php-comment">     * 
</span></span><span id="470" class="l"><a class="l" href="#470"> 470: </a><span class="php-comment">     */</span>
</span><span id="471" class="l"><a class="l" href="#471"> 471: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_getImageFields" href="#_getImageFields">getImageFields</a>(Page <span class="php-var">$page</span>, <span class="php-var">$excludeFullFields</span> = <span class="php-keyword1">true</span>) {
</span><span id="472" class="l"><a class="l" href="#472"> 472: </a>        
</span><span id="473" class="l"><a class="l" href="#473"> 473: </a>        <span class="php-var">$skipFields</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">' '</span>, <span class="php-var">$this</span>-&gt;skipFields);
</span><span id="474" class="l"><a class="l" href="#474"> 474: </a>        <span class="php-var">$imageFields</span> = <span class="php-keyword1">array</span>();
</span><span id="475" class="l"><a class="l" href="#475"> 475: </a>
</span><span id="476" class="l"><a class="l" href="#476"> 476: </a>        <span class="php-keyword1">foreach</span>(<span class="php-var">$page</span>-&gt;fields <span class="php-keyword1">as</span> <span class="php-var">$field</span>) {
</span><span id="477" class="l"><a class="l" href="#477"> 477: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$field</span>-&gt;type <span class="php-keyword1">instanceof</span> FieldtypeImage) <span class="php-keyword1">continue</span>;
</span><span id="478" class="l"><a class="l" href="#478"> 478: </a>            <span class="php-keyword1">if</span>(<span class="php-keyword2">in_array</span>(<span class="php-var">$field</span>-&gt;name, <span class="php-var">$skipFields</span>)) <span class="php-keyword1">continue</span>;
</span><span id="479" class="l"><a class="l" href="#479"> 479: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$page</span>-&gt;editable(<span class="php-var">$field</span>-&gt;name)) <span class="php-keyword1">continue</span>; 
</span><span id="480" class="l"><a class="l" href="#480"> 480: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$excludeFullFields</span> &amp;&amp; <span class="php-var">$field</span>-&gt;maxFiles &gt; <span class="php-num">0</span>) {
</span><span id="481" class="l"><a class="l" href="#481"> 481: </a>                <span class="php-keyword1">if</span>(<span class="php-keyword2">count</span>(<span class="php-var">$page</span>-&gt;get(<span class="php-var">$field</span>-&gt;name)) &gt;= <span class="php-var">$field</span>-&gt;maxFiles) <span class="php-keyword1">continue</span>; 
</span><span id="482" class="l"><a class="l" href="#482"> 482: </a>            }
</span><span id="483" class="l"><a class="l" href="#483"> 483: </a>            <span class="php-var">$imageFields</span>[<span class="php-var">$field</span>-&gt;name] = <span class="php-var">$field</span>;
</span><span id="484" class="l"><a class="l" href="#484"> 484: </a>        }
</span><span id="485" class="l"><a class="l" href="#485"> 485: </a>        <span class="php-keyword1">return</span> <span class="php-var">$imageFields</span>; 
</span><span id="486" class="l"><a class="l" href="#486"> 486: </a>    }
</span><span id="487" class="l"><a class="l" href="#487"> 487: </a>
</span><span id="488" class="l"><a class="l" href="#488"> 488: </a>    <span class="php-comment">/**
</span></span><span id="489" class="l"><a class="l" href="#489"> 489: </a><span class="php-comment">     * Default execute: display list of images on page for selection
</span></span><span id="490" class="l"><a class="l" href="#490"> 490: </a><span class="php-comment">     * 
</span></span><span id="491" class="l"><a class="l" href="#491"> 491: </a><span class="php-comment">     * @return string
</span></span><span id="492" class="l"><a class="l" href="#492"> 492: </a><span class="php-comment">     * @throws WireException
</span></span><span id="493" class="l"><a class="l" href="#493"> 493: </a><span class="php-comment">     * 
</span></span><span id="494" class="l"><a class="l" href="#494"> 494: </a><span class="php-comment">     */</span>
</span><span id="495" class="l"><a class="l" href="#495"> 495: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="____execute" href="#____execute">___execute</a>() {
</span><span id="496" class="l"><a class="l" href="#496"> 496: </a>
</span><span id="497" class="l"><a class="l" href="#497"> 497: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;config-&gt;demo) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Sorry, image editing functions are disabled in demo mode&quot;</span>); 
</span><span id="498" class="l"><a class="l" href="#498"> 498: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;page) {
</span><span id="499" class="l"><a class="l" href="#499"> 499: </a>            <span class="php-var">$error</span> = <span class="php-quote">&quot;No page provided&quot;</span>;
</span><span id="500" class="l"><a class="l" href="#500"> 500: </a>            <span class="php-var">$this</span>-&gt;error(<span class="php-var">$error</span>);
</span><span id="501" class="l"><a class="l" href="#501"> 501: </a>            <span class="php-keyword1">return</span> <span class="php-quote">&quot;&lt;p&gt;</span><span class="php-var">$error</span><span class="php-quote">&lt;/p&gt;&quot;</span>;
</span><span id="502" class="l"><a class="l" href="#502"> 502: </a>        }
</span><span id="503" class="l"><a class="l" href="#503"> 503: </a>
</span><span id="504" class="l"><a class="l" href="#504"> 504: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;input-&gt;get-&gt;<span class="php-keyword2">file</span>) <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;executeEdit();
</span><span id="505" class="l"><a class="l" href="#505"> 505: </a>        
</span><span id="506" class="l"><a class="l" href="#506"> 506: </a>        <span class="php-var">$images</span> = <span class="php-var">$this</span>-&gt;getImages(<span class="php-var">$this</span>-&gt;page, <span class="php-var">$this</span>-&gt;page-&gt;fields);
</span><span id="507" class="l"><a class="l" href="#507"> 507: </a>
</span><span id="508" class="l"><a class="l" href="#508"> 508: </a>        <span class="php-var">$out</span> = <span class="php-quote">''</span>;
</span><span id="509" class="l"><a class="l" href="#509"> 509: </a>
</span><span id="510" class="l"><a class="l" href="#510"> 510: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword2">count</span>(<span class="php-var">$images</span>)) {
</span><span id="511" class="l"><a class="l" href="#511"> 511: </a>            <span class="php-var">$winwidth</span> = (int) <span class="php-var">$this</span>-&gt;input-&gt;get-&gt;winwidth;
</span><span id="512" class="l"><a class="l" href="#512"> 512: </a>            <span class="php-var">$in</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldImage'</span>); 
</span><span id="513" class="l"><a class="l" href="#513"> 513: </a>            <span class="php-var">$in</span>-&gt;adminThumbs = <span class="php-keyword1">true</span>;
</span><span id="514" class="l"><a class="l" href="#514"> 514: </a>            
</span><span id="515" class="l"><a class="l" href="#515"> 515: </a>            <span class="php-keyword1">foreach</span>(<span class="php-var">$images</span> <span class="php-keyword1">as</span> <span class="php-var">$image</span>) {
</span><span id="516" class="l"><a class="l" href="#516"> 516: </a>                <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;noThumbs) {
</span><span id="517" class="l"><a class="l" href="#517"> 517: </a>                    <span class="php-var">$width</span> = <span class="php-var">$image</span>-&gt;width();
</span><span id="518" class="l"><a class="l" href="#518"> 518: </a>                    <span class="php-var">$alt</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'sanitizer'</span>)-&gt;entities1(<span class="php-var">$image</span>-&gt;description); 
</span><span id="519" class="l"><a class="l" href="#519"> 519: </a>                    <span class="php-keyword1">if</span>(<span class="php-var">$width</span> &gt; <span class="php-var">$this</span>-&gt;maxImageWidth) <span class="php-var">$width</span> = <span class="php-var">$this</span>-&gt;maxImageWidth;
</span><span id="520" class="l"><a class="l" href="#520"> 520: </a>                    <span class="php-var">$img</span> = <span class="php-quote">&quot;&lt;img src='</span><span class="php-var">$image</span><span class="php-quote">-&gt;URL' width='</span><span class="php-var">$width</span><span class="php-quote">' alt=\&quot;</span><span class="php-var">$alt</span><span class="php-quote">\&quot; /&gt;&quot;</span>;
</span><span id="521" class="l"><a class="l" href="#521"> 521: </a>                } <span class="php-keyword1">else</span> {
</span><span id="522" class="l"><a class="l" href="#522"> 522: </a>                    <span class="php-var">$image</span>-&gt;set(<span class="php-quote">'_requireHeight'</span>, <span class="php-keyword1">true</span>); <span class="php-comment">// recognized by InputfieldImage</span>
</span><span id="523" class="l"><a class="l" href="#523"> 523: </a>                    <span class="php-var">$info</span> = <span class="php-var">$in</span>-&gt;getAdminThumb(<span class="php-var">$image</span>); 
</span><span id="524" class="l"><a class="l" href="#524"> 524: </a>                    <span class="php-var">$img</span> = <span class="php-var">$info</span>[<span class="php-quote">'markup'</span>];
</span><span id="525" class="l"><a class="l" href="#525"> 525: </a>                }
</span><span id="526" class="l"><a class="l" href="#526"> 526: </a>                <span class="php-var">$out</span> .= <span class="php-quote">&quot;\n\t&lt;li&gt;&lt;a href='./edit?file=</span><span class="php-var">{$image-&gt;page-&gt;id}</span><span class="php-quote">,</span><span class="php-var">{$image-&gt;basename}</span><span class="php-quote">&quot;</span> . 
</span><span id="527" class="l"><a class="l" href="#527"> 527: </a>                    <span class="php-quote">&quot;&amp;amp;modal=1&amp;amp;id=</span><span class="php-var">{$this-&gt;page-&gt;id}</span><span class="php-quote">&amp;amp;winwidth=</span><span class="php-var">$winwidth</span><span class="php-quote">'&gt;</span><span class="php-var">$img</span><span class="php-quote">&lt;/a&gt;&lt;/li&gt;&quot;</span>;
</span><span id="528" class="l"><a class="l" href="#528"> 528: </a>            }
</span><span id="529" class="l"><a class="l" href="#529"> 529: </a>
</span><span id="530" class="l"><a class="l" href="#530"> 530: </a>            <span class="php-var">$class</span> = <span class="php-var">$this</span>-&gt;noThumbs ? <span class="php-quote">&quot;&quot;</span> : <span class="php-quote">&quot;thumbs&quot;</span>;
</span><span id="531" class="l"><a class="l" href="#531"> 531: </a>            <span class="php-var">$out</span> = <span class="php-quote">&quot;\n&lt;ul id='select_images' class='</span><span class="php-var">$class</span><span class="php-quote">'&gt;</span><span class="php-var">$out</span><span class="php-quote">\n&lt;/ul&gt;&quot;</span>;
</span><span id="532" class="l"><a class="l" href="#532"> 532: </a>
</span><span id="533" class="l"><a class="l" href="#533"> 533: </a>        }
</span><span id="534" class="l"><a class="l" href="#534"> 534: </a>
</span><span id="535" class="l"><a class="l" href="#535"> 535: </a>        <span class="php-comment">/** @var InputfieldForm $form */</span>
</span><span id="536" class="l"><a class="l" href="#536"> 536: </a>        <span class="php-var">$form</span> = <span class="php-var">$this</span>-&gt;modules-&gt;get(<span class="php-quote">&quot;InputfieldForm&quot;</span>);
</span><span id="537" class="l"><a class="l" href="#537"> 537: </a>        <span class="php-var">$form</span>-&gt;action = <span class="php-quote">&quot;./&quot;</span>; 
</span><span id="538" class="l"><a class="l" href="#538"> 538: </a>        <span class="php-var">$form</span>-&gt;method = <span class="php-quote">&quot;get&quot;</span>;
</span><span id="539" class="l"><a class="l" href="#539"> 539: </a>
</span><span id="540" class="l"><a class="l" href="#540"> 540: </a>        <span class="php-comment">/** @var InputfieldPageListSelect $field */</span>
</span><span id="541" class="l"><a class="l" href="#541"> 541: </a>        <span class="php-var">$field</span> = <span class="php-var">$this</span>-&gt;modules-&gt;get(<span class="php-quote">&quot;InputfieldPageListSelect&quot;</span>); 
</span><span id="542" class="l"><a class="l" href="#542"> 542: </a>        <span class="php-var">$field</span>-&gt;label = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">&quot;Images on Page:&quot;</span>) . <span class="php-quote">' '</span> . <span class="php-var">$this</span>-&gt;page-&gt;get(<span class="php-quote">&quot;title&quot;</span>) . <span class="php-quote">&quot; (&quot;</span> . <span class="php-var">$this</span>-&gt;page-&gt;path . <span class="php-quote">&quot;)&quot;</span>; <span class="php-comment">// Headline for page selection, precedes current page title/url</span>
</span><span id="543" class="l"><a class="l" href="#543"> 543: </a>        <span class="php-var">$field</span>-&gt;description = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">&quot;If you would like to select images from another page, select the page below.&quot;</span>); <span class="php-comment">// Instruction on how to select another page</span>
</span><span id="544" class="l"><a class="l" href="#544"> 544: </a>        <span class="php-var">$field</span>-&gt;attr(<span class="php-quote">'id+name'</span>, <span class="php-quote">'page_id'</span>); 
</span><span id="545" class="l"><a class="l" href="#545"> 545: </a>        <span class="php-var">$field</span>-&gt;value = <span class="php-var">$this</span>-&gt;page-&gt;id; 
</span><span id="546" class="l"><a class="l" href="#546"> 546: </a>        <span class="php-var">$field</span>-&gt;parent_id = <span class="php-num">0</span>; 
</span><span id="547" class="l"><a class="l" href="#547"> 547: </a>        <span class="php-var">$field</span>-&gt;collapsed = <span class="php-keyword2">count</span>(<span class="php-var">$images</span>) ? Inputfield::collapsedYes : Inputfield::collapsedNo;
</span><span id="548" class="l"><a class="l" href="#548"> 548: </a>        <span class="php-var">$field</span>-&gt;required = <span class="php-keyword1">true</span>; 
</span><span id="549" class="l"><a class="l" href="#549"> 549: </a>        <span class="php-var">$form</span>-&gt;append(<span class="php-var">$field</span>);
</span><span id="550" class="l"><a class="l" href="#550"> 550: </a>        
</span><span id="551" class="l"><a class="l" href="#551"> 551: </a>        <span class="php-comment">// locate any image fields</span>
</span><span id="552" class="l"><a class="l" href="#552"> 552: </a>        <span class="php-var">$imageFields</span> = <span class="php-var">$this</span>-&gt;getImageFields(<span class="php-var">$this</span>-&gt;page);
</span><span id="553" class="l"><a class="l" href="#553"> 553: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword2">count</span>(<span class="php-var">$imageFields</span>)) {
</span><span id="554" class="l"><a class="l" href="#554"> 554: </a>            <span class="php-var">$imageFieldNames</span> = <span class="php-keyword2">implode</span>(<span class="php-quote">','</span>, <span class="php-keyword2">array_keys</span>(<span class="php-var">$imageFields</span>)); 
</span><span id="555" class="l"><a class="l" href="#555"> 555: </a>            <span class="php-comment">/** @var InputfieldButton $btn */</span>
</span><span id="556" class="l"><a class="l" href="#556"> 556: </a>            <span class="php-var">$btn</span> = <span class="php-var">$this</span>-&gt;modules-&gt;get(<span class="php-quote">'InputfieldButton'</span>);
</span><span id="557" class="l"><a class="l" href="#557"> 557: </a>            <span class="php-var">$uploadOnlyMode</span> = <span class="php-quote">&quot;</span><span class="php-var">$this</span><span class="php-quote">-&gt;page&quot;</span> === <span class="php-quote">&quot;</span><span class="php-var">$this</span><span class="php-quote">-&gt;editorPage&quot;</span> ? <span class="php-num">1</span> : <span class="php-num">2</span>;
</span><span id="558" class="l"><a class="l" href="#558"> 558: </a>            <span class="php-var">$btn</span>-&gt;href = <span class="php-quote">&quot;../edit/?modal=1&amp;id=</span><span class="php-var">{$this-&gt;page-&gt;id}</span><span class="php-quote">&amp;fields=</span><span class="php-var">$imageFieldNames</span><span class="php-quote">&amp;uploadOnlyMode=</span><span class="php-var">$uploadOnlyMode</span><span class="php-quote">&quot;</span>;
</span><span id="559" class="l"><a class="l" href="#559"> 559: </a>            <span class="php-var">$btn</span>-&gt;value = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Upload Image'</span>);
</span><span id="560" class="l"><a class="l" href="#560"> 560: </a>            <span class="php-var">$btn</span>-&gt;addClass(<span class="php-quote">'upload pw-modal-button pw-modal-button-visible'</span>); 
</span><span id="561" class="l"><a class="l" href="#561"> 561: </a>            <span class="php-var">$btn</span>-&gt;icon = <span class="php-quote">'upload'</span>;
</span><span id="562" class="l"><a class="l" href="#562"> 562: </a>            <span class="php-var">$changes</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'changes'</span>); 
</span><span id="563" class="l"><a class="l" href="#563"> 563: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$changes</span>) <span class="php-keyword1">foreach</span>(<span class="php-keyword2">explode</span>(<span class="php-quote">','</span>, <span class="php-var">$changes</span>) <span class="php-keyword1">as</span> <span class="php-var">$name</span>) {
</span><span id="564" class="l"><a class="l" href="#564"> 564: </a>                <span class="php-var">$name</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'sanitizer'</span>)-&gt;fieldName(<span class="php-var">$name</span>); 
</span><span id="565" class="l"><a class="l" href="#565"> 565: </a>                <span class="php-var">$field</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'fields'</span>)-&gt;get(<span class="php-var">$name</span>); 
</span><span id="566" class="l"><a class="l" href="#566"> 566: </a>                <span class="php-keyword1">if</span>(!<span class="php-var">$field</span>) <span class="php-keyword1">continue</span>;
</span><span id="567" class="l"><a class="l" href="#567"> 567: </a>                <span class="php-var">$out</span> .= <span class="php-quote">&quot;&lt;script&gt;refreshPageEditField('</span><span class="php-var">$name</span><span class="php-quote">');&lt;/script&gt;&quot;</span>;
</span><span id="568" class="l"><a class="l" href="#568"> 568: </a>            }
</span><span id="569" class="l"><a class="l" href="#569"> 569: </a>        } <span class="php-keyword1">else</span> <span class="php-var">$btn</span> = <span class="php-keyword1">null</span>;
</span><span id="570" class="l"><a class="l" href="#570"> 570: </a>
</span><span id="571" class="l"><a class="l" href="#571"> 571: </a>        <span class="php-var">$out</span> = <span class="php-var">$form</span>-&gt;render() . <span class="php-var">$out</span>;
</span><span id="572" class="l"><a class="l" href="#572"> 572: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$btn</span>) <span class="php-var">$out</span> .= <span class="php-var">$btn</span>-&gt;render();
</span><span id="573" class="l"><a class="l" href="#573"> 573: </a>        
</span><span id="574" class="l"><a class="l" href="#574"> 574: </a>        <span class="php-keyword1">return</span> <span class="php-quote">&quot;&lt;div id='ProcessPageEditImageSelect'&gt;&quot;</span> . <span class="php-var">$out</span> . <span class="php-quote">&quot;\n&lt;/div&gt;&quot;</span>;
</span><span id="575" class="l"><a class="l" href="#575"> 575: </a>    }
</span><span id="576" class="l"><a class="l" href="#576"> 576: </a>    
</span><span id="577" class="l"><a class="l" href="#577"> 577: </a>    <span class="php-comment">/**
</span></span><span id="578" class="l"><a class="l" href="#578"> 578: </a><span class="php-comment">     * Given a Pageimage, return the closest/last cropped version of it
</span></span><span id="579" class="l"><a class="l" href="#579"> 579: </a><span class="php-comment">     * 
</span></span><span id="580" class="l"><a class="l" href="#580"> 580: </a><span class="php-comment">     * This is so that resizes can use the highest quality version to resize from. 
</span></span><span id="581" class="l"><a class="l" href="#581"> 581: </a><span class="php-comment">     * 
</span></span><span id="582" class="l"><a class="l" href="#582"> 582: </a><span class="php-comment">     * @param Pageimage $image
</span></span><span id="583" class="l"><a class="l" href="#583"> 583: </a><span class="php-comment">     * @return Pageimage
</span></span><span id="584" class="l"><a class="l" href="#584"> 584: </a><span class="php-comment">     * 
</span></span><span id="585" class="l"><a class="l" href="#585"> 585: </a><span class="php-comment">     */</span>
</span><span id="586" class="l"><a class="l" href="#586"> 586: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> <a id="_getLastCrop" href="#_getLastCrop">getLastCrop</a>(Pageimage <span class="php-var">$image</span>) {
</span><span id="587" class="l"><a class="l" href="#587"> 587: </a>        <span class="php-var">$info</span> = <span class="php-var">$image</span>-&gt;isVariation(<span class="php-var">$image</span>-&gt;name, <span class="php-keyword1">true</span>);
</span><span id="588" class="l"><a class="l" href="#588"> 588: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$info</span> || !<span class="php-keyword1">empty</span>(<span class="php-var">$info</span>[<span class="php-quote">'crop'</span>])) {
</span><span id="589" class="l"><a class="l" href="#589"> 589: </a>            <span class="php-keyword1">return</span> <span class="php-var">$image</span>;
</span><span id="590" class="l"><a class="l" href="#590"> 590: </a>        }
</span><span id="591" class="l"><a class="l" href="#591"> 591: </a>        <span class="php-var">$cropName</span> = <span class="php-keyword1">null</span>;
</span><span id="592" class="l"><a class="l" href="#592"> 592: </a>        <span class="php-var">$parentInfo</span> = <span class="php-var">$info</span>;
</span><span id="593" class="l"><a class="l" href="#593"> 593: </a>        <span class="php-keyword1">while</span>(!<span class="php-keyword1">empty</span>(<span class="php-var">$parentInfo</span>[<span class="php-quote">'parent'</span>])) {
</span><span id="594" class="l"><a class="l" href="#594"> 594: </a>            <span class="php-var">$parentInfo</span> = <span class="php-var">$parentInfo</span>[<span class="php-quote">'parent'</span>];
</span><span id="595" class="l"><a class="l" href="#595"> 595: </a>            <span class="php-keyword1">if</span>(!<span class="php-keyword1">empty</span>(<span class="php-var">$parentInfo</span>[<span class="php-quote">'crop'</span>])) {
</span><span id="596" class="l"><a class="l" href="#596"> 596: </a>                <span class="php-var">$cropName</span> = <span class="php-var">$parentInfo</span>[<span class="php-quote">'name'</span>];
</span><span id="597" class="l"><a class="l" href="#597"> 597: </a>                <span class="php-keyword1">break</span>;
</span><span id="598" class="l"><a class="l" href="#598"> 598: </a>            }
</span><span id="599" class="l"><a class="l" href="#599"> 599: </a>        }
</span><span id="600" class="l"><a class="l" href="#600"> 600: </a>        
</span><span id="601" class="l"><a class="l" href="#601"> 601: </a>        <span class="php-var">$original</span> = <span class="php-var">$image</span>-&gt;getOriginal();
</span><span id="602" class="l"><a class="l" href="#602"> 602: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$original</span>) <span class="php-keyword1">return</span> <span class="php-var">$image</span>; 
</span><span id="603" class="l"><a class="l" href="#603"> 603: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword2">filemtime</span>(<span class="php-var">$original</span>-&gt;filename) &gt; <span class="php-keyword2">filemtime</span>(<span class="php-var">$image</span>-&gt;filename)) <span class="php-keyword1">return</span> <span class="php-var">$image</span>; 
</span><span id="604" class="l"><a class="l" href="#604"> 604: </a>        
</span><span id="605" class="l"><a class="l" href="#605"> 605: </a>        <span class="php-comment">// if no last crop found, return original</span>
</span><span id="606" class="l"><a class="l" href="#606"> 606: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$cropName</span>) <span class="php-keyword1">return</span> <span class="php-var">$original</span>;
</span><span id="607" class="l"><a class="l" href="#607"> 607: </a>        
</span><span id="608" class="l"><a class="l" href="#608"> 608: </a>        <span class="php-var">$variations</span> = <span class="php-var">$original</span>-&gt;getVariations();
</span><span id="609" class="l"><a class="l" href="#609"> 609: </a>        
</span><span id="610" class="l"><a class="l" href="#610"> 610: </a>        <span class="php-comment">// return last found crop</span>
</span><span id="611" class="l"><a class="l" href="#611"> 611: </a>        <span class="php-var">$cropImage</span> = <span class="php-var">$variations</span>-&gt;get(<span class="php-var">$cropName</span>);
</span><span id="612" class="l"><a class="l" href="#612"> 612: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$cropImage</span> &amp;&amp; <span class="php-keyword2">filemtime</span>(<span class="php-var">$cropImage</span>-&gt;filename) &gt; <span class="php-keyword2">filemtime</span>(<span class="php-var">$image</span>-&gt;filename)) <span class="php-keyword1">return</span> <span class="php-var">$image</span>;
</span><span id="613" class="l"><a class="l" href="#613"> 613: </a>        <span class="php-keyword1">return</span> <span class="php-var">$cropImage</span> ? <span class="php-var">$cropImage</span> : <span class="php-var">$original</span>;     
</span><span id="614" class="l"><a class="l" href="#614"> 614: </a>    }
</span><span id="615" class="l"><a class="l" href="#615"> 615: </a>
</span><span id="616" class="l"><a class="l" href="#616"> 616: </a>    <span class="php-comment">/**
</span></span><span id="617" class="l"><a class="l" href="#617"> 617: </a><span class="php-comment">     * Make a image edit URL
</span></span><span id="618" class="l"><a class="l" href="#618"> 618: </a><span class="php-comment">     * 
</span></span><span id="619" class="l"><a class="l" href="#619"> 619: </a><span class="php-comment">     * @param string $file
</span></span><span id="620" class="l"><a class="l" href="#620"> 620: </a><span class="php-comment">     * @param array $parts Additional variables you want to add
</span></span><span id="621" class="l"><a class="l" href="#621"> 621: </a><span class="php-comment">     * @return string
</span></span><span id="622" class="l"><a class="l" href="#622"> 622: </a><span class="php-comment">     * 
</span></span><span id="623" class="l"><a class="l" href="#623"> 623: </a><span class="php-comment">     */</span>
</span><span id="624" class="l"><a class="l" href="#624"> 624: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> <a id="_makeEditURL" href="#_makeEditURL">makeEditURL</a>(<span class="php-var">$file</span>, <span class="php-var">$parts</span> = <span class="php-keyword1">array</span>()) {
</span><span id="625" class="l"><a class="l" href="#625"> 625: </a>        
</span><span id="626" class="l"><a class="l" href="#626"> 626: </a>        <span class="php-var">$file</span> = <span class="php-keyword2">basename</span>(<span class="php-var">$file</span>); 
</span><span id="627" class="l"><a class="l" href="#627"> 627: </a>        <span class="php-var">$id</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$parts</span>[<span class="php-quote">'id'</span>]) ? (int) <span class="php-var">$parts</span>[<span class="php-quote">'id'</span>] : <span class="php-var">$this</span>-&gt;page-&gt;id; 
</span><span id="628" class="l"><a class="l" href="#628"> 628: </a>        
</span><span id="629" class="l"><a class="l" href="#629"> 629: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword1">isset</span>(<span class="php-var">$parts</span>[<span class="php-quote">'modal'</span>])) <span class="php-var">$parts</span>[<span class="php-quote">'modal'</span>] = <span class="php-num">1</span>;
</span><span id="630" class="l"><a class="l" href="#630"> 630: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword1">isset</span>(<span class="php-var">$parts</span>[<span class="php-quote">'edit_page_id'</span>]) &amp;&amp; <span class="php-var">$this</span>-&gt;editorPage) <span class="php-var">$parts</span>[<span class="php-quote">'edit_page_id'</span>] = <span class="php-var">$this</span>-&gt;editorPage-&gt;id; 
</span><span id="631" class="l"><a class="l" href="#631"> 631: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword1">isset</span>(<span class="php-var">$parts</span>[<span class="php-quote">'hidpi'</span>])) <span class="php-var">$parts</span>[<span class="php-quote">'hidpi'</span>] = (int) <span class="php-var">$this</span>-&gt;hidpi; 
</span><span id="632" class="l"><a class="l" href="#632"> 632: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword1">isset</span>(<span class="php-var">$parts</span>[<span class="php-quote">'original'</span>])) {
</span><span id="633" class="l"><a class="l" href="#633"> 633: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;original) {
</span><span id="634" class="l"><a class="l" href="#634"> 634: </a>                <span class="php-var">$parts</span>[<span class="php-quote">'original'</span>] = <span class="php-var">$this</span>-&gt;original;
</span><span id="635" class="l"><a class="l" href="#635"> 635: </a>            } <span class="php-keyword1">else</span> {
</span><span id="636" class="l"><a class="l" href="#636"> 636: </a>                <span class="php-var">$parts</span>[<span class="php-quote">'original'</span>] = <span class="php-var">$file</span>;
</span><span id="637" class="l"><a class="l" href="#637"> 637: </a>            }
</span><span id="638" class="l"><a class="l" href="#638"> 638: </a>        }
</span><span id="639" class="l"><a class="l" href="#639"> 639: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword1">isset</span>(<span class="php-var">$parts</span>[<span class="php-quote">'class'</span>]) &amp;&amp; <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'class'</span>)) {
</span><span id="640" class="l"><a class="l" href="#640"> 640: </a>            <span class="php-var">$class</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'class'</span>); 
</span><span id="641" class="l"><a class="l" href="#641"> 641: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$class</span>) {
</span><span id="642" class="l"><a class="l" href="#642"> 642: </a>                <span class="php-var">$validClasses</span> = <span class="php-keyword1">array</span>(<span class="php-var">$this</span>-&gt;alignLeftClass, <span class="php-var">$this</span>-&gt;alignCenterClass, <span class="php-var">$this</span>-&gt;alignRightClass);
</span><span id="643" class="l"><a class="l" href="#643"> 643: </a>                <span class="php-var">$classes</span> = <span class="php-keyword1">array</span>();
</span><span id="644" class="l"><a class="l" href="#644"> 644: </a>                <span class="php-keyword1">foreach</span>(<span class="php-keyword2">explode</span>(<span class="php-quote">' '</span>, <span class="php-var">$class</span>) <span class="php-keyword1">as</span> <span class="php-var">$c</span>) {
</span><span id="645" class="l"><a class="l" href="#645"> 645: </a>                    <span class="php-keyword1">if</span>(<span class="php-keyword2">in_array</span>(<span class="php-var">$c</span>, <span class="php-var">$validClasses</span>)) <span class="php-var">$classes</span>[] = <span class="php-var">$c</span>; 
</span><span id="646" class="l"><a class="l" href="#646"> 646: </a>                }
</span><span id="647" class="l"><a class="l" href="#647"> 647: </a>                <span class="php-keyword1">if</span>(<span class="php-keyword2">count</span>(<span class="php-var">$classes</span>)) <span class="php-var">$parts</span>[<span class="php-quote">'class'</span>] = <span class="php-keyword2">urlencode</span>(<span class="php-keyword2">implode</span>(<span class="php-quote">' '</span> , <span class="php-var">$classes</span>)); 
</span><span id="648" class="l"><a class="l" href="#648"> 648: </a>            }
</span><span id="649" class="l"><a class="l" href="#649"> 649: </a>        }
</span><span id="650" class="l"><a class="l" href="#650"> 650: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;rte) <span class="php-var">$parts</span>[<span class="php-quote">'rte'</span>] = <span class="php-quote">'0'</span>;
</span><span id="651" class="l"><a class="l" href="#651"> 651: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;field) <span class="php-var">$parts</span>[<span class="php-quote">'field'</span>] = <span class="php-var">$this</span>-&gt;fieldName; 
</span><span id="652" class="l"><a class="l" href="#652"> 652: </a>        
</span><span id="653" class="l"><a class="l" href="#653"> 653: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword1">isset</span>(<span class="php-var">$parts</span>[<span class="php-quote">'winwidth'</span>])) {
</span><span id="654" class="l"><a class="l" href="#654"> 654: </a>            <span class="php-var">$winwidth</span> = (int) <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'winwidth'</span>); 
</span><span id="655" class="l"><a class="l" href="#655"> 655: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$winwidth</span>) <span class="php-var">$parts</span>[<span class="php-quote">'winwidth'</span>] = <span class="php-var">$winwidth</span>; 
</span><span id="656" class="l"><a class="l" href="#656"> 656: </a>        }
</span><span id="657" class="l"><a class="l" href="#657"> 657: </a>        
</span><span id="658" class="l"><a class="l" href="#658"> 658: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword1">isset</span>(<span class="php-var">$parts</span>[<span class="php-quote">'caption'</span>]) &amp;&amp; <span class="php-var">$this</span>-&gt;rte &amp;&amp; <span class="php-var">$this</span>-&gt;caption) {
</span><span id="659" class="l"><a class="l" href="#659"> 659: </a>            <span class="php-var">$parts</span>[<span class="php-quote">'caption'</span>] = <span class="php-num">1</span>; 
</span><span id="660" class="l"><a class="l" href="#660"> 660: </a>        }
</span><span id="661" class="l"><a class="l" href="#661"> 661: </a>        
</span><span id="662" class="l"><a class="l" href="#662"> 662: </a>        <span class="php-comment">// @todo should we check for 'class' ?</span>
</span><span id="663" class="l"><a class="l" href="#663"> 663: </a>        
</span><span id="664" class="l"><a class="l" href="#664"> 664: </a>        <span class="php-keyword1">unset</span>(<span class="php-var">$parts</span>[<span class="php-quote">'id'</span>], <span class="php-var">$parts</span>[<span class="php-quote">'file'</span>]); <span class="php-comment">// in case they are set here</span>
</span><span id="665" class="l"><a class="l" href="#665"> 665: </a>        
</span><span id="666" class="l"><a class="l" href="#666"> 666: </a>        <span class="php-var">$url</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'config'</span>)-&gt;urls-&gt;admin . <span class="php-quote">&quot;page/image/edit/?id=</span><span class="php-var">$id</span><span class="php-quote">&amp;file=</span><span class="php-var">$id</span><span class="php-quote">,</span><span class="php-var">$file</span><span class="php-quote">&quot;</span>;
</span><span id="667" class="l"><a class="l" href="#667"> 667: </a>        
</span><span id="668" class="l"><a class="l" href="#668"> 668: </a>        <span class="php-keyword1">foreach</span>(<span class="php-var">$parts</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$value</span>) <span class="php-var">$url</span> .= <span class="php-quote">&quot;&amp;</span><span class="php-var">$key</span><span class="php-quote">=</span><span class="php-var">$value</span><span class="php-quote">&quot;</span>;
</span><span id="669" class="l"><a class="l" href="#669"> 669: </a>        
</span><span id="670" class="l"><a class="l" href="#670"> 670: </a>        <span class="php-keyword1">return</span> <span class="php-var">$url</span>;
</span><span id="671" class="l"><a class="l" href="#671"> 671: </a>    }
</span><span id="672" class="l"><a class="l" href="#672"> 672: </a>
</span><span id="673" class="l"><a class="l" href="#673"> 673: </a>    <span class="php-comment">/**
</span></span><span id="674" class="l"><a class="l" href="#674"> 674: </a><span class="php-comment">     * Check if user has image edit permission and throw exception if they don't
</span></span><span id="675" class="l"><a class="l" href="#675"> 675: </a><span class="php-comment">     *
</span></span><span id="676" class="l"><a class="l" href="#676"> 676: </a><span class="php-comment">     * @param bool $throw Specify false if you only want this method to return a true|false rather than throw exception
</span></span><span id="677" class="l"><a class="l" href="#677"> 677: </a><span class="php-comment">     * @throws WirePermissionException
</span></span><span id="678" class="l"><a class="l" href="#678"> 678: </a><span class="php-comment">     * @return bool if the $throw argument was false
</span></span><span id="679" class="l"><a class="l" href="#679"> 679: </a><span class="php-comment">     *
</span></span><span id="680" class="l"><a class="l" href="#680"> 680: </a><span class="php-comment">     */</span>
</span><span id="681" class="l"><a class="l" href="#681"> 681: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_checkImageEditPermission" href="#_checkImageEditPermission">checkImageEditPermission</a>(<span class="php-var">$throw</span> = <span class="php-keyword1">true</span>) {
</span><span id="682" class="l"><a class="l" href="#682"> 682: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;rte &amp;&amp; !<span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'user'</span>)-&gt;hasPermission(<span class="php-quote">'page-edit-images'</span>, <span class="php-var">$this</span>-&gt;masterPage)) {
</span><span id="683" class="l"><a class="l" href="#683"> 683: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$throw</span>) {
</span><span id="684" class="l"><a class="l" href="#684"> 684: </a>                <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WirePermissionException(<span class="php-var">$this</span>-&gt;labels[<span class="php-quote">'noAccess'</span>]);
</span><span id="685" class="l"><a class="l" href="#685"> 685: </a>            } <span class="php-keyword1">else</span> {
</span><span id="686" class="l"><a class="l" href="#686"> 686: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="687" class="l"><a class="l" href="#687"> 687: </a>            }
</span><span id="688" class="l"><a class="l" href="#688"> 688: </a>        }
</span><span id="689" class="l"><a class="l" href="#689"> 689: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="690" class="l"><a class="l" href="#690"> 690: </a>    }
</span><span id="691" class="l"><a class="l" href="#691"> 691: </a>
</span><span id="692" class="l"><a class="l" href="#692"> 692: </a>    <span class="php-comment">/**
</span></span><span id="693" class="l"><a class="l" href="#693"> 693: </a><span class="php-comment">     * Edit a selected image
</span></span><span id="694" class="l"><a class="l" href="#694"> 694: </a><span class="php-comment">     * 
</span></span><span id="695" class="l"><a class="l" href="#695"> 695: </a><span class="php-comment">     * Required GET variables:
</span></span><span id="696" class="l"><a class="l" href="#696"> 696: </a><span class="php-comment">     *  - file (string): URL of image, or preferably &quot;123,basename.jpg&quot; where 123 is ID. 
</span></span><span id="697" class="l"><a class="l" href="#697"> 697: </a><span class="php-comment">     *  - id (int): ID of page images is from, optional if specified in 'file'.
</span></span><span id="698" class="l"><a class="l" href="#698"> 698: </a><span class="php-comment">     *
</span></span><span id="699" class="l"><a class="l" href="#699"> 699: </a><span class="php-comment">     * Optional GET variables:
</span></span><span id="700" class="l"><a class="l" href="#700"> 700: </a><span class="php-comment">     *  - edit_page_id (int): ID of the page being edited, where image will be placed.
</span></span><span id="701" class="l"><a class="l" href="#701"> 701: </a><span class="php-comment">     *  - width (int): Current width of image in the editor
</span></span><span id="702" class="l"><a class="l" href="#702"> 702: </a><span class="php-comment">     *  - height (int): Current height of image in the editor
</span></span><span id="703" class="l"><a class="l" href="#703"> 703: </a><span class="php-comment">     *  - winwidth (int): Current width of client-side window in pixels
</span></span><span id="704" class="l"><a class="l" href="#704"> 704: </a><span class="php-comment">     *  - id (int): ID of the page the image lives on (if omitted, we attempt to determine from 'file' path).
</span></span><span id="705" class="l"><a class="l" href="#705"> 705: </a><span class="php-comment">     *  - class (string): Class name to pass along to the editor (i.e. align_left, align_right, etc.)
</span></span><span id="706" class="l"><a class="l" href="#706"> 706: </a><span class="php-comment">     *  - hidpi (int): Whether hidpi mode is used or not (0=no, 1=yes)
</span></span><span id="707" class="l"><a class="l" href="#707"> 707: </a><span class="php-comment">     *  - link: (string): URL that image is linking to in the editor.
</span></span><span id="708" class="l"><a class="l" href="#708"> 708: </a><span class="php-comment">     *  - description: (string): Text for description &quot;alt&quot; tag. 
</span></span><span id="709" class="l"><a class="l" href="#709"> 709: </a><span class="php-comment">     *  - rte (int): Rich text editor mode (0=off, 1 or omit=on)
</span></span><span id="710" class="l"><a class="l" href="#710"> 710: </a><span class="php-comment">     *  - field (string): Name of field (for non-rte mode)
</span></span><span id="711" class="l"><a class="l" href="#711"> 711: </a><span class="php-comment">     * 
</span></span><span id="712" class="l"><a class="l" href="#712"> 712: </a><span class="php-comment">     * Optional GET variables that must come together as a group. When present, the image editor 
</span></span><span id="713" class="l"><a class="l" href="#713"> 713: </a><span class="php-comment">     * will start in crop mode and show the original image with this portion selected for crop:
</span></span><span id="714" class="l"><a class="l" href="#714"> 714: </a><span class="php-comment">     *  - crop_x (int): Predefined crop left position
</span></span><span id="715" class="l"><a class="l" href="#715"> 715: </a><span class="php-comment">     *  - crop_y (int): Predefined crop top position
</span></span><span id="716" class="l"><a class="l" href="#716"> 716: </a><span class="php-comment">     *  - crop_w (int): Predefined crop width
</span></span><span id="717" class="l"><a class="l" href="#717"> 717: </a><span class="php-comment">     *  - crop_h (int): Predefined crop height
</span></span><span id="718" class="l"><a class="l" href="#718"> 718: </a><span class="php-comment">     * 
</span></span><span id="719" class="l"><a class="l" href="#719"> 719: </a><span class="php-comment">     * @return string
</span></span><span id="720" class="l"><a class="l" href="#720"> 720: </a><span class="php-comment">     * @throws \Exception|WireException
</span></span><span id="721" class="l"><a class="l" href="#721"> 721: </a><span class="php-comment">     * 
</span></span><span id="722" class="l"><a class="l" href="#722"> 722: </a><span class="php-comment">     */</span>
</span><span id="723" class="l"><a class="l" href="#723"> 723: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="____executeEdit" href="#____executeEdit">___executeEdit</a>() {
</span><span id="724" class="l"><a class="l" href="#724"> 724: </a>
</span><span id="725" class="l"><a class="l" href="#725"> 725: </a>        <span class="php-var">$this</span>-&gt;checkImageEditPermission();
</span><span id="726" class="l"><a class="l" href="#726"> 726: </a>
</span><span id="727" class="l"><a class="l" href="#727"> 727: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;post(<span class="php-quote">'submit_crop'</span>)) {
</span><span id="728" class="l"><a class="l" href="#728"> 728: </a>            <span class="php-var">$crop</span> = <span class="php-var">$this</span>-&gt;processCrop();
</span><span id="729" class="l"><a class="l" href="#729"> 729: </a>            <span class="php-var">$parts</span> = <span class="php-var">$this</span>-&gt;hidpi ? <span class="php-keyword1">array</span>(<span class="php-quote">'width'</span> =&gt; <span class="php-var">$crop</span>-&gt;hidpiWidth()) : <span class="php-keyword1">array</span>();
</span><span id="730" class="l"><a class="l" href="#730"> 730: </a>            <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'session'</span>)-&gt;redirect(<span class="php-var">$this</span>-&gt;makeEditURL(<span class="php-var">$crop</span>-&gt;<span class="php-keyword2">basename</span>, <span class="php-var">$parts</span>)); 
</span><span id="731" class="l"><a class="l" href="#731"> 731: </a>            <span class="php-keyword1">return</span> <span class="php-quote">''</span>;
</span><span id="732" class="l"><a class="l" href="#732"> 732: </a>        } <span class="php-keyword1">else</span> <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;post(<span class="php-quote">'submit_save_replace'</span>)) {
</span><span id="733" class="l"><a class="l" href="#733"> 733: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;processSave(<span class="php-keyword1">true</span>); 
</span><span id="734" class="l"><a class="l" href="#734"> 734: </a>        } <span class="php-keyword1">else</span> <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;post(<span class="php-quote">'submit_save_copy'</span>)) {
</span><span id="735" class="l"><a class="l" href="#735"> 735: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;processSave(<span class="php-keyword1">false</span>);
</span><span id="736" class="l"><a class="l" href="#736"> 736: </a>        }
</span><span id="737" class="l"><a class="l" href="#737"> 737: </a>    
</span><span id="738" class="l"><a class="l" href="#738"> 738: </a>        <span class="php-var">$path</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'config'</span>)-&gt;urls-&gt;ProcessPageEditImageSelect; 
</span><span id="739" class="l"><a class="l" href="#739"> 739: </a>        <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'config'</span>)-&gt;styles-&gt;add(<span class="php-var">$path</span> . <span class="php-quote">'cropper/cropper.min.css'</span>);
</span><span id="740" class="l"><a class="l" href="#740"> 740: </a>        <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'config'</span>)-&gt;scripts-&gt;add(<span class="php-var">$path</span> . <span class="php-quote">'cropper/cropper.min.js'</span>); 
</span><span id="741" class="l"><a class="l" href="#741"> 741: </a>    
</span><span id="742" class="l"><a class="l" href="#742"> 742: </a>        <span class="php-var">$labels</span> =&amp; <span class="php-var">$this</span>-&gt;labels;
</span><span id="743" class="l"><a class="l" href="#743"> 743: </a>        <span class="php-var">$formClasses</span> = <span class="php-keyword1">array</span>();
</span><span id="744" class="l"><a class="l" href="#744"> 744: </a>        
</span><span id="745" class="l"><a class="l" href="#745"> 745: </a>        <span class="php-var">$icons</span> = <span class="php-keyword1">array</span>(
</span><span id="746" class="l"><a class="l" href="#746"> 746: </a>            <span class="php-quote">'top'</span> =&gt; <span class="php-quote">'long-arrow-up'</span>,
</span><span id="747" class="l"><a class="l" href="#747"> 747: </a>            <span class="php-quote">'left'</span> =&gt; <span class="php-quote">'long-arrow-left'</span>, 
</span><span id="748" class="l"><a class="l" href="#748"> 748: </a>            <span class="php-quote">'width'</span> =&gt; <span class="php-quote">'arrows-h'</span>, 
</span><span id="749" class="l"><a class="l" href="#749"> 749: </a>            <span class="php-quote">'height'</span> =&gt; <span class="php-quote">'arrows-v'</span>, 
</span><span id="750" class="l"><a class="l" href="#750"> 750: </a>        );
</span><span id="751" class="l"><a class="l" href="#751"> 751: </a>        <span class="php-keyword1">foreach</span>(<span class="php-var">$icons</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$value</span>) {
</span><span id="752" class="l"><a class="l" href="#752"> 752: </a>            <span class="php-var">$icons</span>[<span class="php-var">$key</span>] = <span class="php-quote">&quot;&lt;i class='fa fa-fw fa-</span><span class="php-var">$value</span><span class="php-quote"> ui-priority-secondary'&gt;&lt;/i&gt;&quot;</span>;
</span><span id="753" class="l"><a class="l" href="#753"> 753: </a>        }
</span><span id="754" class="l"><a class="l" href="#754"> 754: </a>
</span><span id="755" class="l"><a class="l" href="#755"> 755: </a>        <span class="php-var">$optionalClasses</span> = <span class="php-keyword1">array</span>(
</span><span id="756" class="l"><a class="l" href="#756"> 756: </a>            <span class="php-var">$this</span>-&gt;alignLeftClass =&gt; <span class="php-var">$labels</span>[<span class="php-quote">'alignLeft'</span>], 
</span><span id="757" class="l"><a class="l" href="#757"> 757: </a>            <span class="php-var">$this</span>-&gt;alignRightClass =&gt; <span class="php-var">$labels</span>[<span class="php-quote">'alignRight'</span>], 
</span><span id="758" class="l"><a class="l" href="#758"> 758: </a>            <span class="php-var">$this</span>-&gt;alignCenterClass =&gt; <span class="php-var">$labels</span>[<span class="php-quote">'alignCenter'</span>], 
</span><span id="759" class="l"><a class="l" href="#759"> 759: </a>        );
</span><span id="760" class="l"><a class="l" href="#760"> 760: </a>
</span><span id="761" class="l"><a class="l" href="#761"> 761: </a>        <span class="php-var">$cropX</span> = <span class="php-keyword1">null</span>; 
</span><span id="762" class="l"><a class="l" href="#762"> 762: </a>        <span class="php-var">$cropY</span> = <span class="php-keyword1">null</span>; 
</span><span id="763" class="l"><a class="l" href="#763"> 763: </a>        <span class="php-var">$cropWidth</span> = <span class="php-keyword1">null</span>; 
</span><span id="764" class="l"><a class="l" href="#764"> 764: </a>        <span class="php-var">$cropHeight</span> = <span class="php-keyword1">null</span>;
</span><span id="765" class="l"><a class="l" href="#765"> 765: </a>        <span class="php-var">$isCropped</span> = <span class="php-keyword2">preg_match_all</span>(<span class="php-quote">'/\.(\d+)x(\d+).*?-crop[xy](\d+)[xy](\d+)[-.]/'</span>, <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'file'</span>), <span class="php-var">$matches</span>); 
</span><span id="766" class="l"><a class="l" href="#766"> 766: </a>        
</span><span id="767" class="l"><a class="l" href="#767"> 767: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$isCropped</span>) { <span class="php-comment">// get last coordinates present</span>
</span><span id="768" class="l"><a class="l" href="#768"> 768: </a>            <span class="php-var">$cropWidth</span> = (int) <span class="php-keyword2">array_pop</span>(<span class="php-var">$matches</span>[<span class="php-num">1</span>]);
</span><span id="769" class="l"><a class="l" href="#769"> 769: </a>            <span class="php-var">$cropHeight</span> = (int) <span class="php-keyword2">array_pop</span>(<span class="php-var">$matches</span>[<span class="php-num">2</span>]);
</span><span id="770" class="l"><a class="l" href="#770"> 770: </a>            <span class="php-var">$cropX</span> = (int) <span class="php-keyword2">array_pop</span>(<span class="php-var">$matches</span>[<span class="php-num">3</span>]); 
</span><span id="771" class="l"><a class="l" href="#771"> 771: </a>            <span class="php-var">$cropY</span> = (int) <span class="php-keyword2">array_pop</span>(<span class="php-var">$matches</span>[<span class="php-num">4</span>]); 
</span><span id="772" class="l"><a class="l" href="#772"> 772: </a>        }
</span><span id="773" class="l"><a class="l" href="#773"> 773: </a>        
</span><span id="774" class="l"><a class="l" href="#774"> 774: </a>        <span class="php-var">$isCroppable</span> = !<span class="php-var">$isCropped</span>;
</span><span id="775" class="l"><a class="l" href="#775"> 775: </a>        <span class="php-keyword1">try</span> {
</span><span id="776" class="l"><a class="l" href="#776"> 776: </a>            <span class="php-var">$original</span> = <span class="php-var">$this</span>-&gt;getPageimage(<span class="php-keyword1">false</span>);
</span><span id="777" class="l"><a class="l" href="#777"> 777: </a>        } <span class="php-keyword1">catch</span>(\Exception <span class="php-var">$e</span>) {
</span><span id="778" class="l"><a class="l" href="#778"> 778: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;rte) {
</span><span id="779" class="l"><a class="l" href="#779"> 779: </a>                <span class="php-comment">// when RTE mode, go to image selection again when invalid image</span>
</span><span id="780" class="l"><a class="l" href="#780"> 780: </a>                <span class="php-var">$this</span>-&gt;error(<span class="php-var">$e</span>-&gt;getMessage());
</span><span id="781" class="l"><a class="l" href="#781"> 781: </a>                <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'session'</span>)-&gt;redirect(<span class="php-quote">&quot;./?id=</span><span class="php-var">{$this-&gt;page-&gt;id}</span><span class="php-quote">&quot;</span>);
</span><span id="782" class="l"><a class="l" href="#782"> 782: </a>                <span class="php-keyword1">return</span> <span class="php-quote">''</span>;
</span><span id="783" class="l"><a class="l" href="#783"> 783: </a>            } <span class="php-keyword1">else</span> {
</span><span id="784" class="l"><a class="l" href="#784"> 784: </a>                <span class="php-keyword1">throw</span> <span class="php-var">$e</span>; 
</span><span id="785" class="l"><a class="l" href="#785"> 785: </a>            }
</span><span id="786" class="l"><a class="l" href="#786"> 786: </a>        }
</span><span id="787" class="l"><a class="l" href="#787"> 787: </a>        
</span><span id="788" class="l"><a class="l" href="#788"> 788: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$isCropped</span>) {
</span><span id="789" class="l"><a class="l" href="#789"> 789: </a>            <span class="php-var">$image</span> = <span class="php-var">$this</span>-&gt;getPageimage(<span class="php-keyword1">true</span>); 
</span><span id="790" class="l"><a class="l" href="#790"> 790: </a>            <span class="php-var">$recropURL</span> = <span class="php-var">$this</span>-&gt;makeEditURL(<span class="php-var">$original</span>-&gt;<span class="php-keyword2">basename</span>, <span class="php-keyword1">array</span>(
</span><span id="791" class="l"><a class="l" href="#791"> 791: </a>                <span class="php-quote">'crop_x'</span> =&gt; <span class="php-var">$cropX</span>,
</span><span id="792" class="l"><a class="l" href="#792"> 792: </a>                <span class="php-quote">'crop_y'</span> =&gt; <span class="php-var">$cropY</span>, 
</span><span id="793" class="l"><a class="l" href="#793"> 793: </a>                <span class="php-quote">'crop_w'</span> =&gt; <span class="php-var">$cropWidth</span>, 
</span><span id="794" class="l"><a class="l" href="#794"> 794: </a>                <span class="php-quote">'crop_h'</span> =&gt; <span class="php-var">$cropHeight</span>
</span><span id="795" class="l"><a class="l" href="#795"> 795: </a>            ));
</span><span id="796" class="l"><a class="l" href="#796"> 796: </a>        } <span class="php-keyword1">else</span> {
</span><span id="797" class="l"><a class="l" href="#797"> 797: </a>            <span class="php-var">$recropURL</span> = <span class="php-quote">&quot;&quot;</span>;
</span><span id="798" class="l"><a class="l" href="#798"> 798: </a>            <span class="php-var">$image</span> = <span class="php-var">$original</span>;
</span><span id="799" class="l"><a class="l" href="#799"> 799: </a>        }
</span><span id="800" class="l"><a class="l" href="#800"> 800: </a>        
</span><span id="801" class="l"><a class="l" href="#801"> 801: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword2">is_file</span>(<span class="php-var">$image</span>-&gt;filename)) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Image file does not exist&quot;</span>); 
</span><span id="802" class="l"><a class="l" href="#802"> 802: </a>        
</span><span id="803" class="l"><a class="l" href="#803"> 803: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;field) {
</span><span id="804" class="l"><a class="l" href="#804"> 804: </a>            <span class="php-var">$pageimages</span> = <span class="php-var">$this</span>-&gt;page-&gt;get(<span class="php-var">$this</span>-&gt;field-&gt;name);
</span><span id="805" class="l"><a class="l" href="#805"> 805: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$pageimages</span> || !<span class="php-var">$pageimages</span>-&gt;get(<span class="php-var">$original</span>-&gt;name)) {
</span><span id="806" class="l"><a class="l" href="#806"> 806: </a>                <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Please save the page before editing newly uploaded images.&quot;</span>); 
</span><span id="807" class="l"><a class="l" href="#807"> 807: </a>            }
</span><span id="808" class="l"><a class="l" href="#808"> 808: </a>        }
</span><span id="809" class="l"><a class="l" href="#809"> 809: </a>        
</span><span id="810" class="l"><a class="l" href="#810"> 810: </a>        <span class="php-var">$basename</span> = <span class="php-var">$image</span>-&gt;<span class="php-keyword2">basename</span>;
</span><span id="811" class="l"><a class="l" href="#811"> 811: </a>        <span class="php-var">$fullname</span> = <span class="php-var">$image</span>-&gt;page-&gt;id . <span class="php-quote">','</span> . <span class="php-var">$basename</span>;  <span class="php-comment">// &quot;123,basename.jpg&quot;</span>
</span><span id="812" class="l"><a class="l" href="#812"> 812: </a>
</span><span id="813" class="l"><a class="l" href="#813"> 813: </a>        <span class="php-var">$originalWidth</span> = <span class="php-var">$image</span>-&gt;width();
</span><span id="814" class="l"><a class="l" href="#814"> 814: </a>        <span class="php-var">$originalHeight</span> = <span class="php-var">$image</span>-&gt;height();
</span><span id="815" class="l"><a class="l" href="#815"> 815: </a>
</span><span id="816" class="l"><a class="l" href="#816"> 816: </a>        
</span><span id="817" class="l"><a class="l" href="#817"> 817: </a>        <span class="php-comment">// attributes for #selected_image</span>
</span><span id="818" class="l"><a class="l" href="#818"> 818: </a>        <span class="php-var">$attrs</span> = <span class="php-keyword1">array</span>(
</span><span id="819" class="l"><a class="l" href="#819"> 819: </a>            <span class="php-quote">'class'</span> =&gt; <span class="php-quote">''</span>,
</span><span id="820" class="l"><a class="l" href="#820"> 820: </a>            <span class="php-quote">'width'</span> =&gt; <span class="php-num">0</span>,
</span><span id="821" class="l"><a class="l" href="#821"> 821: </a>            <span class="php-quote">'height'</span> =&gt; <span class="php-num">0</span>,
</span><span id="822" class="l"><a class="l" href="#822"> 822: </a>            <span class="php-quote">'data-origwidth'</span> =&gt; <span class="php-var">$originalWidth</span>,
</span><span id="823" class="l"><a class="l" href="#823"> 823: </a>            <span class="php-quote">'data-origheight'</span> =&gt; <span class="php-var">$originalHeight</span>,
</span><span id="824" class="l"><a class="l" href="#824"> 824: </a>            <span class="php-quote">'data-nosize'</span> =&gt; (<span class="php-var">$this</span>-&gt;noSizeAttrs ? <span class="php-quote">'1'</span> : <span class="php-quote">''</span>),
</span><span id="825" class="l"><a class="l" href="#825"> 825: </a>        );
</span><span id="826" class="l"><a class="l" href="#826"> 826: </a>        
</span><span id="827" class="l"><a class="l" href="#827"> 827: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;rte &amp;&amp; <span class="php-var">$this</span>-&gt;field) {
</span><span id="828" class="l"><a class="l" href="#828"> 828: </a>            <span class="php-var">$minWidth</span> = <span class="php-var">$this</span>-&gt;field-&gt;minWidth ? (int) <span class="php-var">$this</span>-&gt;field-&gt;minWidth : <span class="php-num">1</span>;
</span><span id="829" class="l"><a class="l" href="#829"> 829: </a>            <span class="php-var">$minHeight</span> = <span class="php-var">$this</span>-&gt;field-&gt;minHeight ? (int) <span class="php-var">$this</span>-&gt;field-&gt;minHeight : <span class="php-num">1</span>;
</span><span id="830" class="l"><a class="l" href="#830"> 830: </a>        } <span class="php-keyword1">else</span> {
</span><span id="831" class="l"><a class="l" href="#831"> 831: </a>            <span class="php-var">$minWidth</span> = <span class="php-num">1</span>; 
</span><span id="832" class="l"><a class="l" href="#832"> 832: </a>            <span class="php-var">$minHeight</span> = <span class="php-num">1</span>;
</span><span id="833" class="l"><a class="l" href="#833"> 833: </a>        }
</span><span id="834" class="l"><a class="l" href="#834"> 834: </a>        
</span><span id="835" class="l"><a class="l" href="#835"> 835: </a>        <span class="php-comment">// bundle in crop information to image attributes, if specified</span>
</span><span id="836" class="l"><a class="l" href="#836"> 836: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'crop_x'</span>)) {
</span><span id="837" class="l"><a class="l" href="#837"> 837: </a>            <span class="php-var">$attrs</span>[<span class="php-quote">'data-crop'</span>] =
</span><span id="838" class="l"><a class="l" href="#838"> 838: </a>                ((int) <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'crop_x'</span>)) . <span class="php-quote">','</span> .
</span><span id="839" class="l"><a class="l" href="#839"> 839: </a>                ((int) <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'crop_y'</span>)) . <span class="php-quote">','</span> .
</span><span id="840" class="l"><a class="l" href="#840"> 840: </a>                ((int) <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'crop_w'</span>)) . <span class="php-quote">','</span> .
</span><span id="841" class="l"><a class="l" href="#841"> 841: </a>                ((int) <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'crop_h'</span>));
</span><span id="842" class="l"><a class="l" href="#842"> 842: </a>        }
</span><span id="843" class="l"><a class="l" href="#843"> 843: </a>
</span><span id="844" class="l"><a class="l" href="#844"> 844: </a>        <span class="php-comment">// determine width/height we will display image at in editor, so that it fits</span>
</span><span id="845" class="l"><a class="l" href="#845"> 845: </a>        <span class="php-var">$width</span> = (int) <span class="php-var">$this</span>-&gt;input-&gt;get(<span class="php-quote">'width'</span>); 
</span><span id="846" class="l"><a class="l" href="#846"> 846: </a>        <span class="php-var">$height</span> = (int) <span class="php-var">$this</span>-&gt;input-&gt;get(<span class="php-quote">'height'</span>); 
</span><span id="847" class="l"><a class="l" href="#847"> 847: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$width</span>) <span class="php-var">$width</span> = <span class="php-var">$this</span>-&gt;editWidth; 
</span><span id="848" class="l"><a class="l" href="#848"> 848: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$width</span>) <span class="php-var">$width</span> = <span class="php-quote">''</span>;
</span><span id="849" class="l"><a class="l" href="#849"> 849: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$height</span>) <span class="php-var">$height</span> = <span class="php-var">$this</span>-&gt;editHeight; 
</span><span id="850" class="l"><a class="l" href="#850"> 850: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$height</span>) <span class="php-var">$height</span> = <span class="php-quote">''</span>;
</span><span id="851" class="l"><a class="l" href="#851"> 851: </a>        
</span><span id="852" class="l"><a class="l" href="#852"> 852: </a>        <span class="php-comment">// if width not specified in edit URL and image exceeds the window width, then scale to fit window</span>
</span><span id="853" class="l"><a class="l" href="#853"> 853: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$width</span>) {
</span><span id="854" class="l"><a class="l" href="#854"> 854: </a>            <span class="php-var">$width</span> = <span class="php-var">$image</span>-&gt;width; 
</span><span id="855" class="l"><a class="l" href="#855"> 855: </a>        }
</span><span id="856" class="l"><a class="l" href="#856"> 856: </a>        <span class="php-var">$attrs</span>[<span class="php-quote">'width'</span>] = <span class="php-var">$width</span>;
</span><span id="857" class="l"><a class="l" href="#857"> 857: </a>        <span class="php-var">$attrs</span>[<span class="php-quote">'data-fit'</span>] = <span class="php-quote">'1'</span>;
</span><span id="858" class="l"><a class="l" href="#858"> 858: </a>        <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'processBrowserTitle'</span>, <span class="php-var">$basename</span>); 
</span><span id="859" class="l"><a class="l" href="#859"> 859: </a>
</span><span id="860" class="l"><a class="l" href="#860"> 860: </a>        <span class="php-comment">// if they aren't already working with a resized image, and it's being scaled down,</span>
</span><span id="861" class="l"><a class="l" href="#861"> 861: </a>        <span class="php-comment">// then add the 'resized' class to ensure that our RTE 'pwimage' plugin knows to perform the resize</span>
</span><span id="862" class="l"><a class="l" href="#862"> 862: </a>        <span class="php-comment">// by checking for the 'resized' classname on the image</span>
</span><span id="863" class="l"><a class="l" href="#863"> 863: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword2">basename</span>(<span class="php-var">$this</span>-&gt;input-&gt;get-&gt;<span class="php-keyword2">file</span>) == <span class="php-var">$fullname</span> &amp;&amp; <span class="php-var">$originalWidth</span> &gt; <span class="php-var">$width</span>) <span class="php-var">$attrs</span>[<span class="php-quote">'class'</span>] .= <span class="php-quote">&quot; resized&quot;</span>;
</span><span id="864" class="l"><a class="l" href="#864"> 864: </a>    
</span><span id="865" class="l"><a class="l" href="#865"> 865: </a>        <span class="php-comment">// if hidpi specified keep it checed</span>
</span><span id="866" class="l"><a class="l" href="#866"> 866: </a>        <span class="php-var">$hidpiChecked</span> = <span class="php-var">$this</span>-&gt;hidpi ? <span class="php-quote">&quot; checked='checked'&quot;</span> : <span class="php-quote">&quot;&quot;</span>;
</span><span id="867" class="l"><a class="l" href="#867"> 867: </a>        <span class="php-var">$captionChecked</span> = <span class="php-var">$this</span>-&gt;caption ? <span class="php-quote">&quot; checked='checked'&quot;</span> : <span class="php-quote">&quot;&quot;</span>;
</span><span id="868" class="l"><a class="l" href="#868"> 868: </a>    
</span><span id="869" class="l"><a class="l" href="#869"> 869: </a>        <span class="php-comment">// alignment class options</span>
</span><span id="870" class="l"><a class="l" href="#870"> 870: </a>        <span class="php-var">$classOptions</span> = <span class="php-quote">''</span>;
</span><span id="871" class="l"><a class="l" href="#871"> 871: </a>        <span class="php-keyword1">foreach</span>(<span class="php-var">$optionalClasses</span> <span class="php-keyword1">as</span> <span class="php-var">$class</span> =&gt; <span class="php-var">$label</span>) {
</span><span id="872" class="l"><a class="l" href="#872"> 872: </a>            <span class="php-var">$labelKey</span> = <span class="php-keyword2">array_search</span>(<span class="php-var">$label</span>, <span class="php-var">$labels</span>); 
</span><span id="873" class="l"><a class="l" href="#873"> 873: </a>            <span class="php-var">$selected</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$this</span>-&gt;input-&gt;get(<span class="php-quote">'class'</span>), <span class="php-var">$class</span>) !== <span class="php-keyword1">false</span> ? <span class="php-quote">&quot; selected='selected'&quot;</span> : <span class="php-quote">''</span>;
</span><span id="874" class="l"><a class="l" href="#874"> 874: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$selected</span>) <span class="php-var">$attrs</span>[<span class="php-quote">'class'</span>] .= <span class="php-quote">&quot; </span><span class="php-var">$class</span><span class="php-quote">&quot;</span>;
</span><span id="875" class="l"><a class="l" href="#875"> 875: </a>            <span class="php-var">$classOptions</span> .= <span class="php-quote">&quot;&lt;option</span><span class="php-var">$selected</span><span class="php-quote"> data-label='</span><span class="php-var">$labelKey</span><span class="php-quote">' value='</span><span class="php-var">$class</span><span class="php-quote">'&gt;</span><span class="php-var">$label</span><span class="php-quote">&lt;/option&gt;&quot;</span>;
</span><span id="876" class="l"><a class="l" href="#876"> 876: </a>        }
</span><span id="877" class="l"><a class="l" href="#877"> 877: </a>    
</span><span id="878" class="l"><a class="l" href="#878"> 878: </a>        <span class="php-comment">// convert $attrs to an attribute string for placement in #selected_image markup</span>
</span><span id="879" class="l"><a class="l" href="#879"> 879: </a>        <span class="php-var">$attrStr</span> = <span class="php-quote">''</span>; 
</span><span id="880" class="l"><a class="l" href="#880"> 880: </a>        <span class="php-keyword1">foreach</span>(<span class="php-var">$attrs</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$value</span>) {
</span><span id="881" class="l"><a class="l" href="#881"> 881: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$value</span> &amp;&amp; <span class="php-var">$key</span> != <span class="php-quote">'data-nosize'</span>) <span class="php-keyword1">continue</span>; <span class="php-comment">// skip most empty attributes</span>
</span><span id="882" class="l"><a class="l" href="#882"> 882: </a>            <span class="php-var">$attrStr</span> .= <span class="php-quote">&quot;</span><span class="php-var">$key</span><span class="php-quote">='&quot;</span> . <span class="php-keyword2">trim</span>(<span class="php-var">$value</span>) . <span class="php-quote">&quot;' &quot;</span>;
</span><span id="883" class="l"><a class="l" href="#883"> 883: </a>        }
</span><span id="884" class="l"><a class="l" href="#884"> 884: </a>
</span><span id="885" class="l"><a class="l" href="#885"> 885: </a>        <span class="php-comment">// prepare description (alt)</span>
</span><span id="886" class="l"><a class="l" href="#886"> 886: </a>        <span class="php-var">$description</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$_GET</span>[<span class="php-quote">'description'</span>]) ? <span class="php-var">$this</span>-&gt;input-&gt;get(<span class="php-quote">'description'</span>) : <span class="php-quote">''</span>; <span class="php-comment">// $image-&gt;description;</span>
</span><span id="887" class="l"><a class="l" href="#887"> 887: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword2">strlen</span>(<span class="php-var">$description</span>) &gt; <span class="php-num">8192</span>) <span class="php-var">$description</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$description</span>, <span class="php-num">0</span>, <span class="php-num">8192</span>);
</span><span id="888" class="l"><a class="l" href="#888"> 888: </a>        <span class="php-var">$description</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'sanitizer'</span>)-&gt;entities(<span class="php-var">$description</span>); 
</span><span id="889" class="l"><a class="l" href="#889"> 889: </a>        
</span><span id="890" class="l"><a class="l" href="#890"> 890: </a>        <span class="php-comment">// if dealing with a variation size or crop provide the option to link to the original (larger)</span>
</span><span id="891" class="l"><a class="l" href="#891"> 891: </a>        <span class="php-var">$linkOriginalChecked</span> = <span class="php-quote">''</span>;
</span><span id="892" class="l"><a class="l" href="#892"> 892: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$image</span>-&gt;name != <span class="php-var">$original</span>-&gt;name || <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'link'</span>)) {
</span><span id="893" class="l"><a class="l" href="#893"> 893: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$image</span>-&gt;name != <span class="php-var">$original</span>-&gt;name) <span class="php-var">$formClasses</span>[] = <span class="php-quote">'not-original'</span>;
</span><span id="894" class="l"><a class="l" href="#894"> 894: </a>            <span class="php-var">$imgURL</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'config'</span>)-&gt;urls-&gt;root, <span class="php-quote">'/'</span>, <span class="php-var">$original</span>-&gt;url);
</span><span id="895" class="l"><a class="l" href="#895"> 895: </a>            <span class="php-var">$imgLinkURL</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'link'</span>));
</span><span id="896" class="l"><a class="l" href="#896"> 896: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$imgLinkURL</span>) {
</span><span id="897" class="l"><a class="l" href="#897"> 897: </a>                <span class="php-keyword1">if</span>(<span class="php-var">$imgLinkURL</span> === <span class="php-quote">&quot;1&quot;</span>) <span class="php-var">$imgLinkURL</span> = <span class="php-var">$imgURL</span>; <span class="php-comment">// if in toggle mode, substitute URL</span>
</span><span id="898" class="l"><a class="l" href="#898"> 898: </a>                <span class="php-comment">// determine if 'link to original' checkbox should be checked </span>
</span><span id="899" class="l"><a class="l" href="#899"> 899: </a>                <span class="php-var">$test</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$imgLinkURL</span>, -<span class="php-num">1</span> * <span class="php-keyword2">strlen</span>(<span class="php-var">$imgURL</span>));
</span><span id="900" class="l"><a class="l" href="#900"> 900: </a>                <span class="php-var">$linkOriginalChecked</span> = <span class="php-var">$test</span> == <span class="php-var">$imgURL</span> ? <span class="php-quote">&quot; checked='checked' data-was-checked='1'&quot;</span> : <span class="php-quote">&quot;&quot;</span>;
</span><span id="901" class="l"><a class="l" href="#901"> 901: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$imgLinkURL</span>); 
</span><span id="902" class="l"><a class="l" href="#902"> 902: </a>            }
</span><span id="903" class="l"><a class="l" href="#903"> 903: </a>        } <span class="php-keyword1">else</span> {
</span><span id="904" class="l"><a class="l" href="#904"> 904: </a>            <span class="php-var">$formClasses</span>[] = <span class="php-quote">'original'</span>;
</span><span id="905" class="l"><a class="l" href="#905"> 905: </a>        }
</span><span id="906" class="l"><a class="l" href="#906"> 906: </a>        
</span><span id="907" class="l"><a class="l" href="#907"> 907: </a>        <span class="php-var">$resizeYesChecked</span> = <span class="php-var">$this</span>-&gt;rte ? <span class="php-quote">&quot; checked='checked'&quot;</span> : <span class="php-quote">&quot;&quot;</span>;
</span><span id="908" class="l"><a class="l" href="#908"> 908: </a>        <span class="php-var">$resizeNoChecked</span> = !<span class="php-var">$this</span>-&gt;rte ? <span class="php-quote">&quot; checked='checked'&quot;</span> : <span class="php-quote">&quot;&quot;</span>;
</span><span id="909" class="l"><a class="l" href="#909"> 909: </a>
</span><span id="910" class="l"><a class="l" href="#910"> 910: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;field &amp;&amp; <span class="php-var">$this</span>-&gt;field-&gt;maxFiles == <span class="php-num">1</span>) <span class="php-var">$formClasses</span>[] = <span class="php-quote">'maxfiles1'</span>;
</span><span id="911" class="l"><a class="l" href="#911"> 911: </a>            
</span><span id="912" class="l"><a class="l" href="#912"> 912: </a>        <span class="php-comment">// form attributes</span>
</span><span id="913" class="l"><a class="l" href="#913"> 913: </a>        <span class="php-var">$formClasses</span>[] = <span class="php-var">$isCroppable</span> ? <span class="php-quote">'croppable'</span> : <span class="php-quote">'not-croppable'</span>;
</span><span id="914" class="l"><a class="l" href="#914"> 914: </a>        <span class="php-var">$formClasses</span>[] = <span class="php-var">$this</span>-&gt;rte ? <span class="php-quote">'rte'</span> : <span class="php-quote">'not-rte'</span>;
</span><span id="915" class="l"><a class="l" href="#915"> 915: </a>        <span class="php-var">$formClass</span> = <span class="php-keyword2">implode</span>(<span class="php-quote">' '</span>, <span class="php-var">$formClasses</span>); 
</span><span id="916" class="l"><a class="l" href="#916"> 916: </a>        <span class="php-var">$formActionURL</span> = <span class="php-var">$this</span>-&gt;makeEditURL(<span class="php-var">$basename</span>);
</span><span id="917" class="l"><a class="l" href="#917"> 917: </a>        <span class="php-var">$originalDimension</span> = <span class="php-var">$originalWidth</span> . <span class="php-quote">'x'</span> . <span class="php-var">$originalHeight</span>; 
</span><span id="918" class="l"><a class="l" href="#918"> 918: </a>        <span class="php-var">$imageURL</span> = <span class="php-var">$this</span>-&gt;rte ? <span class="php-var">$image</span>-&gt;url : <span class="php-var">$image</span>-&gt;URL;
</span><span id="919" class="l"><a class="l" href="#919"> 919: </a>
</span><span id="920" class="l"><a class="l" href="#920"> 920: </a>        <span class="php-comment">// form header and inputs</span>
</span><span id="921" class="l"><a class="l" href="#921"> 921: </a>        <span class="php-comment">// @todo move all this markup to a separate template file</span>
</span><span id="922" class="l"><a class="l" href="#922"> 922: </a>        <span class="php-var">$out</span> =  
</span><span id="923" class="l"><a class="l" href="#923"> 923: </a>            <span class="php-quote">&quot;&lt;form id='selected_image_settings' class='</span><span class="php-var">$formClass</span><span class="php-quote">' method='post' action='</span><span class="php-var">$formActionURL</span><span class="php-quote">'&gt;&quot;</span> .
</span><span id="924" class="l"><a class="l" href="#924"> 924: </a>            <span class="php-quote">&quot;&lt;small class='ui-helper-clearfix'&gt;&quot;</span> . 
</span><span id="925" class="l"><a class="l" href="#925"> 925: </a>            <span class="php-quote">&quot;&lt;p id='wrap_info'&gt;&quot;</span> .
</span><span id="926" class="l"><a class="l" href="#926"> 926: </a>                <span class="php-quote">&quot;&lt;select id='selected_image_class' name='class'&gt;&quot;</span> .
</span><span id="927" class="l"><a class="l" href="#927"> 927: </a>                    <span class="php-quote">&quot;&lt;option value=''&gt;&quot;</span> . <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'No Alignment'</span>) . <span class="php-quote">&quot;&lt;/option&gt;&quot;</span> .
</span><span id="928" class="l"><a class="l" href="#928"> 928: </a>                    <span class="php-var">$classOptions</span> .
</span><span id="929" class="l"><a class="l" href="#929"> 929: </a>                <span class="php-quote">&quot;&lt;/select&gt;&quot;</span> .
</span><span id="930" class="l"><a class="l" href="#930"> 930: </a>                <span class="php-quote">&quot;&lt;span id='action_icons' class='hide_when_crop hide_when_processing'&gt;&quot;</span> .
</span><span id="931" class="l"><a class="l" href="#931"> 931: </a>                    <span class="php-quote">&quot;&lt;span title='</span><span class="php-var">$labels</span><span class="php-quote">[resize]' id='resize_action'&gt;&lt;i class='fa fa-fw fa-arrows-alt'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="932" class="l"><a class="l" href="#932"> 932: </a>                    <span class="php-quote">&quot;&lt;span title='</span><span class="php-var">$labels</span><span class="php-quote">[crop]' data-recrop='</span><span class="php-var">$recropURL</span><span class="php-quote">' id='crop_action'&gt;&lt;i class='fa fa-fw fa-crop'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="933" class="l"><a class="l" href="#933"> 933: </a>                    <span class="php-comment">//&quot;&lt;span title='$labels[rotateLeft]' id='rotate_left_action'&gt;&lt;i class='fa fa-fw fa-rotate-left'&gt;&lt;/i&gt;&lt;/span&gt;&quot; . </span>
</span><span id="934" class="l"><a class="l" href="#934"> 934: </a>                    <span class="php-comment">//&quot;&lt;span title='$labels[rotateRight]' id='rotate_right_action'&gt;&lt;i class='fa fa-fw fa-rotate-right'&gt;&lt;/i&gt;&lt;/span&gt;&quot; .</span>
</span><span id="935" class="l"><a class="l" href="#935"> 935: </a>                    <span class="php-comment">//&quot;&lt;span title='$labels[flipHorizontal]' id='flip_horizontal_action'&gt;&lt;i class='fa fa-fw fa-exchange'&gt;&lt;/i&gt;&lt;/span&gt;&quot; .</span>
</span><span id="936" class="l"><a class="l" href="#936"> 936: </a>                    <span class="php-comment">//&quot;&lt;span title='$labels[flipVertical]' id='flip_vertical_action'&gt;&lt;i class='fa fa-fw fa-exchange fa-rotate-90'&gt;&lt;/i&gt;&lt;/span&gt;&quot; .</span>
</span><span id="937" class="l"><a class="l" href="#937"> 937: </a>                    <span class="php-quote">&quot;&lt;span title='</span><span class="php-var">$labels</span><span class="php-quote">[max] (</span><span class="php-var">{$originalWidth}</span><span class="php-quote">x</span><span class="php-var">{$originalHeight}</span><span class="php-quote">)' id='max_action'&gt;&lt;i class='fa fa-fw fa-expand'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="938" class="l"><a class="l" href="#938"> 938: </a>                    <span class="php-quote">&quot;&lt;span title='</span><span class="php-var">$labels</span><span class="php-quote">[min]' id='min_action'&gt;&lt;i class='fa fa-fw fa-compress'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="939" class="l"><a class="l" href="#939"> 939: </a>                    <span class="php-quote">&quot;&lt;span title='</span><span class="php-var">$labels</span><span class="php-quote">[alignLeft]' data-label='alignLeft' class='align_action show_when_rte' id='align_left_action'&gt;&lt;i class='fa fa-fw fa-align-left'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="940" class="l"><a class="l" href="#940"> 940: </a>                    <span class="php-quote">&quot;&lt;span title='</span><span class="php-var">$labels</span><span class="php-quote">[alignCenter]' data-label='alignCenter' class='align_action show_when_rte' id='align_center_action'&gt;&lt;i class='fa fa-fw fa-align-center'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="941" class="l"><a class="l" href="#941"> 941: </a>                    <span class="php-quote">&quot;&lt;span title='</span><span class="php-var">$labels</span><span class="php-quote">[alignRight]' data-label='alignRight' class='align_action show_when_rte' id='align_right_action'&gt;&lt;i class='fa fa-fw fa-align-right'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="942" class="l"><a class="l" href="#942"> 942: </a>                    <span class="php-quote">&quot;&lt;span title='</span><span class="php-var">$labels</span><span class="php-quote">[description]' id='description_action' class='show_when_rte'&gt;&lt;i class='fa fa-fw fa-quote-left'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="943" class="l"><a class="l" href="#943"> 943: </a>                <span class="php-quote">&quot;&lt;/span&gt;&quot;</span> .
</span><span id="944" class="l"><a class="l" href="#944"> 944: </a>                <span class="php-quote">&quot;&lt;span id='selected_image_pixels' class='hide_when_crop'&gt;&quot;</span> . 
</span><span id="945" class="l"><a class="l" href="#945"> 945: </a>                    <span class="php-quote">&quot;&lt;label&gt;&lt;input title='</span><span class="php-var">$labels</span><span class="php-quote">[width]' name='width' id='input_width' class='input_pixels' &quot;</span> .
</span><span id="946" class="l"><a class="l" href="#946"> 946: </a>                        <span class="php-quote">&quot;type='number' size='6' step='1' data-min='</span><span class="php-var">$minWidth</span><span class="php-quote">' data-max='</span><span class="php-var">$originalWidth</span><span class="php-quote">' value='</span><span class="php-var">$width</span><span class="php-quote">' /&gt;&lt;/label&gt;&quot;</span> .
</span><span id="947" class="l"><a class="l" href="#947"> 947: </a>                    <span class="php-quote">&quot;&amp;nbsp;&lt;i class='fa fa-times'&gt;&lt;/i&gt;&amp;nbsp;&quot;</span> . 
</span><span id="948" class="l"><a class="l" href="#948"> 948: </a>                    <span class="php-quote">&quot;&lt;label&gt;&lt;input title='</span><span class="php-var">$labels</span><span class="php-quote">[height]' name='height' id='input_height' class='input_pixels' &quot;</span> . 
</span><span id="949" class="l"><a class="l" href="#949"> 949: </a>                        <span class="php-quote">&quot;type='number' size='6' step='1' data-min='</span><span class="php-var">$minHeight</span><span class="php-quote">' data-max='</span><span class="php-var">$originalHeight</span><span class="php-quote">' value='</span><span class="php-var">$height</span><span class="php-quote">' /&gt;&lt;/label&gt;&quot;</span> . 
</span><span id="950" class="l"><a class="l" href="#950"> 950: </a>                <span class="php-quote">&quot;&lt;/span&gt; &quot;</span> .
</span><span id="951" class="l"><a class="l" href="#951"> 951: </a>                <span class="php-quote">&quot;&lt;span id='selected_image_checkboxes' class='hide_when_crop'&gt;&quot;</span> . 
</span><span id="952" class="l"><a class="l" href="#952"> 952: </a>                    <span class="php-quote">&quot;&lt;span id='wrap_link_original' class='show_when_rte'&gt;&quot;</span> .
</span><span id="953" class="l"><a class="l" href="#953"> 953: </a>                        <span class="php-quote">&quot;&lt;label class='checkbox'&gt;&quot;</span> .
</span><span id="954" class="l"><a class="l" href="#954"> 954: </a>                            <span class="php-quote">&quot;&lt;input title='</span><span class="php-var">$labels</span><span class="php-quote">[linkOriginal]' type='checkbox' </span><span class="php-var">$linkOriginalChecked</span><span class="php-quote"> &quot;</span> .
</span><span id="955" class="l"><a class="l" href="#955"> 955: </a>                                <span class="php-quote">&quot;name='selected_image_link' id='selected_image_link' value='</span><span class="php-var">{$original-&gt;url}</span><span class="php-quote">' /&gt; &quot;</span> .
</span><span id="956" class="l"><a class="l" href="#956"> 956: </a>                            <span class="php-quote">&quot;&lt;i class='fa fa-link ui-priority-secondary'&gt;&lt;/i&gt;&amp;nbsp;&quot;</span> .
</span><span id="957" class="l"><a class="l" href="#957"> 957: </a>                            <span class="php-quote">&quot;</span><span class="php-var">{$original-&gt;width}</span><span class="php-quote">x</span><span class="php-var">{$original-&gt;height}</span><span class="php-quote">&quot;</span> .
</span><span id="958" class="l"><a class="l" href="#958"> 958: </a>                        <span class="php-quote">&quot;&lt;/label&gt;&quot;</span> .
</span><span id="959" class="l"><a class="l" href="#959"> 959: </a>                    <span class="php-quote">&quot;&lt;/span&gt;&quot;</span> . 
</span><span id="960" class="l"><a class="l" href="#960"> 960: </a>                    <span class="php-quote">&quot;&lt;span id='wrap_caption' class='show_when_rte'&gt;&quot;</span> .
</span><span id="961" class="l"><a class="l" href="#961"> 961: </a>                        <span class="php-quote">&quot;&lt;label class='checkbox'&gt;&quot;</span> .
</span><span id="962" class="l"><a class="l" href="#962"> 962: </a>                            <span class="php-quote">&quot;&lt;input</span><span class="php-var">$captionChecked</span><span class="php-quote"> id='selected_image_caption' type='checkbox' value='1' title='</span><span class="php-var">$labels</span><span class="php-quote">[captionTip]' /&gt;&amp;nbsp;</span><span class="php-var">$labels</span><span class="php-quote">[caption]&quot;</span> .
</span><span id="963" class="l"><a class="l" href="#963"> 963: </a>                        <span class="php-quote">&quot;&lt;/label&gt;&quot;</span> .
</span><span id="964" class="l"><a class="l" href="#964"> 964: </a>                    <span class="php-quote">&quot;&lt;/span&gt;&quot;</span> . 
</span><span id="965" class="l"><a class="l" href="#965"> 965: </a>                    <span class="php-quote">&quot;&lt;span id='wrap_hidpi' class='show_when_rte'&gt;&quot;</span> .
</span><span id="966" class="l"><a class="l" href="#966"> 966: </a>                        <span class="php-quote">&quot;&lt;label class='checkbox'&gt;&quot;</span> . 
</span><span id="967" class="l"><a class="l" href="#967"> 967: </a>                            <span class="php-quote">&quot;&lt;input</span><span class="php-var">$hidpiChecked</span><span class="php-quote"> id='selected_image_hidpi' type='checkbox' value='1' /&gt;&amp;nbsp;</span><span class="php-var">$labels</span><span class="php-quote">[hidpi]&quot;</span> . 
</span><span id="968" class="l"><a class="l" href="#968"> 968: </a>                        <span class="php-quote">&quot;&lt;/label&gt;&quot;</span> .
</span><span id="969" class="l"><a class="l" href="#969"> 969: </a>                    <span class="php-quote">&quot;&lt;/span&gt;&quot;</span> .
</span><span id="970" class="l"><a class="l" href="#970"> 970: </a>                <span class="php-quote">&quot;&lt;/span&gt;&quot;</span> . <span class="php-comment">// selected_image_checkboxes</span>
</span><span id="971" class="l"><a class="l" href="#971"> 971: </a>                <span class="php-quote">&quot;&lt;span id='selected_image_resize' class='hide_when_rte hide_when_crop hide_when_processing'&gt;&quot;</span> .
</span><span id="972" class="l"><a class="l" href="#972"> 972: </a>                    <span class="php-quote">&quot;&lt;i class='fa fa-angle-left ui-priority-secondary'&gt;&lt;/i&gt;&amp;nbsp;&quot;</span> .
</span><span id="973" class="l"><a class="l" href="#973"> 973: </a>                    <span class="php-quote">&quot;</span><span class="php-var">$labels</span><span class="php-quote">[useResize]&amp;nbsp;&amp;nbsp;&quot;</span> .
</span><span id="974" class="l"><a class="l" href="#974"> 974: </a>                    <span class="php-quote">&quot;&lt;label class='checkbox'&gt;&lt;input</span><span class="php-var">$resizeYesChecked</span><span class="php-quote"> id='selected_image_resize_yes' name='use_resize' type='radio' value='1' /&gt;&amp;nbsp;</span><span class="php-var">$labels</span><span class="php-quote">[yes]&lt;/label&gt;&amp;nbsp;&amp;nbsp;&quot;</span> .
</span><span id="975" class="l"><a class="l" href="#975"> 975: </a>                    <span class="php-quote">&quot;&lt;label class='checkbox'&gt;&lt;input</span><span class="php-var">$resizeNoChecked</span><span class="php-quote"> id='selected_image_resize_no' name='use_resize' type='radio' value='0' /&gt;&amp;nbsp;&quot;</span> .
</span><span id="976" class="l"><a class="l" href="#976"> 976: </a>                    <span class="php-keyword2">sprintf</span>(<span class="php-var">$labels</span>[<span class="php-quote">'noUse'</span>], <span class="php-var">$originalDimension</span>) . <span class="php-quote">&quot;&lt;/label&gt;&quot;</span> .
</span><span id="977" class="l"><a class="l" href="#977"> 977: </a>                <span class="php-quote">&quot;&lt;/span&gt;&quot;</span> . 
</span><span id="978" class="l"><a class="l" href="#978"> 978: </a>                <span class="php-quote">&quot;&lt;button type='button' class='ui-button ui-state-active show_when_processing' id='button_saving'&gt;&quot;</span> .
</span><span id="979" class="l"><a class="l" href="#979"> 979: </a>                    <span class="php-quote">&quot;&lt;span class='ui-button-text'&gt;&lt;i class='fa fa-spin fa-spinner'&gt;&lt;/i&gt; </span><span class="php-var">$labels</span><span class="php-quote">[saving]&lt;/span&gt;&quot;</span> .
</span><span id="980" class="l"><a class="l" href="#980"> 980: </a>                <span class="php-quote">&quot;&lt;/button&gt; &quot;</span> .
</span><span id="981" class="l"><a class="l" href="#981"> 981: </a>                <span class="php-quote">&quot;&lt;span class='show_when_crop'&gt;&quot;</span> .
</span><span id="982" class="l"><a class="l" href="#982"> 982: </a>                    <span class="php-quote">&quot;&lt;button type='submit' class='ui-button ui-state-default hide_when_processing' id='button_crop' name='submit_crop' value='1'&gt;&quot;</span> .
</span><span id="983" class="l"><a class="l" href="#983"> 983: </a>                        <span class="php-quote">&quot;&lt;span class='ui-button-text'&gt;&lt;i class='fa fa-crop'&gt;&lt;/i&gt; </span><span class="php-var">$labels</span><span class="php-quote">[saveCrop]&lt;/span&gt;&quot;</span> .
</span><span id="984" class="l"><a class="l" href="#984"> 984: </a>                    <span class="php-quote">&quot;&lt;/button&gt; &quot;</span> .
</span><span id="985" class="l"><a class="l" href="#985"> 985: </a>                    <span class="php-quote">&quot;&lt;button type='button' class='hide_when_processing ui-button ui-state-default ui-priority-secondary' id='button_cancel_crop'&gt;&quot;</span> .
</span><span id="986" class="l"><a class="l" href="#986"> 986: </a>                        <span class="php-quote">&quot;&lt;span class='ui-button-text'&gt;&lt;i class='fa fa-times-circle'&gt;&lt;/i&gt; </span><span class="php-var">$labels</span><span class="php-quote">[cancel]&lt;/span&gt;&quot;</span> .
</span><span id="987" class="l"><a class="l" href="#987"> 987: </a>                    <span class="php-quote">&quot;&lt;/button&gt; &amp;nbsp; &quot;</span> . 
</span><span id="988" class="l"><a class="l" href="#988"> 988: </a>                    <span class="php-quote">&quot;&lt;span id='crop_coordinates'&gt;&quot;</span> . 
</span><span id="989" class="l"><a class="l" href="#989"> 989: </a>                        <span class="php-quote">&quot;&lt;label&gt;</span><span class="php-var">$labels</span><span class="php-quote">[left]&amp;nbsp;&lt;input name='crop_x' id='crop_x' class='input_pixels' type='number' size='6' step='1' min='0' /&gt;&lt;/label&gt;&amp;nbsp; &quot;</span> .
</span><span id="990" class="l"><a class="l" href="#990"> 990: </a>                        <span class="php-quote">&quot;&lt;label&gt;</span><span class="php-var">$labels</span><span class="php-quote">[top]&amp;nbsp;&lt;input name='crop_y' id='crop_y' class='input_pixels' type='number' size='6' step='1' min='0' /&gt;&lt;/label&gt;&amp;nbsp; &quot;</span> .
</span><span id="991" class="l"><a class="l" href="#991"> 991: </a>                        <span class="php-quote">&quot;&lt;label&gt;</span><span class="php-var">$labels</span><span class="php-quote">[width]&amp;nbsp;&lt;input name='crop_w' id='crop_w' class='input_pixels' type='number' size='6' step='1' min='0' /&gt;&lt;/label&gt;&amp;nbsp; &quot;</span> .
</span><span id="992" class="l"><a class="l" href="#992"> 992: </a>                        <span class="php-quote">&quot;&lt;label&gt;</span><span class="php-var">$labels</span><span class="php-quote">[height]&amp;nbsp;&lt;input name='crop_h' id='crop_h' class='input_pixels' type='number' size='6' step='1' min='0' /&gt;&lt;/label&gt;&amp;nbsp; &quot;</span> .
</span><span id="993" class="l"><a class="l" href="#993"> 993: </a>                    <span class="php-quote">&quot;&lt;/span&gt;&quot;</span> . 
</span><span id="994" class="l"><a class="l" href="#994"> 994: </a>                <span class="php-quote">&quot;&lt;/span&gt;&quot;</span> .
</span><span id="995" class="l"><a class="l" href="#995"> 995: </a>                <span class="php-quote">&quot;&lt;button type='button' id='loading_button' class='ui-button ui-state-default'&gt;&quot;</span> .
</span><span id="996" class="l"><a class="l" href="#996"> 996: </a>                    <span class="php-quote">&quot;&lt;span class='ui-button-text'&gt;&quot;</span> . <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Loading...'</span>)  .<span class="php-quote">&quot;&lt;/span&gt;&quot;</span> .
</span><span id="997" class="l"><a class="l" href="#997"> 997: </a>                <span class="php-quote">&quot;&lt;/button&gt;&quot;</span> . 
</span><span id="998" class="l"><a class="l" href="#998"> 998: </a>            <span class="php-quote">&quot;&lt;/p&gt;&quot;</span> . 
</span><span id="999" class="l"><a class="l" href="#999"> 999: </a>            <span class="php-quote">&quot;&lt;p id='wrap_description' class='show_when_rte'&gt;&quot;</span> . 
</span><span id="1000" class="l"><a class="l" href="#1000">1000: </a>                <span class="php-quote">&quot;&lt;label for='selected_image_description'&gt;</span><span class="php-var">$labels</span><span class="php-quote">[description]&lt;/label&gt;&quot;</span> . 
</span><span id="1001" class="l"><a class="l" href="#1001">1001: </a>                <span class="php-quote">&quot;&lt;input type='text' name='selected_image_description' &quot;</span> . 
</span><span id="1002" class="l"><a class="l" href="#1002">1002: </a>                    <span class="php-quote">&quot;id='selected_image_description' title='</span><span class="php-var">$description</span><span class="php-quote">' class='InputfieldNoFocus' value=\&quot;</span><span class="php-var">$description</span><span class="php-quote">\&quot; /&gt;&quot;</span> . 
</span><span id="1003" class="l"><a class="l" href="#1003">1003: </a>            <span class="php-quote">&quot;&lt;/p&gt;&quot;</span> . 
</span><span id="1004" class="l"><a class="l" href="#1004">1004: </a>            <span class="php-quote">&quot;&lt;/small&gt;&quot;</span> . 
</span><span id="1005" class="l"><a class="l" href="#1005">1005: </a>            <span class="php-comment">//&quot;&lt;p class='notes hide_when_rte'&gt;Please note: this feature is still in development.&lt;/p&gt;&quot; . </span>
</span><span id="1006" class="l"><a class="l" href="#1006">1006: </a>            <span class="php-quote">&quot;&lt;figure id='selected_image_container'&gt;&quot;</span> . 
</span><span id="1007" class="l"><a class="l" href="#1007">1007: </a>                <span class="php-quote">&quot;&lt;img id='selected_image' </span><span class="php-var">$attrStr</span><span class="php-quote"> alt='' &quot;</span> . 
</span><span id="1008" class="l"><a class="l" href="#1008">1008: </a>                    <span class="php-quote">&quot;data-idname='</span><span class="php-var">{$image-&gt;page-&gt;id}</span><span class="php-quote">,</span><span class="php-var">{$image-&gt;basename}</span><span class="php-quote">' src='</span><span class="php-var">{$imageURL}</span><span class="php-quote">' /&gt;&quot;</span> . 
</span><span id="1009" class="l"><a class="l" href="#1009">1009: </a>                <span class="php-quote">&quot;&lt;span id='resize_tips'&gt;&quot;</span> .
</span><span id="1010" class="l"><a class="l" href="#1010">1010: </a>                    <span class="php-quote">&quot;&lt;span class='resize_tip' id='resize_tip_nw'&gt;&lt;i class='fa fa-fw fa-expand fa-flip-horizontal'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="1011" class="l"><a class="l" href="#1011">1011: </a>                    <span class="php-quote">&quot;&lt;span class='resize_tip' id='resize_tip_n'&gt;&lt;i class='fa fa-fw fa-arrows-v'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="1012" class="l"><a class="l" href="#1012">1012: </a>                    <span class="php-quote">&quot;&lt;span class='resize_tip' id='resize_tip_ne'&gt;&lt;i class='fa fa-fw fa-expand'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="1013" class="l"><a class="l" href="#1013">1013: </a>                    <span class="php-quote">&quot;&lt;span class='resize_tip' id='resize_tip_e'&gt;&lt;i class='fa fa-fw fa-arrows-h'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="1014" class="l"><a class="l" href="#1014">1014: </a>                    <span class="php-quote">&quot;&lt;span class='resize_tip' id='resize_tip_se'&gt;&lt;i class='fa fa-fw fa-expand fa-flip-horizontal'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="1015" class="l"><a class="l" href="#1015">1015: </a>                    <span class="php-quote">&quot;&lt;span class='resize_tip' id='resize_tip_s'&gt;&lt;i class='fa fa-fw fa-arrows-v'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="1016" class="l"><a class="l" href="#1016">1016: </a>                    <span class="php-quote">&quot;&lt;span class='resize_tip' id='resize_tip_sw'&gt;&lt;i class='fa fa-fw fa-expand'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> .
</span><span id="1017" class="l"><a class="l" href="#1017">1017: </a>                    <span class="php-quote">&quot;&lt;span class='resize_tip' id='resize_tip_w'&gt;&lt;i class='fa fa-fw fa-arrows-h'&gt;&lt;/i&gt;&lt;/span&gt;&quot;</span> . 
</span><span id="1018" class="l"><a class="l" href="#1018">1018: </a>                <span class="php-quote">&quot;&lt;/span&gt;&quot;</span> .
</span><span id="1019" class="l"><a class="l" href="#1019">1019: </a>                <span class="php-quote">&quot;&lt;figcaption id='caption_preview' class='show_when_rte'&gt;&quot;</span> . 
</span><span id="1020" class="l"><a class="l" href="#1020">1020: </a>                    <span class="php-quote">&quot;&lt;a class='tooltip' title='</span><span class="php-var">$labels</span><span class="php-quote">[captionTip]'&gt;</span><span class="php-var">$labels</span><span class="php-quote">[captionText]&lt;/a&gt;&quot;</span> . 
</span><span id="1021" class="l"><a class="l" href="#1021">1021: </a>                <span class="php-quote">&quot;&lt;/figcaption&gt;&quot;</span> . 
</span><span id="1022" class="l"><a class="l" href="#1022">1022: </a>            <span class="php-quote">&quot;&lt;/figure&gt;&quot;</span> .
</span><span id="1023" class="l"><a class="l" href="#1023">1023: </a>            <span class="php-quote">&quot;&lt;p id='latin'&gt;&quot;</span> . 
</span><span id="1024" class="l"><a class="l" href="#1024">1024: </a>                <span class="php-quote">&quot;&lt;span id='latin-fade'&gt;&lt;/span&gt;&quot;</span> . <span class="php-var">$this</span>-&gt;getLatin(<span class="php-num">2</span>) . 
</span><span id="1025" class="l"><a class="l" href="#1025">1025: </a>            <span class="php-quote">&quot;&lt;/p&gt;&quot;</span> . 
</span><span id="1026" class="l"><a class="l" href="#1026">1026: </a>            <span class="php-quote">&quot;&lt;span id='selected_image_filename'&gt;</span><span class="php-var">$basename</span><span class="php-quote">&lt;/span&gt;&quot;</span> .
</span><span id="1027" class="l"><a class="l" href="#1027">1027: </a>            <span class="php-quote">&quot;&lt;input type='hidden' name='page_id' id='page_id' value='</span><span class="php-var">{$this-&gt;page-&gt;id}</span><span class="php-quote">' /&gt;&quot;</span> .
</span><span id="1028" class="l"><a class="l" href="#1028">1028: </a>            <span class="php-quote">&quot;&lt;input type='hidden' name='selected_image_rotate' id='selected_image_rotate' value='0' /&gt;&quot;</span> .
</span><span id="1029" class="l"><a class="l" href="#1029">1029: </a>            <span class="php-quote">&quot;&lt;p id='non_rte_dialog_buttons' class='hide_when_rte'&gt;&quot;</span> . 
</span><span id="1030" class="l"><a class="l" href="#1030">1030: </a>                (!<span class="php-keyword2">in_array</span>(<span class="php-quote">'maxfiles1'</span>, <span class="php-var">$formClasses</span>) ? (
</span><span id="1031" class="l"><a class="l" href="#1031">1031: </a>                    <span class="php-quote">&quot;&lt;button type='submit' name='submit_save_copy' value='1' class='submit_save_copy ui-button ui-state-default hide_when_maxfiles1'&gt;&quot;</span> .
</span><span id="1032" class="l"><a class="l" href="#1032">1032: </a>                        <span class="php-quote">&quot;&lt;span class='ui-button-text'&gt;&lt;i class='fa fa-fw fa-paste'&gt;&lt;/i&gt; </span><span class="php-var">$labels</span><span class="php-quote">[saveCopy]&lt;/span&gt;&quot;</span> .
</span><span id="1033" class="l"><a class="l" href="#1033">1033: </a>                    <span class="php-quote">&quot;&lt;/button&gt;&quot;</span> 
</span><span id="1034" class="l"><a class="l" href="#1034">1034: </a>                    ) : <span class="php-quote">&quot;&quot;</span>) . 
</span><span id="1035" class="l"><a class="l" href="#1035">1035: </a>                <span class="php-quote">&quot;&lt;button type='submit' name='submit_save_replace' value='1' class='submit_save_replace ui-button ui-state-default'&gt;&quot;</span> .
</span><span id="1036" class="l"><a class="l" href="#1036">1036: </a>                    <span class="php-quote">&quot;&lt;span class='ui-button-text'&gt;&lt;i class='fa fa-fw fa-cut'&gt;&lt;/i&gt; </span><span class="php-var">$labels</span><span class="php-quote">[saveReplace]&lt;/span&gt;&quot;</span> .
</span><span id="1037" class="l"><a class="l" href="#1037">1037: </a>                <span class="php-quote">&quot;&lt;/button&gt;&quot;</span> .
</span><span id="1038" class="l"><a class="l" href="#1038">1038: </a>                <span class="php-quote">&quot;&lt;button type='button' id='non_rte_cancel' class='ui-button ui-state-default ui-priority-secondary'&gt;&quot;</span> . 
</span><span id="1039" class="l"><a class="l" href="#1039">1039: </a>                    <span class="php-quote">&quot;&lt;span class='ui-button-text'&gt;&lt;i class='fa fa-fw fa-times-circle'&gt;&lt;/i&gt; </span><span class="php-var">$labels</span><span class="php-quote">[cancel]&lt;/span&gt;&quot;</span> . 
</span><span id="1040" class="l"><a class="l" href="#1040">1040: </a>                <span class="php-quote">&quot;&lt;/button&gt;&quot;</span> . 
</span><span id="1041" class="l"><a class="l" href="#1041">1041: </a>            <span class="php-quote">&quot;&lt;/p&gt;&quot;</span>  .
</span><span id="1042" class="l"><a class="l" href="#1042">1042: </a>            <span class="php-quote">&quot;&lt;/form&gt;&quot;</span>;
</span><span id="1043" class="l"><a class="l" href="#1043">1043: </a>        
</span><span id="1044" class="l"><a class="l" href="#1044">1044: </a>        <span class="php-comment">// if($this-&gt;wire('config')-&gt;debug) $out .= &quot;&lt;p class='detail'&gt;$basename&lt;/p&gt;&quot;;</span>
</span><span id="1045" class="l"><a class="l" href="#1045">1045: </a>        
</span><span id="1046" class="l"><a class="l" href="#1046">1046: </a>        <span class="php-keyword1">return</span> <span class="php-var">$out</span>; 
</span><span id="1047" class="l"><a class="l" href="#1047">1047: </a>        
</span><span id="1048" class="l"><a class="l" href="#1048">1048: </a>    }
</span><span id="1049" class="l"><a class="l" href="#1049">1049: </a>
</span><span id="1050" class="l"><a class="l" href="#1050">1050: </a>    <span class="php-comment">/**
</span></span><span id="1051" class="l"><a class="l" href="#1051">1051: </a><span class="php-comment">     * Get a bunch of latin text
</span></span><span id="1052" class="l"><a class="l" href="#1052">1052: </a><span class="php-comment">     * 
</span></span><span id="1053" class="l"><a class="l" href="#1053">1053: </a><span class="php-comment">     * @param int $n How many blocks of latin to get (default=1)
</span></span><span id="1054" class="l"><a class="l" href="#1054">1054: </a><span class="php-comment">     * @return string
</span></span><span id="1055" class="l"><a class="l" href="#1055">1055: </a><span class="php-comment">     * 
</span></span><span id="1056" class="l"><a class="l" href="#1056">1056: </a><span class="php-comment">     */</span>
</span><span id="1057" class="l"><a class="l" href="#1057">1057: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> <a id="_getLatin" href="#_getLatin">getLatin</a>(<span class="php-var">$n</span> = <span class="php-num">1</span>) {
</span><span id="1058" class="l"><a class="l" href="#1058">1058: </a>        <span class="php-var">$latin</span> = <span class="php-quote">&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. In malesuada magna ex. Donec sed consectetur felis, 
</span></span><span id="1059" class="l"><a class="l" href="#1059">1059: </a><span class="php-quote">            ac molestie massa. Duis fermentum rutrum vehicula. Praesent consequat efficitur dolor quis vestibulum.
</span></span><span id="1060" class="l"><a class="l" href="#1060">1060: </a><span class="php-quote">            Sed vulputate, nisi et efficitur semper, erat odio scelerisque massa, nec convallis leo ipsum ac eros. Donec a 
</span></span><span id="1061" class="l"><a class="l" href="#1061">1061: </a><span class="php-quote">            augue eleifend, pellentesque sapien a, tristique orci. Sed ac leo vel libero iaculis facilisis in at mauris.
</span></span><span id="1062" class="l"><a class="l" href="#1062">1062: </a><span class="php-quote">            Etiam vitae mi cursus nisl gravida vulputate. Nam in magna risus. Nullam vel suscipit lacus. Ut sit amet malesuada 
</span></span><span id="1063" class="l"><a class="l" href="#1063">1063: </a><span class="php-quote">            massa. Etiam rhoncus, tellus vel porta dignissim, elit massa cursus tortor, vitae fermentum dolor augue ac tortor.
</span></span><span id="1064" class="l"><a class="l" href="#1064">1064: </a><span class="php-quote">            Aliquam eleifend mi at dictum pulvinar. Sed bibendum dolor non mi placerat, euismod euismod est commodo.
</span></span><span id="1065" class="l"><a class="l" href="#1065">1065: </a><span class="php-quote">            Vivamus ultrices orci arcu, sed pulvinar tellus molestie quis. Quisque pharetra velit a metus mattis, vitae 
</span></span><span id="1066" class="l"><a class="l" href="#1066">1066: </a><span class="php-quote">            fermentum orci hendrerit. Fusce id libero ac urna ultrices consequat. Donec lorem lacus, dignissim vitae faucibus 
</span></span><span id="1067" class="l"><a class="l" href="#1067">1067: </a><span class="php-quote">            eget, tincidunt sit amet felis. Aenean tempor quis sapien vitae euismod. Donec mattis mi at sem egestas interdum.
</span></span><span id="1068" class="l"><a class="l" href="#1068">1068: </a><span class="php-quote">            Integer sed diam finibus, volutpat lectus ac, ornare dui. Suspendisse potenti. Suspendisse sagittis interdum 
</span></span><span id="1069" class="l"><a class="l" href="#1069">1069: </a><span class="php-quote">            elit sodales commodo. Maecenas porttitor mi sit amet velit porta, sit amet eleifend massa malesuada. Phasellus 
</span></span><span id="1070" class="l"><a class="l" href="#1070">1070: </a><span class="php-quote">            luctus nibh id sem venenatis, dictum fermentum turpis hendrerit. Nam tempor, ex eu sagittis gravida, mi lorem 
</span></span><span id="1071" class="l"><a class="l" href="#1071">1071: </a><span class="php-quote">            maximus ex, aliquam commodo nunc leo et lacus. Nunc vel faucibus lacus, non pellentesque elit. Nulla non rutrum 
</span></span><span id="1072" class="l"><a class="l" href="#1072">1072: </a><span class="php-quote">            magna, nec porta augue. &quot;</span>;
</span><span id="1073" class="l"><a class="l" href="#1073">1073: </a>        <span class="php-var">$out</span> = <span class="php-quote">''</span>;
</span><span id="1074" class="l"><a class="l" href="#1074">1074: </a>        <span class="php-keyword1">for</span>(<span class="php-var">$c</span> = <span class="php-num">1</span>; <span class="php-var">$c</span> &lt;= <span class="php-var">$n</span>; <span class="php-var">$c</span>++) <span class="php-var">$out</span> .= <span class="php-var">$latin</span>;
</span><span id="1075" class="l"><a class="l" href="#1075">1075: </a>        <span class="php-keyword1">return</span> <span class="php-var">$out</span>; 
</span><span id="1076" class="l"><a class="l" href="#1076">1076: </a>    }
</span><span id="1077" class="l"><a class="l" href="#1077">1077: </a>
</span><span id="1078" class="l"><a class="l" href="#1078">1078: </a>    <span class="php-comment">/**
</span></span><span id="1079" class="l"><a class="l" href="#1079">1079: </a><span class="php-comment">     * Process an image crop from submitted POST vars
</span></span><span id="1080" class="l"><a class="l" href="#1080">1080: </a><span class="php-comment">     * 
</span></span><span id="1081" class="l"><a class="l" href="#1081">1081: </a><span class="php-comment">     * @return Pageimage
</span></span><span id="1082" class="l"><a class="l" href="#1082">1082: </a><span class="php-comment">     * @throws WireException
</span></span><span id="1083" class="l"><a class="l" href="#1083">1083: </a><span class="php-comment">     * 
</span></span><span id="1084" class="l"><a class="l" href="#1084">1084: </a><span class="php-comment">     */</span>
</span><span id="1085" class="l"><a class="l" href="#1085">1085: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> <a id="_processCrop" href="#_processCrop">processCrop</a>() {
</span><span id="1086" class="l"><a class="l" href="#1086">1086: </a>    
</span><span id="1087" class="l"><a class="l" href="#1087">1087: </a>        <span class="php-var">$post</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;post; 
</span><span id="1088" class="l"><a class="l" href="#1088">1088: </a>        
</span><span id="1089" class="l"><a class="l" href="#1089">1089: </a>        <span class="php-var">$cropX</span> = (int) <span class="php-var">$post</span>-&gt;crop_x;
</span><span id="1090" class="l"><a class="l" href="#1090">1090: </a>        <span class="php-var">$cropY</span> = (int) <span class="php-var">$post</span>-&gt;crop_y; 
</span><span id="1091" class="l"><a class="l" href="#1091">1091: </a>        <span class="php-var">$cropW</span> = (int) <span class="php-var">$post</span>-&gt;crop_w;
</span><span id="1092" class="l"><a class="l" href="#1092">1092: </a>        <span class="php-var">$cropH</span> = (int) <span class="php-var">$post</span>-&gt;crop_h; 
</span><span id="1093" class="l"><a class="l" href="#1093">1093: </a>        
</span><span id="1094" class="l"><a class="l" href="#1094">1094: </a>        <span class="php-var">$image</span> = <span class="php-var">$this</span>-&gt;getPageimage();
</span><span id="1095" class="l"><a class="l" href="#1095">1095: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$image</span>) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Unable to load image&quot;</span>);
</span><span id="1096" class="l"><a class="l" href="#1096">1096: </a>
</span><span id="1097" class="l"><a class="l" href="#1097">1097: </a>        
</span><span id="1098" class="l"><a class="l" href="#1098">1098: </a>        <span class="php-var">$suffix</span> = <span class="php-var">$this</span>-&gt;rte ? <span class="php-keyword1">array</span>(<span class="php-quote">'is'</span>) : <span class="php-keyword1">array</span>();
</span><span id="1099" class="l"><a class="l" href="#1099">1099: </a>        <span class="php-var">$options</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'cleanFilename'</span> =&gt; <span class="php-keyword1">true</span>, <span class="php-quote">'suffix'</span> =&gt; <span class="php-var">$suffix</span>);
</span><span id="1100" class="l"><a class="l" href="#1100">1100: </a>        <span class="php-var">$crop</span> = <span class="php-var">$image</span>-&gt;crop(<span class="php-var">$cropX</span>, <span class="php-var">$cropY</span>, <span class="php-var">$cropW</span>, <span class="php-var">$cropH</span>, <span class="php-var">$options</span>); 
</span><span id="1101" class="l"><a class="l" href="#1101">1101: </a>        
</span><span id="1102" class="l"><a class="l" href="#1102">1102: </a>        <span class="php-keyword1">return</span> <span class="php-var">$crop</span>; 
</span><span id="1103" class="l"><a class="l" href="#1103">1103: </a>    }
</span><span id="1104" class="l"><a class="l" href="#1104">1104: </a>
</span><span id="1105" class="l"><a class="l" href="#1105">1105: </a>    <span class="php-comment">/**
</span></span><span id="1106" class="l"><a class="l" href="#1106">1106: </a><span class="php-comment">     * Save resized image and existing eisting or create a copy
</span></span><span id="1107" class="l"><a class="l" href="#1107">1107: </a><span class="php-comment">     * 
</span></span><span id="1108" class="l"><a class="l" href="#1108">1108: </a><span class="php-comment">     * @param bool $replace Replace existing image? (default=false)
</span></span><span id="1109" class="l"><a class="l" href="#1109">1109: </a><span class="php-comment">     * @return string Returns status output which may appear momentarily while dialog updating
</span></span><span id="1110" class="l"><a class="l" href="#1110">1110: </a><span class="php-comment">     * @throws WireException
</span></span><span id="1111" class="l"><a class="l" href="#1111">1111: </a><span class="php-comment">     * 
</span></span><span id="1112" class="l"><a class="l" href="#1112">1112: </a><span class="php-comment">     */</span>
</span><span id="1113" class="l"><a class="l" href="#1113">1113: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> <a id="_processSave" href="#_processSave">processSave</a>(<span class="php-var">$replace</span> = <span class="php-keyword1">false</span>) {
</span><span id="1114" class="l"><a class="l" href="#1114">1114: </a>        
</span><span id="1115" class="l"><a class="l" href="#1115">1115: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;field) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Field is not defined&quot;</span>); 
</span><span id="1116" class="l"><a class="l" href="#1116">1116: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;original) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Original is not set&quot;</span>);
</span><span id="1117" class="l"><a class="l" href="#1117">1117: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;page-&gt;hasStatus(Page::statusLocked)) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Page is locked for edits&quot;</span>); 
</span><span id="1118" class="l"><a class="l" href="#1118">1118: </a>        
</span><span id="1119" class="l"><a class="l" href="#1119">1119: </a>        <span class="php-var">$image</span> = <span class="php-var">$this</span>-&gt;getPageimage(<span class="php-keyword1">false</span>);
</span><span id="1120" class="l"><a class="l" href="#1120">1120: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;input-&gt;get(<span class="php-quote">'file'</span>) != <span class="php-quote">&quot;</span><span class="php-var">$this</span><span class="php-quote">-&gt;page,</span><span class="php-var">$image</span><span class="php-quote">-&gt;name&quot;</span>) <span class="php-var">$image</span> = <span class="php-var">$this</span>-&gt;getPageimage(<span class="php-keyword1">true</span>); 
</span><span id="1121" class="l"><a class="l" href="#1121">1121: </a>        <span class="php-var">$width</span> = (int) <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;post(<span class="php-quote">'width'</span>);
</span><span id="1122" class="l"><a class="l" href="#1122">1122: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$width</span>) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;Width not specified&quot;</span>); 
</span><span id="1123" class="l"><a class="l" href="#1123">1123: </a>
</span><span id="1124" class="l"><a class="l" href="#1124">1124: </a>        <span class="php-var">$rebuildVariations</span> = <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/-cropx\d+y\d+/'</span>, <span class="php-var">$image</span>-&gt;name); 
</span><span id="1125" class="l"><a class="l" href="#1125">1125: </a>        <span class="php-var">$useResize</span> = ((int) <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;post(<span class="php-quote">'use_resize'</span>)) == <span class="php-num">1</span>;
</span><span id="1126" class="l"><a class="l" href="#1126">1126: </a>        
</span><span id="1127" class="l"><a class="l" href="#1127">1127: </a>        <span class="php-comment">// image2 = resized version</span>
</span><span id="1128" class="l"><a class="l" href="#1128">1128: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$useResize</span>) {
</span><span id="1129" class="l"><a class="l" href="#1129">1129: </a>            <span class="php-var">$image2</span> = <span class="php-var">$image</span>-&gt;width(<span class="php-var">$width</span>);
</span><span id="1130" class="l"><a class="l" href="#1130">1130: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$image2</span> || !<span class="php-var">$image2</span>-&gt;width) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">'Unable to complete resize'</span>);
</span><span id="1131" class="l"><a class="l" href="#1131">1131: </a>        } <span class="php-keyword1">else</span> {
</span><span id="1132" class="l"><a class="l" href="#1132">1132: </a>            <span class="php-var">$image2</span> = <span class="php-var">$image</span>; 
</span><span id="1133" class="l"><a class="l" href="#1133">1133: </a>        }
</span><span id="1134" class="l"><a class="l" href="#1134">1134: </a>    
</span><span id="1135" class="l"><a class="l" href="#1135">1135: </a>        <span class="php-comment">/** @var Pageimages $pageimages */</span>
</span><span id="1136" class="l"><a class="l" href="#1136">1136: </a>        <span class="php-var">$pageimages</span> = <span class="php-var">$this</span>-&gt;page-&gt;getUnformatted(<span class="php-var">$this</span>-&gt;field-&gt;name);
</span><span id="1137" class="l"><a class="l" href="#1137">1137: </a>        <span class="php-var">$path</span> = <span class="php-var">$pageimages</span>-&gt;path();
</span><span id="1138" class="l"><a class="l" href="#1138">1138: </a>        <span class="php-var">$fileID</span> = <span class="php-quote">''</span>;
</span><span id="1139" class="l"><a class="l" href="#1139">1139: </a>        <span class="php-var">$isNew</span> = <span class="php-num">0</span>;
</span><span id="1140" class="l"><a class="l" href="#1140">1140: </a>        <span class="php-var">$body</span> = <span class="php-quote">''</span>;
</span><span id="1141" class="l"><a class="l" href="#1141">1141: </a>
</span><span id="1142" class="l"><a class="l" href="#1142">1142: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$replace</span>) {
</span><span id="1143" class="l"><a class="l" href="#1143">1143: </a>            <span class="php-comment">// replace original image</span>
</span><span id="1144" class="l"><a class="l" href="#1144">1144: </a>            
</span><span id="1145" class="l"><a class="l" href="#1145">1145: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;original &amp;&amp; <span class="php-var">$this</span>-&gt;original != <span class="php-var">$image2</span>-&gt;<span class="php-keyword2">basename</span>() &amp;&amp; <span class="php-var">$original</span> = <span class="php-var">$image</span>-&gt;pagefiles-&gt;get(<span class="php-var">$this</span>-&gt;original)) {
</span><span id="1146" class="l"><a class="l" href="#1146">1146: </a>                <span class="php-var">$fileID</span> = <span class="php-quote">'file_'</span> . <span class="php-var">$original</span>-&gt;<span class="php-keyword2">hash</span>; 
</span><span id="1147" class="l"><a class="l" href="#1147">1147: </a>                
</span><span id="1148" class="l"><a class="l" href="#1148">1148: </a>                <span class="php-keyword1">if</span>(<span class="php-var">$rebuildVariations</span> &amp;&amp; <span class="php-var">$this</span>-&gt;field-&gt;adminThumbs) {
</span><span id="1149" class="l"><a class="l" href="#1149">1149: </a>                    <span class="php-comment">// remove original thumbnail</span>
</span><span id="1150" class="l"><a class="l" href="#1150">1150: </a>                    <span class="php-comment">/** @var InputfieldImage $inputfield */</span>
</span><span id="1151" class="l"><a class="l" href="#1151">1151: </a>                    <span class="php-var">$inputfield</span> = <span class="php-var">$this</span>-&gt;field-&gt;getInputfield(<span class="php-var">$this</span>-&gt;page);
</span><span id="1152" class="l"><a class="l" href="#1152">1152: </a>                    <span class="php-keyword1">if</span>(<span class="php-var">$inputfield</span>) {
</span><span id="1153" class="l"><a class="l" href="#1153">1153: </a>                        <span class="php-var">$thumb</span> = <span class="php-var">$inputfield</span>-&gt;getAdminThumb(<span class="php-var">$original</span>);
</span><span id="1154" class="l"><a class="l" href="#1154">1154: </a>                        <span class="php-var">$thumb</span> = <span class="php-var">$thumb</span>[<span class="php-quote">'thumb'</span>];
</span><span id="1155" class="l"><a class="l" href="#1155">1155: </a>                        <span class="php-keyword1">if</span>(<span class="php-var">$thumb</span>-&gt;url != <span class="php-var">$original</span>-&gt;url) {
</span><span id="1156" class="l"><a class="l" href="#1156">1156: </a>                            <span class="php-comment">// there is a thumbnail, distinct from the original image</span>
</span><span id="1157" class="l"><a class="l" href="#1157">1157: </a>                            <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'files'</span>)-&gt;<span class="php-keyword2">unlink</span>(<span class="php-var">$thumb</span>-&gt;filename);
</span><span id="1158" class="l"><a class="l" href="#1158">1158: </a>                        }
</span><span id="1159" class="l"><a class="l" href="#1159">1159: </a>                    }
</span><span id="1160" class="l"><a class="l" href="#1160">1160: </a>                }
</span><span id="1161" class="l"><a class="l" href="#1161">1161: </a>                
</span><span id="1162" class="l"><a class="l" href="#1162">1162: </a>                <span class="php-comment">// replace original image</span>
</span><span id="1163" class="l"><a class="l" href="#1163">1163: </a>                <span class="php-var">$target</span> = <span class="php-var">$path</span> . <span class="php-var">$this</span>-&gt;original;
</span><span id="1164" class="l"><a class="l" href="#1164">1164: </a>                <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'files'</span>)-&gt;<span class="php-keyword2">unlink</span>(<span class="php-var">$target</span>); 
</span><span id="1165" class="l"><a class="l" href="#1165">1165: </a>                <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'files'</span>)-&gt;<span class="php-keyword2">rename</span>(<span class="php-var">$image2</span>-&gt;filename(), <span class="php-var">$target</span>);
</span><span id="1166" class="l"><a class="l" href="#1166">1166: </a>                
</span><span id="1167" class="l"><a class="l" href="#1167">1167: </a>                <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'pages'</span>)-&gt;uncacheAll(); 
</span><span id="1168" class="l"><a class="l" href="#1168">1168: </a>                <span class="php-var">$page</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'pages'</span>)-&gt;get(<span class="php-var">$this</span>-&gt;page-&gt;id); 
</span><span id="1169" class="l"><a class="l" href="#1169">1169: </a>                <span class="php-comment">/** @var Pageimages $value */</span>
</span><span id="1170" class="l"><a class="l" href="#1170">1170: </a>                <span class="php-var">$value</span> = <span class="php-var">$page</span>-&gt;getUnformatted(<span class="php-var">$this</span>-&gt;field-&gt;name); 
</span><span id="1171" class="l"><a class="l" href="#1171">1171: </a>                
</span><span id="1172" class="l"><a class="l" href="#1172">1172: </a>                <span class="php-keyword1">if</span>(<span class="php-var">$rebuildVariations</span>) {
</span><span id="1173" class="l"><a class="l" href="#1173">1173: </a>                    <span class="php-var">$finalImage</span> = <span class="php-var">$value</span>-&gt;get(<span class="php-var">$this</span>-&gt;original);
</span><span id="1174" class="l"><a class="l" href="#1174">1174: </a>                    <span class="php-var">$variationInfo</span> = <span class="php-var">$finalImage</span>-&gt;rebuildVariations(<span class="php-num">0</span>, <span class="php-keyword1">array</span>(<span class="php-quote">'is'</span>, <span class="php-quote">'hidpi'</span>));
</span><span id="1175" class="l"><a class="l" href="#1175">1175: </a>                    <span class="php-keyword1">foreach</span>(<span class="php-var">$variationInfo</span> <span class="php-keyword1">as</span> <span class="php-var">$type</span> =&gt; <span class="php-var">$files</span>) {
</span><span id="1176" class="l"><a class="l" href="#1176">1176: </a>                        <span class="php-keyword1">if</span>(!<span class="php-keyword2">count</span>(<span class="php-var">$files</span>)) <span class="php-keyword1">continue</span>;
</span><span id="1177" class="l"><a class="l" href="#1177">1177: </a>                        <span class="php-var">$body</span> .= <span class="php-quote">&quot;&lt;h3&gt;&quot;</span> . <span class="php-keyword2">ucfirst</span>(<span class="php-var">$type</span>) . <span class="php-quote">&quot;&lt;/h3&gt;&quot;</span>;
</span><span id="1178" class="l"><a class="l" href="#1178">1178: </a>                        <span class="php-var">$body</span> .= <span class="php-quote">&quot;&lt;p&gt;&quot;</span> . <span class="php-keyword2">implode</span>(<span class="php-quote">'&lt;br /&gt;'</span>, <span class="php-var">$files</span>) . <span class="php-quote">&quot;&lt;/p&gt;&quot;</span>;
</span><span id="1179" class="l"><a class="l" href="#1179">1179: </a>                        <span class="php-comment">// $this-&gt;wire('log')-&gt;save('images', &quot;$type: [ &quot; . implode(' ], [ ', $files) . ' ]');</span>
</span><span id="1180" class="l"><a class="l" href="#1180">1180: </a>                    }
</span><span id="1181" class="l"><a class="l" href="#1181">1181: </a>                } <span class="php-keyword1">else</span> {
</span><span id="1182" class="l"><a class="l" href="#1182">1182: </a>                    <span class="php-var">$body</span> .= <span class="php-quote">&quot;&lt;p&gt;&quot;</span> . <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'No changes necessary to image variations.'</span>) . <span class="php-quote">&quot;&lt;/p&gt;&quot;</span>;
</span><span id="1183" class="l"><a class="l" href="#1183">1183: </a>                }
</span><span id="1184" class="l"><a class="l" href="#1184">1184: </a>                
</span><span id="1185" class="l"><a class="l" href="#1185">1185: </a>                <span class="php-var">$headline</span> = <span class="php-var">$this</span>-&gt;labels[<span class="php-quote">'updating'</span>];
</span><span id="1186" class="l"><a class="l" href="#1186">1186: </a>                
</span><span id="1187" class="l"><a class="l" href="#1187">1187: </a>            } <span class="php-keyword1">else</span> {
</span><span id="1188" class="l"><a class="l" href="#1188">1188: </a>                <span class="php-var">$headline</span> = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'No changes made'</span>); 
</span><span id="1189" class="l"><a class="l" href="#1189">1189: </a>            }
</span><span id="1190" class="l"><a class="l" href="#1190">1190: </a>
</span><span id="1191" class="l"><a class="l" href="#1191">1191: </a>        } <span class="php-keyword1">else</span> {
</span><span id="1192" class="l"><a class="l" href="#1192">1192: </a>            <span class="php-comment">// save a new copy</span>
</span><span id="1193" class="l"><a class="l" href="#1193">1193: </a>            
</span><span id="1194" class="l"><a class="l" href="#1194">1194: </a>            <span class="php-var">$n</span> = <span class="php-num">0</span>;
</span><span id="1195" class="l"><a class="l" href="#1195">1195: </a>            <span class="php-keyword1">do</span> {
</span><span id="1196" class="l"><a class="l" href="#1196">1196: </a>                <span class="php-var">$n</span>++;
</span><span id="1197" class="l"><a class="l" href="#1197">1197: </a>                <span class="php-var">$basename</span> = <span class="php-keyword2">basename</span>(<span class="php-var">$this</span>-&gt;original); 
</span><span id="1198" class="l"><a class="l" href="#1198">1198: </a>                <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/^([^.]+)(\..+)$/'</span>, <span class="php-var">$basename</span>, <span class="php-var">$matches</span>);
</span><span id="1199" class="l"><a class="l" href="#1199">1199: </a>                <span class="php-var">$basename</span> = <span class="php-var">$matches</span>[<span class="php-num">1</span>];
</span><span id="1200" class="l"><a class="l" href="#1200">1200: </a>                <span class="php-var">$aftername</span> = <span class="php-var">$matches</span>[<span class="php-num">2</span>];
</span><span id="1201" class="l"><a class="l" href="#1201">1201: </a>                <span class="php-keyword1">if</span>(<span class="php-keyword2">strpos</span>(<span class="php-var">$basename</span>, <span class="php-quote">'-v'</span>)) <span class="php-var">$basename</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/-v[0-9]+$/'</span>, <span class="php-quote">''</span>, <span class="php-var">$basename</span>);
</span><span id="1202" class="l"><a class="l" href="#1202">1202: </a>                <span class="php-var">$basename</span> .= <span class="php-quote">&quot;-v</span><span class="php-var">$n</span><span class="php-quote">&quot;</span>;
</span><span id="1203" class="l"><a class="l" href="#1203">1203: </a>                <span class="php-var">$basename</span> .= <span class="php-var">$aftername</span>;
</span><span id="1204" class="l"><a class="l" href="#1204">1204: </a>                <span class="php-var">$pathname</span> = <span class="php-var">$path</span> . <span class="php-var">$basename</span>;
</span><span id="1205" class="l"><a class="l" href="#1205">1205: </a>            } <span class="php-keyword1">while</span>(<span class="php-keyword2">is_file</span>(<span class="php-var">$pathname</span>));
</span><span id="1206" class="l"><a class="l" href="#1206">1206: </a>            
</span><span id="1207" class="l"><a class="l" href="#1207">1207: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$useResize</span> &amp;&amp; !<span class="php-var">$rebuildVariations</span>) {
</span><span id="1208" class="l"><a class="l" href="#1208">1208: </a>                <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'files'</span>)-&gt;<span class="php-keyword2">copy</span>(<span class="php-var">$image2</span>-&gt;filename(), <span class="php-var">$pathname</span>);
</span><span id="1209" class="l"><a class="l" href="#1209">1209: </a>            } <span class="php-keyword1">else</span> {
</span><span id="1210" class="l"><a class="l" href="#1210">1210: </a>                <span class="php-keyword2">rename</span>(<span class="php-var">$image2</span>-&gt;filename(), <span class="php-var">$pathname</span>);
</span><span id="1211" class="l"><a class="l" href="#1211">1211: </a>            }
</span><span id="1212" class="l"><a class="l" href="#1212">1212: </a>            <span class="php-var">$pageimages</span>-&gt;add(<span class="php-var">$pathname</span>);
</span><span id="1213" class="l"><a class="l" href="#1213">1213: </a>            <span class="php-var">$pageimage</span> = <span class="php-var">$pageimages</span>-&gt;last();
</span><span id="1214" class="l"><a class="l" href="#1214">1214: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;field-&gt;get(<span class="php-quote">'overwrite'</span>)) <span class="php-var">$pageimage</span>-&gt;isTemp(<span class="php-keyword1">true</span>);
</span><span id="1215" class="l"><a class="l" href="#1215">1215: </a>            <span class="php-var">$this</span>-&gt;page-&gt;save(<span class="php-var">$this</span>-&gt;field-&gt;name);
</span><span id="1216" class="l"><a class="l" href="#1216">1216: </a>            <span class="php-var">$fileID</span> = <span class="php-quote">&quot;file_</span><span class="php-var">$pageimage</span><span class="php-quote">-&gt;hash&quot;</span>;
</span><span id="1217" class="l"><a class="l" href="#1217">1217: </a>            <span class="php-var">$isNew</span> = <span class="php-num">1</span>; 
</span><span id="1218" class="l"><a class="l" href="#1218">1218: </a>            <span class="php-var">$headline</span> = <span class="php-var">$this</span>-&gt;labels[<span class="php-quote">'updating'</span>];
</span><span id="1219" class="l"><a class="l" href="#1219">1219: </a>        }
</span><span id="1220" class="l"><a class="l" href="#1220">1220: </a>    
</span><span id="1221" class="l"><a class="l" href="#1221">1221: </a>        <span class="php-var">$out</span> = <span class="php-quote">&quot;
</span></span><span id="1222" class="l"><a class="l" href="#1222">1222: </a><span class="php-quote">            &lt;h2&gt;&lt;i class='fa fa-spin fa-spinner fa-2x fa-fw ui-priority-secondary'&gt;&lt;/i&gt; </span><span class="php-var">$headline</span><span class="php-quote">&lt;/h2&gt;
</span></span><span id="1223" class="l"><a class="l" href="#1223">1223: </a><span class="php-quote">            </span><span class="php-var">$body</span><span class="php-quote">
</span></span><span id="1224" class="l"><a class="l" href="#1224">1224: </a><span class="php-quote">            &lt;script&gt;
</span></span><span id="1225" class="l"><a class="l" href="#1225">1225: </a><span class="php-quote">            </span><span class="php-var">$</span><span class="php-quote">(document).ready(function() { setupProcessSave('</span><span class="php-var">$this</span><span class="php-quote">-&gt;fieldName', '</span><span class="php-var">$fileID</span><span class="php-quote">', </span><span class="php-var">$isNew</span><span class="php-quote">); }); 
</span></span><span id="1226" class="l"><a class="l" href="#1226">1226: </a><span class="php-quote">            &lt;/script&gt;
</span></span><span id="1227" class="l"><a class="l" href="#1227">1227: </a><span class="php-quote">            &quot;</span>;
</span><span id="1228" class="l"><a class="l" href="#1228">1228: </a>        
</span><span id="1229" class="l"><a class="l" href="#1229">1229: </a>        <span class="php-keyword1">return</span> <span class="php-var">$out</span>; 
</span><span id="1230" class="l"><a class="l" href="#1230">1230: </a>    }
</span><span id="1231" class="l"><a class="l" href="#1231">1231: </a>
</span><span id="1232" class="l"><a class="l" href="#1232">1232: </a>    <span class="php-comment">/**
</span></span><span id="1233" class="l"><a class="l" href="#1233">1233: </a><span class="php-comment">     * Resize image and output basic markup with information about the resize
</span></span><span id="1234" class="l"><a class="l" href="#1234">1234: </a><span class="php-comment">     * 
</span></span><span id="1235" class="l"><a class="l" href="#1235">1235: </a><span class="php-comment">     * The output is intended to be read by the rich text editor for insertion into the text. 
</span></span><span id="1236" class="l"><a class="l" href="#1236">1236: </a><span class="php-comment">     * 
</span></span><span id="1237" class="l"><a class="l" href="#1237">1237: </a><span class="php-comment">     * Required GET variables: 
</span></span><span id="1238" class="l"><a class="l" href="#1238">1238: </a><span class="php-comment">     *  - file (string): URL of image
</span></span><span id="1239" class="l"><a class="l" href="#1239">1239: </a><span class="php-comment">     *  - width (int): Target resize width
</span></span><span id="1240" class="l"><a class="l" href="#1240">1240: </a><span class="php-comment">     *  - edit_page_id (int): ID of the page being edited, where image will be placed. 
</span></span><span id="1241" class="l"><a class="l" href="#1241">1241: </a><span class="php-comment">     * 
</span></span><span id="1242" class="l"><a class="l" href="#1242">1242: </a><span class="php-comment">     * Optional GET variables:
</span></span><span id="1243" class="l"><a class="l" href="#1243">1243: </a><span class="php-comment">     *  - id (int): ID of the page the image lives on (if omitted, we attempt to determine from 'file' path). 
</span></span><span id="1244" class="l"><a class="l" href="#1244">1244: </a><span class="php-comment">     *  - class (string): Class name to pass along to the editor (i.e. align_left, align_right, etc.) 
</span></span><span id="1245" class="l"><a class="l" href="#1245">1245: </a><span class="php-comment">     *  - hidpi (int): Whether hidpi mode is used or not (0=no, 1=yes)
</span></span><span id="1246" class="l"><a class="l" href="#1246">1246: </a><span class="php-comment">     *  - json (int): Specify 1 to provide output in JSON (if not specified, output is a paragraph of markup)
</span></span><span id="1247" class="l"><a class="l" href="#1247">1247: </a><span class="php-comment">     * 
</span></span><span id="1248" class="l"><a class="l" href="#1248">1248: </a><span class="php-comment">     * @return string
</span></span><span id="1249" class="l"><a class="l" href="#1249">1249: </a><span class="php-comment">     * @throws WireException
</span></span><span id="1250" class="l"><a class="l" href="#1250">1250: </a><span class="php-comment">     * 
</span></span><span id="1251" class="l"><a class="l" href="#1251">1251: </a><span class="php-comment">     */</span>
</span><span id="1252" class="l"><a class="l" href="#1252">1252: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="____executeResize" href="#____executeResize">___executeResize</a>() {
</span><span id="1253" class="l"><a class="l" href="#1253">1253: </a>
</span><span id="1254" class="l"><a class="l" href="#1254">1254: </a>        <span class="php-var">$this</span>-&gt;checkImageEditPermission();
</span><span id="1255" class="l"><a class="l" href="#1255">1255: </a>
</span><span id="1256" class="l"><a class="l" href="#1256">1256: </a>        <span class="php-var">$width</span> = (int) <span class="php-var">$this</span>-&gt;input-&gt;get(<span class="php-quote">'width'</span>); 
</span><span id="1257" class="l"><a class="l" href="#1257">1257: </a>        <span class="php-var">$class</span> = <span class="php-var">$this</span>-&gt;sanitizer-&gt;name(<span class="php-var">$this</span>-&gt;input-&gt;get-&gt;<span class="php-keyword1">class</span>);
</span><span id="1258" class="l"><a class="l" href="#1258">1258: </a>        <span class="php-var">$hidpi</span> = <span class="php-var">$this</span>-&gt;hidpi;
</span><span id="1259" class="l"><a class="l" href="#1259">1259: </a>        <span class="php-var">$json</span> = (int) <span class="php-var">$this</span>-&gt;input-&gt;get(<span class="php-quote">'json'</span>); <span class="php-comment">// 1 or 0 (for json output mode on or off)</span>
</span><span id="1260" class="l"><a class="l" href="#1260">1260: </a>        <span class="php-var">$rotate</span> = (int) <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'rotate'</span>);
</span><span id="1261" class="l"><a class="l" href="#1261">1261: </a>        <span class="php-var">$flip</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'flip'</span>); 
</span><span id="1262" class="l"><a class="l" href="#1262">1262: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$flip</span> != <span class="php-quote">'v'</span> &amp;&amp; <span class="php-var">$flip</span> != <span class="php-quote">'h'</span>) <span class="php-var">$flip</span> = <span class="php-quote">''</span>;
</span><span id="1263" class="l"><a class="l" href="#1263">1263: </a>        
</span><span id="1264" class="l"><a class="l" href="#1264">1264: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword2">strpos</span>(<span class="php-var">$class</span>, <span class="php-quote">'hidpi'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="1265" class="l"><a class="l" href="#1265">1265: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$hidpi</span>) <span class="php-var">$hidpi</span> = <span class="php-keyword1">true</span>; 
</span><span id="1266" class="l"><a class="l" href="#1266">1266: </a>        } <span class="php-keyword1">else</span> {
</span><span id="1267" class="l"><a class="l" href="#1267">1267: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$hidpi</span>) <span class="php-var">$class</span> = <span class="php-keyword2">trim</span>(<span class="php-quote">&quot;</span><span class="php-var">$class</span><span class="php-quote"> hidpi&quot;</span>);
</span><span id="1268" class="l"><a class="l" href="#1268">1268: </a>        }
</span><span id="1269" class="l"><a class="l" href="#1269">1269: </a>        
</span><span id="1270" class="l"><a class="l" href="#1270">1270: </a>        <span class="php-var">$image</span> = <span class="php-var">$this</span>-&gt;getPageimage(<span class="php-keyword1">true</span>);
</span><span id="1271" class="l"><a class="l" href="#1271">1271: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword2">strpos</span>(<span class="php-var">$image</span>-&gt;<span class="php-keyword2">basename</span>, <span class="php-quote">'-cropx'</span>) !== <span class="php-keyword1">false</span>) <span class="php-var">$image</span> = <span class="php-var">$this</span>-&gt;getLastCrop(<span class="php-var">$image</span>); 
</span><span id="1272" class="l"><a class="l" href="#1272">1272: </a>        
</span><span id="1273" class="l"><a class="l" href="#1273">1273: </a>        <span class="php-keyword1">if</span>( (!<span class="php-var">$hidpi</span> &amp;&amp; <span class="php-var">$width</span> &lt; <span class="php-var">$image</span>-&gt;width) || 
</span><span id="1274" class="l"><a class="l" href="#1274">1274: </a>            (<span class="php-var">$hidpi</span> &amp;&amp; <span class="php-var">$width</span> &lt; <span class="php-var">$image</span>-&gt;hidpiWidth()) ||
</span><span id="1275" class="l"><a class="l" href="#1275">1275: </a>            <span class="php-var">$flip</span> || <span class="php-var">$rotate</span>) {
</span><span id="1276" class="l"><a class="l" href="#1276">1276: </a>            
</span><span id="1277" class="l"><a class="l" href="#1277">1277: </a>            <span class="php-var">$suffix</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'is'</span>);  <span class="php-comment">// is=image select</span>
</span><span id="1278" class="l"><a class="l" href="#1278">1278: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;editorPage &amp;&amp; <span class="php-var">$this</span>-&gt;editorPage-&gt;id != <span class="php-var">$this</span>-&gt;page-&gt;id) <span class="php-var">$suffix</span>[] = <span class="php-quote">&quot;pid</span><span class="php-var">$this</span><span class="php-quote">-&gt;editorPage&quot;</span>; <span class="php-comment">// identify page that is using the variation</span>
</span><span id="1279" class="l"><a class="l" href="#1279">1279: </a>            <span class="php-var">$options</span> = <span class="php-keyword1">array</span>(
</span><span id="1280" class="l"><a class="l" href="#1280">1280: </a>                <span class="php-quote">'suffix'</span> =&gt; <span class="php-var">$suffix</span>,
</span><span id="1281" class="l"><a class="l" href="#1281">1281: </a>                <span class="php-quote">'hidpi'</span> =&gt; <span class="php-var">$hidpi</span>,
</span><span id="1282" class="l"><a class="l" href="#1282">1282: </a>            );
</span><span id="1283" class="l"><a class="l" href="#1283">1283: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$rotate</span>) <span class="php-var">$options</span>[<span class="php-quote">'rotate'</span>] = <span class="php-var">$rotate</span>; 
</span><span id="1284" class="l"><a class="l" href="#1284">1284: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$flip</span>) <span class="php-var">$options</span>[<span class="php-quote">'flip'</span>] = <span class="php-var">$flip</span>;
</span><span id="1285" class="l"><a class="l" href="#1285">1285: </a>            <span class="php-comment">//$this-&gt;log(print_r($options, true)); </span>
</span><span id="1286" class="l"><a class="l" href="#1286">1286: </a>            <span class="php-var">$resized</span> = <span class="php-var">$image</span>-&gt;width(<span class="php-var">$width</span>, <span class="php-var">$options</span>); 
</span><span id="1287" class="l"><a class="l" href="#1287">1287: </a>            <span class="php-var">$height</span> = <span class="php-var">$resized</span>-&gt;height();
</span><span id="1288" class="l"><a class="l" href="#1288">1288: </a>        } <span class="php-keyword1">else</span> {
</span><span id="1289" class="l"><a class="l" href="#1289">1289: </a>            <span class="php-var">$width</span> = <span class="php-var">$image</span>-&gt;width; 
</span><span id="1290" class="l"><a class="l" href="#1290">1290: </a>            <span class="php-var">$height</span> = <span class="php-var">$image</span>-&gt;height; 
</span><span id="1291" class="l"><a class="l" href="#1291">1291: </a>            <span class="php-var">$resized</span> = <span class="php-var">$image</span>; 
</span><span id="1292" class="l"><a class="l" href="#1292">1292: </a>        }
</span><span id="1293" class="l"><a class="l" href="#1293">1293: </a>    
</span><span id="1294" class="l"><a class="l" href="#1294">1294: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$hidpi</span>) {
</span><span id="1295" class="l"><a class="l" href="#1295">1295: </a>            <span class="php-var">$width</span> = <span class="php-var">$resized</span>-&gt;hidpiWidth();
</span><span id="1296" class="l"><a class="l" href="#1296">1296: </a>            <span class="php-var">$height</span> = <span class="php-var">$resized</span>-&gt;hidpiHeight();
</span><span id="1297" class="l"><a class="l" href="#1297">1297: </a>            <span class="php-var">$hidpiChecked</span> = <span class="php-quote">&quot; checked='checked'&quot;</span>;
</span><span id="1298" class="l"><a class="l" href="#1298">1298: </a>        } <span class="php-keyword1">else</span> {
</span><span id="1299" class="l"><a class="l" href="#1299">1299: </a>            <span class="php-var">$hidpiChecked</span> = <span class="php-quote">''</span>;
</span><span id="1300" class="l"><a class="l" href="#1300">1300: </a>        }
</span><span id="1301" class="l"><a class="l" href="#1301">1301: </a>        
</span><span id="1302" class="l"><a class="l" href="#1302">1302: </a>        <span class="php-var">$nosize</span> = <span class="php-var">$this</span>-&gt;noSizeAttrs ? <span class="php-num">1</span> : <span class="php-quote">''</span>;
</span><span id="1303" class="l"><a class="l" href="#1303">1303: </a>        
</span><span id="1304" class="l"><a class="l" href="#1304">1304: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$json</span>) {
</span><span id="1305" class="l"><a class="l" href="#1305">1305: </a>            
</span><span id="1306" class="l"><a class="l" href="#1306">1306: </a>            <span class="php-var">$data</span> = <span class="php-keyword1">array</span>(
</span><span id="1307" class="l"><a class="l" href="#1307">1307: </a>                <span class="php-quote">'src'</span> =&gt; <span class="php-var">$resized</span>-&gt;url,
</span><span id="1308" class="l"><a class="l" href="#1308">1308: </a>                <span class="php-quote">'name'</span> =&gt; <span class="php-var">$image</span>-&gt;<span class="php-keyword2">basename</span>, 
</span><span id="1309" class="l"><a class="l" href="#1309">1309: </a>                <span class="php-quote">'width'</span> =&gt; <span class="php-var">$width</span>,
</span><span id="1310" class="l"><a class="l" href="#1310">1310: </a>                <span class="php-quote">'height'</span> =&gt; <span class="php-var">$height</span>, 
</span><span id="1311" class="l"><a class="l" href="#1311">1311: </a>                <span class="php-quote">'class'</span> =&gt; <span class="php-var">$class</span>, 
</span><span id="1312" class="l"><a class="l" href="#1312">1312: </a>                <span class="php-quote">'page'</span> =&gt; <span class="php-var">$image</span>-&gt;page-&gt;id,
</span><span id="1313" class="l"><a class="l" href="#1313">1313: </a>                <span class="php-quote">'hidpi'</span> =&gt; (bool) <span class="php-var">$hidpi</span>,
</span><span id="1314" class="l"><a class="l" href="#1314">1314: </a>                <span class="php-quote">'nosize'</span> =&gt; (bool) <span class="php-var">$nosize</span>, 
</span><span id="1315" class="l"><a class="l" href="#1315">1315: </a>            );
</span><span id="1316" class="l"><a class="l" href="#1316">1316: </a>            
</span><span id="1317" class="l"><a class="l" href="#1317">1317: </a>            <span class="php-keyword2">header</span>(<span class="php-quote">&quot;Content-Type: application/json&quot;</span>); 
</span><span id="1318" class="l"><a class="l" href="#1318">1318: </a>            <span class="php-var">$out</span> = <span class="php-keyword2">json_encode</span>(<span class="php-var">$data</span>); 
</span><span id="1319" class="l"><a class="l" href="#1319">1319: </a>            
</span><span id="1320" class="l"><a class="l" href="#1320">1320: </a>        } <span class="php-keyword1">else</span> {
</span><span id="1321" class="l"><a class="l" href="#1321">1321: </a>            <span class="php-comment">// note IE8 won't properly read the width/height attrs via ajax</span>
</span><span id="1322" class="l"><a class="l" href="#1322">1322: </a>            <span class="php-comment">// so we provide the width/height in separate fields</span>
</span><span id="1323" class="l"><a class="l" href="#1323">1323: </a>
</span><span id="1324" class="l"><a class="l" href="#1324">1324: </a>            <span class="php-var">$out</span> =
</span><span id="1325" class="l"><a class="l" href="#1325">1325: </a>                <span class="php-quote">&quot;&lt;p&gt;&quot;</span> .
</span><span id="1326" class="l"><a class="l" href="#1326">1326: </a>                <span class="php-quote">&quot;&lt;span id='selected_image_width'&gt;</span><span class="php-var">$width</span><span class="php-quote">&lt;/span&gt;x&quot;</span> .
</span><span id="1327" class="l"><a class="l" href="#1327">1327: </a>                <span class="php-quote">&quot;&lt;span id='selected_image_height'&gt;</span><span class="php-var">$height</span><span class="php-quote">&lt;/span&gt; &quot;</span> .
</span><span id="1328" class="l"><a class="l" href="#1328">1328: </a>                <span class="php-quote">&quot;&lt;label&gt;&lt;input type='checkbox' id='selected_image_hidpi' </span><span class="php-var">$hidpiChecked</span><span class="php-quote"> /&gt;hidpi&lt;/label&gt;&lt;br /&gt;&quot;</span> .
</span><span id="1329" class="l"><a class="l" href="#1329">1329: </a>                <span class="php-quote">&quot;&lt;img &quot;</span> . 
</span><span id="1330" class="l"><a class="l" href="#1330">1330: </a>                    <span class="php-quote">&quot;id='selected_image' &quot;</span> . 
</span><span id="1331" class="l"><a class="l" href="#1331">1331: </a>                    <span class="php-quote">&quot;class='</span><span class="php-var">$class</span><span class="php-quote">' &quot;</span> . 
</span><span id="1332" class="l"><a class="l" href="#1332">1332: </a>                    <span class="php-quote">&quot;data-idname='</span><span class="php-var">{$image-&gt;page-&gt;id}</span><span class="php-quote">,</span><span class="php-var">{$image-&gt;basename}</span><span class="php-quote">' &quot;</span> . 
</span><span id="1333" class="l"><a class="l" href="#1333">1333: </a>                    <span class="php-quote">&quot;data-nosize='</span><span class="php-var">$nosize</span><span class="php-quote">' &quot;</span> . 
</span><span id="1334" class="l"><a class="l" href="#1334">1334: </a>                    <span class="php-quote">&quot;src='</span><span class="php-var">{$resized-&gt;url}</span><span class="php-quote">' &quot;</span> . 
</span><span id="1335" class="l"><a class="l" href="#1335">1335: </a>                    <span class="php-quote">&quot;width='</span><span class="php-var">$width</span><span class="php-quote">' &quot;</span> . 
</span><span id="1336" class="l"><a class="l" href="#1336">1336: </a>                    <span class="php-quote">&quot;height='</span><span class="php-var">$height</span><span class="php-quote">' &quot;</span> .
</span><span id="1337" class="l"><a class="l" href="#1337">1337: </a>                <span class="php-quote">&quot;/&gt;&quot;</span> . 
</span><span id="1338" class="l"><a class="l" href="#1338">1338: </a>                <span class="php-quote">&quot;&lt;/p&gt;&quot;</span>;
</span><span id="1339" class="l"><a class="l" href="#1339">1339: </a>        }
</span><span id="1340" class="l"><a class="l" href="#1340">1340: </a>        <span class="php-comment">//$this-&gt;log($out); </span>
</span><span id="1341" class="l"><a class="l" href="#1341">1341: </a>
</span><span id="1342" class="l"><a class="l" href="#1342">1342: </a>        <span class="php-keyword1">return</span> <span class="php-var">$out</span>; 
</span><span id="1343" class="l"><a class="l" href="#1343">1343: </a>    }
</span><span id="1344" class="l"><a class="l" href="#1344">1344: </a>
</span><span id="1345" class="l"><a class="l" href="#1345">1345: </a>    <span class="php-comment">/**
</span></span><span id="1346" class="l"><a class="l" href="#1346">1346: </a><span class="php-comment">     * Show all variations for the image provided in GET var 'file'
</span></span><span id="1347" class="l"><a class="l" href="#1347">1347: </a><span class="php-comment">     * 
</span></span><span id="1348" class="l"><a class="l" href="#1348">1348: </a><span class="php-comment">     * @return string
</span></span><span id="1349" class="l"><a class="l" href="#1349">1349: </a><span class="php-comment">     * @throws WireException
</span></span><span id="1350" class="l"><a class="l" href="#1350">1350: </a><span class="php-comment">     * 
</span></span><span id="1351" class="l"><a class="l" href="#1351">1351: </a><span class="php-comment">     */</span>
</span><span id="1352" class="l"><a class="l" href="#1352">1352: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="____executeVariations" href="#____executeVariations">___executeVariations</a>() {
</span><span id="1353" class="l"><a class="l" href="#1353">1353: </a>        
</span><span id="1354" class="l"><a class="l" href="#1354">1354: </a>        <span class="php-var">$pageimage</span> = <span class="php-var">$this</span>-&gt;getPageimage();
</span><span id="1355" class="l"><a class="l" href="#1355">1355: </a>        
</span><span id="1356" class="l"><a class="l" href="#1356">1356: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;page || !<span class="php-var">$pageimage</span>) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-quote">&quot;No file provided&quot;</span>); 
</span><span id="1357" class="l"><a class="l" href="#1357">1357: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$this</span>-&gt;masterPage-&gt;editable()) <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> WireException(<span class="php-var">$this</span>-&gt;labels[<span class="php-quote">'noAccess'</span>]);
</span><span id="1358" class="l"><a class="l" href="#1358">1358: </a>        <span class="php-var">$hasEditPermission</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'user'</span>)-&gt;hasPermission(<span class="php-quote">'page-edit-images'</span>, <span class="php-var">$this</span>-&gt;masterPage);
</span><span id="1359" class="l"><a class="l" href="#1359">1359: </a>        
</span><span id="1360" class="l"><a class="l" href="#1360">1360: </a>        <span class="php-var">$variations</span> = <span class="php-var">$pageimage</span>-&gt;getVariations(<span class="php-keyword1">array</span>(<span class="php-quote">'info'</span> =&gt; <span class="php-keyword1">true</span>));
</span><span id="1361" class="l"><a class="l" href="#1361">1361: </a>        <span class="php-var">$cnt</span> = <span class="php-keyword2">count</span>(<span class="php-var">$variations</span>);
</span><span id="1362" class="l"><a class="l" href="#1362">1362: </a>        
</span><span id="1363" class="l"><a class="l" href="#1363">1363: </a>        <span class="php-var">$delete</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;post(<span class="php-quote">'delete'</span>);
</span><span id="1364" class="l"><a class="l" href="#1364">1364: </a>        <span class="php-keyword1">if</span>(<span class="php-keyword2">is_array</span>(<span class="php-var">$delete</span>) &amp;&amp; <span class="php-keyword2">count</span>(<span class="php-var">$delete</span>) &amp;&amp; <span class="php-var">$hasEditPermission</span>) {
</span><span id="1365" class="l"><a class="l" href="#1365">1365: </a>            <span class="php-keyword1">foreach</span>(<span class="php-var">$delete</span> <span class="php-keyword1">as</span> <span class="php-var">$name</span>) {
</span><span id="1366" class="l"><a class="l" href="#1366">1366: </a>                <span class="php-keyword1">if</span>(!<span class="php-keyword1">isset</span>(<span class="php-var">$variations</span>[<span class="php-var">$name</span>])) <span class="php-keyword1">continue</span>; 
</span><span id="1367" class="l"><a class="l" href="#1367">1367: </a>                <span class="php-var">$info</span> = <span class="php-var">$variations</span>[<span class="php-var">$name</span>]; 
</span><span id="1368" class="l"><a class="l" href="#1368">1368: </a>                <span class="php-keyword1">if</span>(<span class="php-keyword2">is_file</span>(<span class="php-var">$info</span>[<span class="php-quote">'path'</span>]) &amp;&amp; <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'files'</span>)-&gt;<span class="php-keyword2">unlink</span>(<span class="php-var">$info</span>[<span class="php-quote">'path'</span>])) {
</span><span id="1369" class="l"><a class="l" href="#1369">1369: </a>                    <span class="php-var">$this</span>-&gt;message(<span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Deleted image variation'</span>) . <span class="php-quote">&quot; - </span><span class="php-var">$info</span><span class="php-quote">[url]&quot;</span>); 
</span><span id="1370" class="l"><a class="l" href="#1370">1370: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$variations</span>[<span class="php-var">$name</span>]); 
</span><span id="1371" class="l"><a class="l" href="#1371">1371: </a>                } <span class="php-keyword1">else</span> {
</span><span id="1372" class="l"><a class="l" href="#1372">1372: </a>                    <span class="php-var">$this</span>-&gt;error(<span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Error deleting image variation'</span>) . <span class="php-quote">&quot; - </span><span class="php-var">$info</span><span class="php-quote">[url]&quot;</span>); 
</span><span id="1373" class="l"><a class="l" href="#1373">1373: </a>                }
</span><span id="1374" class="l"><a class="l" href="#1374">1374: </a>            }
</span><span id="1375" class="l"><a class="l" href="#1375">1375: </a>        }
</span><span id="1376" class="l"><a class="l" href="#1376">1376: </a>        
</span><span id="1377" class="l"><a class="l" href="#1377">1377: </a>        <span class="php-var">$headline</span> = <span class="php-keyword2">sprintf</span>(
</span><span id="1378" class="l"><a class="l" href="#1378">1378: </a>                <span class="php-var">$this</span>-&gt;_n(<span class="php-quote">'%1$d variation for image %2$s'</span>, <span class="php-quote">'%1$d variations for image %2$s'</span>, <span class="php-var">$cnt</span>), 
</span><span id="1379" class="l"><a class="l" href="#1379">1379: </a>                <span class="php-comment">//$cnt, &quot;&lt;a class='preview' href='$pageimage-&gt;URL'&gt;$pageimage-&gt;basename&lt;/a&gt;&quot;</span>
</span><span id="1380" class="l"><a class="l" href="#1380">1380: </a>                <span class="php-var">$cnt</span>, <span class="php-var">$pageimage</span>-&gt;<span class="php-keyword2">basename</span>
</span><span id="1381" class="l"><a class="l" href="#1381">1381: </a>            );
</span><span id="1382" class="l"><a class="l" href="#1382">1382: </a>        <span class="php-var">$this</span>-&gt;headline(<span class="php-var">$headline</span>); 
</span><span id="1383" class="l"><a class="l" href="#1383">1383: </a>        
</span><span id="1384" class="l"><a class="l" href="#1384">1384: </a>        <span class="php-keyword1">if</span>(!<span class="php-var">$cnt</span>) <span class="php-keyword1">return</span> <span class="php-quote">&quot;&lt;h2&gt;</span><span class="php-var">$headline</span><span class="php-quote">&lt;/h2&gt;&quot;</span>;
</span><span id="1385" class="l"><a class="l" href="#1385">1385: </a>        
</span><span id="1386" class="l"><a class="l" href="#1386">1386: </a>        <span class="php-var">$adminThumbOptions</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'config'</span>)-&gt;adminThumbOptions;
</span><span id="1387" class="l"><a class="l" href="#1387">1387: </a>        
</span><span id="1388" class="l"><a class="l" href="#1388">1388: </a>        <span class="php-var">$table</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'MarkupAdminDataTable'</span>); 
</span><span id="1389" class="l"><a class="l" href="#1389">1389: </a>        <span class="php-var">$table</span>-&gt;setEncodeEntities(<span class="php-keyword1">false</span>);
</span><span id="1390" class="l"><a class="l" href="#1390">1390: </a>        <span class="php-var">$table</span>-&gt;headerRow(<span class="php-keyword1">array</span>(
</span><span id="1391" class="l"><a class="l" href="#1391">1391: </a>            <span class="php-quote">'#'</span>, 
</span><span id="1392" class="l"><a class="l" href="#1392">1392: </a>            <span class="php-var">$this</span>-&gt;_x(<span class="php-quote">'Image'</span>, <span class="php-quote">'th'</span>), 
</span><span id="1393" class="l"><a class="l" href="#1393">1393: </a>            <span class="php-var">$this</span>-&gt;_x(<span class="php-quote">'File'</span>, <span class="php-quote">'th'</span>),
</span><span id="1394" class="l"><a class="l" href="#1394">1394: </a>            <span class="php-var">$this</span>-&gt;_x(<span class="php-quote">'Size'</span>, <span class="php-quote">'th'</span>),
</span><span id="1395" class="l"><a class="l" href="#1395">1395: </a>            <span class="php-var">$this</span>-&gt;_x(<span class="php-quote">'Modified'</span>, <span class="php-quote">'th'</span>),  
</span><span id="1396" class="l"><a class="l" href="#1396">1396: </a>            <span class="php-var">$this</span>-&gt;_x(<span class="php-quote">'Notes'</span>, <span class="php-quote">'th'</span>),
</span><span id="1397" class="l"><a class="l" href="#1397">1397: </a>            (<span class="php-var">$hasEditPermission</span> ? <span class="php-quote">&quot;&lt;label&gt;&lt;input type='checkbox' id='delete_all' value='1' /&gt;&lt;/label&gt;&quot;</span> : <span class="php-quote">&quot;&amp;nbsp;&quot;</span>)
</span><span id="1398" class="l"><a class="l" href="#1398">1398: </a>        ));
</span><span id="1399" class="l"><a class="l" href="#1399">1399: </a>        
</span><span id="1400" class="l"><a class="l" href="#1400">1400: </a>        <span class="php-var">$cnt</span> = <span class="php-num">0</span>;
</span><span id="1401" class="l"><a class="l" href="#1401">1401: </a>        
</span><span id="1402" class="l"><a class="l" href="#1402">1402: </a>        <span class="php-keyword1">foreach</span>(<span class="php-var">$variations</span> <span class="php-keyword1">as</span> <span class="php-var">$name</span> =&gt; <span class="php-var">$info</span>) {
</span><span id="1403" class="l"><a class="l" href="#1403">1403: </a>            
</span><span id="1404" class="l"><a class="l" href="#1404">1404: </a>            <span class="php-var">$notes</span> = <span class="php-keyword1">array</span>();
</span><span id="1405" class="l"><a class="l" href="#1405">1405: </a>            <span class="php-keyword1">if</span>(<span class="php-keyword2">in_array</span>(<span class="php-quote">'is'</span>, <span class="php-var">$info</span>[<span class="php-quote">'suffix'</span>])) <span class="php-var">$notes</span>[] = <span class="php-var">$this</span>-&gt;_x(<span class="php-quote">'Created for placement in textarea'</span>, <span class="php-quote">'notes'</span>); 
</span><span id="1406" class="l"><a class="l" href="#1406">1406: </a>            <span class="php-keyword1">if</span>(<span class="php-keyword2">in_array</span>(<span class="php-quote">'hidpi'</span>, <span class="php-var">$info</span>[<span class="php-quote">'suffix'</span>])) <span class="php-var">$notes</span>[] = <span class="php-var">$this</span>-&gt;_x(<span class="php-quote">'HiDPI/Retina'</span>, <span class="php-quote">'notes'</span>); 
</span><span id="1407" class="l"><a class="l" href="#1407">1407: </a>            <span class="php-keyword1">if</span>(!<span class="php-keyword2">count</span>(<span class="php-var">$notes</span>) &amp;&amp; <span class="php-var">$info</span>[<span class="php-quote">'width'</span>] == <span class="php-var">$adminThumbOptions</span>[<span class="php-quote">'width'</span>] &amp;&amp; <span class="php-var">$info</span>[<span class="php-quote">'height'</span>] == <span class="php-var">$adminThumbOptions</span>[<span class="php-quote">'height'</span>]) {
</span><span id="1408" class="l"><a class="l" href="#1408">1408: </a>                <span class="php-var">$notes</span>[] = <span class="php-var">$this</span>-&gt;_x(<span class="php-quote">'Auto-generated admin thumbnail'</span>, <span class="php-quote">'notes'</span>); 
</span><span id="1409" class="l"><a class="l" href="#1409">1409: </a>            }
</span><span id="1410" class="l"><a class="l" href="#1410">1410: </a>            <span class="php-keyword1">if</span>(!<span class="php-keyword2">count</span>(<span class="php-var">$notes</span>)) <span class="php-var">$notes</span>[] = <span class="php-var">$this</span>-&gt;_x(<span class="php-quote">'API-generated variation'</span>, <span class="php-quote">'notes'</span>);
</span><span id="1411" class="l"><a class="l" href="#1411">1411: </a>            <span class="php-keyword1">if</span>(<span class="php-var">$info</span>[<span class="php-quote">'crop'</span>]) <span class="php-var">$notes</span>[] = <span class="php-var">$this</span>-&gt;_x(<span class="php-quote">'Cropped version'</span>, <span class="php-quote">'notes'</span>);
</span><span id="1412" class="l"><a class="l" href="#1412">1412: </a>        
</span><span id="1413" class="l"><a class="l" href="#1413">1413: </a>            <span class="php-comment">// identify pid suffixes</span>
</span><span id="1414" class="l"><a class="l" href="#1414">1414: </a>            <span class="php-keyword1">foreach</span>(<span class="php-var">$info</span>[<span class="php-quote">'suffix'</span>] <span class="php-keyword1">as</span> <span class="php-var">$suffix</span>) {
</span><span id="1415" class="l"><a class="l" href="#1415">1415: </a>                <span class="php-keyword1">if</span>(<span class="php-keyword2">strpos</span>(<span class="php-var">$suffix</span>, <span class="php-quote">'pid'</span>) === <span class="php-num">0</span>) {
</span><span id="1416" class="l"><a class="l" href="#1416">1416: </a>                    <span class="php-var">$suffix</span> = <span class="php-keyword2">ltrim</span>(<span class="php-var">$suffix</span>, <span class="php-quote">'pid'</span>);
</span><span id="1417" class="l"><a class="l" href="#1417">1417: </a>                    <span class="php-var">$refpage</span> = <span class="php-keyword1">null</span>;
</span><span id="1418" class="l"><a class="l" href="#1418">1418: </a>                    <span class="php-keyword1">if</span>(<span class="php-keyword2">ctype_digit</span>(<span class="php-var">$suffix</span>)) <span class="php-var">$refpage</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'pages'</span>)-&gt;get((int) <span class="php-var">$suffix</span>);
</span><span id="1419" class="l"><a class="l" href="#1419">1419: </a>                    <span class="php-keyword1">if</span>(<span class="php-var">$refpage</span> &amp;&amp; <span class="php-var">$refpage</span>-&gt;id &amp;&amp; <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'user'</span>)-&gt;hasPermission(<span class="php-quote">'page-view'</span>, <span class="php-var">$refpage</span>)) {
</span><span id="1420" class="l"><a class="l" href="#1420">1420: </a>                        <span class="php-var">$notes</span>[] = <span class="php-var">$this</span>-&gt;_x(<span class="php-quote">'Inserted from page:'</span>, <span class="php-quote">'notes'</span>) . <span class="php-quote">&quot; &lt;a target='_blank' href='</span><span class="php-var">$refpage</span><span class="php-quote">-&gt;url'&gt;</span><span class="php-var">$refpage</span><span class="php-quote">-&gt;path&lt;/a&gt;&quot;</span>;
</span><span id="1421" class="l"><a class="l" href="#1421">1421: </a>                    }
</span><span id="1422" class="l"><a class="l" href="#1422">1422: </a>                }
</span><span id="1423" class="l"><a class="l" href="#1423">1423: </a>            }
</span><span id="1424" class="l"><a class="l" href="#1424">1424: </a>        
</span><span id="1425" class="l"><a class="l" href="#1425">1425: </a>            <span class="php-var">$width</span> = (int) <span class="php-var">$info</span>[<span class="php-quote">'width'</span>];
</span><span id="1426" class="l"><a class="l" href="#1426">1426: </a>            <span class="php-var">$height</span> = (int) <span class="php-var">$info</span>[<span class="php-quote">'height'</span>];
</span><span id="1427" class="l"><a class="l" href="#1427">1427: </a>            <span class="php-keyword1">if</span>(!<span class="php-var">$width</span> || !<span class="php-var">$height</span>) <span class="php-keyword1">list</span>(<span class="php-var">$width</span>, <span class="php-var">$height</span>) = <span class="php-keyword2">getimagesize</span>(<span class="php-var">$info</span>[<span class="php-quote">'path'</span>]);
</span><span id="1428" class="l"><a class="l" href="#1428">1428: </a>            <span class="php-comment">// $dimensions = $width . 'x' . $height; </span>
</span><span id="1429" class="l"><a class="l" href="#1429">1429: </a>            <span class="php-comment">// if(in_array('hidpi', $info['suffix'])) $dimensions .= &quot; ($info[hidpiWidth]x$info[hidpiHeight] {$this-&gt;labels['hidpi']})&quot;;</span>
</span><span id="1430" class="l"><a class="l" href="#1430">1430: </a>            <span class="php-var">$filesize</span> = <span class="php-keyword2">filesize</span>(<span class="php-var">$info</span>[<span class="php-quote">'path'</span>]); 
</span><span id="1431" class="l"><a class="l" href="#1431">1431: </a>            <span class="php-var">$filesizeStr</span> = wireBytesStr(<span class="php-var">$filesize</span>);
</span><span id="1432" class="l"><a class="l" href="#1432">1432: </a>            <span class="php-var">$mtime</span> = <span class="php-keyword2">filemtime</span>(<span class="php-var">$info</span>[<span class="php-quote">'path'</span>]); 
</span><span id="1433" class="l"><a class="l" href="#1433">1433: </a>            <span class="php-var">$modified</span> = <span class="php-keyword2">date</span>(<span class="php-quote">'Y-m-d H:i:s'</span>, <span class="php-var">$mtime</span>); 
</span><span id="1434" class="l"><a class="l" href="#1434">1434: </a>            <span class="php-var">$url</span> = <span class="php-quote">&quot;</span><span class="php-var">$info</span><span class="php-quote">[url]?nc=</span><span class="php-var">$mtime</span><span class="php-quote">&quot;</span>;
</span><span id="1435" class="l"><a class="l" href="#1435">1435: </a>            
</span><span id="1436" class="l"><a class="l" href="#1436">1436: </a>            <span class="php-var">$table</span>-&gt;row(<span class="php-keyword1">array</span>(
</span><span id="1437" class="l"><a class="l" href="#1437">1437: </a>                ++<span class="php-var">$cnt</span>, 
</span><span id="1438" class="l"><a class="l" href="#1438">1438: </a>                <span class="php-quote">&quot;&lt;a class='preview' href='</span><span class="php-var">$url</span><span class="php-quote">'&gt;&lt;img src='</span><span class="php-var">$url</span><span class="php-quote">' alt='</span><span class="php-var">$name</span><span class="php-quote">' style='max-width: 100px;' /&gt;&lt;/a&gt;&quot;</span>,
</span><span id="1439" class="l"><a class="l" href="#1439">1439: </a>                <span class="php-quote">&quot;&lt;a class='preview' href='</span><span class="php-var">$url</span><span class="php-quote">'&gt;</span><span class="php-var">$name</span><span class="php-quote">&lt;/a&gt;&lt;br /&gt;&lt;span class='detail'&gt;</span><span class="php-var">{$width}</span><span class="php-quote">x</span><span class="php-var">{$height}</span><span class="php-quote">&lt;/span&gt;&quot;</span>, 
</span><span id="1440" class="l"><a class="l" href="#1440">1440: </a>                <span class="php-quote">&quot;&lt;span style='display: none;'&gt;</span><span class="php-var">$filesize</span><span class="php-quote">&lt;/span&gt;</span><span class="php-var">$filesizeStr</span><span class="php-quote">&quot;</span>, 
</span><span id="1441" class="l"><a class="l" href="#1441">1441: </a>                <span class="php-var">$modified</span>, 
</span><span id="1442" class="l"><a class="l" href="#1442">1442: </a>                <span class="php-keyword2">implode</span>(<span class="php-quote">'&lt;br /&gt;'</span>, <span class="php-var">$notes</span>),
</span><span id="1443" class="l"><a class="l" href="#1443">1443: </a>                (<span class="php-var">$hasEditPermission</span> ? <span class="php-quote">&quot;&lt;label&gt;&lt;input type='checkbox' class='delete' name='delete[]' value='</span><span class="php-var">$name</span><span class="php-quote">' /&gt; &amp;nbsp;&lt;/label&gt;&quot;</span> : <span class="php-quote">&quot;&amp;nbsp;&quot;</span>)
</span><span id="1444" class="l"><a class="l" href="#1444">1444: </a>            ));
</span><span id="1445" class="l"><a class="l" href="#1445">1445: </a>        }
</span><span id="1446" class="l"><a class="l" href="#1446">1446: </a>        
</span><span id="1447" class="l"><a class="l" href="#1447">1447: </a>        <span class="php-var">$varcnt</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'sanitizer'</span>)-&gt;entities(<span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'input'</span>)-&gt;get(<span class="php-quote">'varcnt'</span>)); 
</span><span id="1448" class="l"><a class="l" href="#1448">1448: </a>
</span><span id="1449" class="l"><a class="l" href="#1449">1449: </a>        <span class="php-var">$form</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldForm'</span>);
</span><span id="1450" class="l"><a class="l" href="#1450">1450: </a>        <span class="php-var">$form</span>-&gt;attr(<span class="php-quote">'id'</span>, <span class="php-quote">'ImageVariations'</span>); 
</span><span id="1451" class="l"><a class="l" href="#1451">1451: </a>        <span class="php-var">$form</span>-&gt;action = <span class="php-quote">&quot;./?id=</span><span class="php-var">{$this-&gt;page-&gt;id}</span><span class="php-quote">&amp;file=</span><span class="php-var">$pageimage</span><span class="php-quote">-&gt;basename&amp;varcnt=</span><span class="php-var">$varcnt</span><span class="php-quote">&quot;</span>;
</span><span id="1452" class="l"><a class="l" href="#1452">1452: </a>        <span class="php-var">$form</span>-&gt;prependMarkup = <span class="php-var">$table</span>-&gt;render();
</span><span id="1453" class="l"><a class="l" href="#1453">1453: </a>
</span><span id="1454" class="l"><a class="l" href="#1454">1454: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$hasEditPermission</span>) {
</span><span id="1455" class="l"><a class="l" href="#1455">1455: </a>            <span class="php-var">$submit</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldSubmit'</span>);
</span><span id="1456" class="l"><a class="l" href="#1456">1456: </a>            <span class="php-var">$submit</span>-&gt;attr(<span class="php-quote">'value'</span>, <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Delete Checked'</span>));
</span><span id="1457" class="l"><a class="l" href="#1457">1457: </a>            <span class="php-var">$submit</span>-&gt;addClass(<span class="php-quote">'delete-checked'</span>);
</span><span id="1458" class="l"><a class="l" href="#1458">1458: </a>            <span class="php-var">$submit</span>-&gt;icon = <span class="php-quote">'trash'</span>;
</span><span id="1459" class="l"><a class="l" href="#1459">1459: </a>            <span class="php-var">$form</span>-&gt;add(<span class="php-var">$submit</span>);
</span><span id="1460" class="l"><a class="l" href="#1460">1460: </a>        }
</span><span id="1461" class="l"><a class="l" href="#1461">1461: </a>        
</span><span id="1462" class="l"><a class="l" href="#1462">1462: </a>        <span class="php-var">$button</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldButton'</span>); 
</span><span id="1463" class="l"><a class="l" href="#1463">1463: </a>        <span class="php-var">$button</span>-&gt;attr(<span class="php-quote">'value'</span>, <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Close'</span>)); 
</span><span id="1464" class="l"><a class="l" href="#1464">1464: </a>        <span class="php-var">$button</span>-&gt;addClass(<span class="php-quote">'pw-modal-cancel'</span>); 
</span><span id="1465" class="l"><a class="l" href="#1465">1465: </a>        <span class="php-var">$button</span>-&gt;icon = <span class="php-quote">'times-circle'</span>;
</span><span id="1466" class="l"><a class="l" href="#1466">1466: </a>        <span class="php-var">$form</span>-&gt;add(<span class="php-var">$button</span>); 
</span><span id="1467" class="l"><a class="l" href="#1467">1467: </a>        
</span><span id="1468" class="l"><a class="l" href="#1468">1468: </a>        <span class="php-var">$hidden</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldHidden'</span>);
</span><span id="1469" class="l"><a class="l" href="#1469">1469: </a>        <span class="php-var">$hidden</span>-&gt;attr(<span class="php-quote">'id+name'</span>, <span class="php-quote">'varcnt_id'</span>); 
</span><span id="1470" class="l"><a class="l" href="#1470">1470: </a>        <span class="php-var">$hidden</span>-&gt;attr(<span class="php-quote">'value'</span>, <span class="php-var">$varcnt</span>); 
</span><span id="1471" class="l"><a class="l" href="#1471">1471: </a>        <span class="php-var">$hidden</span>-&gt;attr(<span class="php-quote">'data-cnt'</span>, <span class="php-keyword2">count</span>(<span class="php-var">$variations</span>)); 
</span><span id="1472" class="l"><a class="l" href="#1472">1472: </a>        <span class="php-var">$form</span>-&gt;add(<span class="php-var">$hidden</span>); 
</span><span id="1473" class="l"><a class="l" href="#1473">1473: </a>        
</span><span id="1474" class="l"><a class="l" href="#1474">1474: </a>        <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'JqueryMagnific'</span>); 
</span><span id="1475" class="l"><a class="l" href="#1475">1475: </a>        
</span><span id="1476" class="l"><a class="l" href="#1476">1476: </a>        <span class="php-var">$out</span> = <span class="php-var">$form</span>-&gt;render(); 
</span><span id="1477" class="l"><a class="l" href="#1477">1477: </a>        
</span><span id="1478" class="l"><a class="l" href="#1478">1478: </a>        <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'config'</span>)-&gt;demo) {
</span><span id="1479" class="l"><a class="l" href="#1479">1479: </a>            <span class="php-var">$out</span> = <span class="php-quote">&quot;&lt;p class='detail'&gt;Note: &quot;</span> . <span class="php-var">$this</span>-&gt;labels[<span class="php-quote">'demoMode'</span>] . <span class="php-quote">&quot;&lt;/p&gt;&quot;</span> . <span class="php-var">$out</span>;
</span><span id="1480" class="l"><a class="l" href="#1480">1480: </a>        } <span class="php-keyword1">else</span> {
</span><span id="1481" class="l"><a class="l" href="#1481">1481: </a>            <span class="php-var">$out</span> = <span class="php-quote">&quot;&lt;br /&gt;&quot;</span> . <span class="php-var">$out</span>;
</span><span id="1482" class="l"><a class="l" href="#1482">1482: </a>        }
</span><span id="1483" class="l"><a class="l" href="#1483">1483: </a>        
</span><span id="1484" class="l"><a class="l" href="#1484">1484: </a>        <span class="php-keyword1">return</span> <span class="php-var">$out</span>; 
</span><span id="1485" class="l"><a class="l" href="#1485">1485: </a>        
</span><span id="1486" class="l"><a class="l" href="#1486">1486: </a>    }
</span><span id="1487" class="l"><a class="l" href="#1487">1487: </a>
</span><span id="1488" class="l"><a class="l" href="#1488">1488: </a>    <span class="php-comment">/**
</span></span><span id="1489" class="l"><a class="l" href="#1489">1489: </a><span class="php-comment">     * Module configuration
</span></span><span id="1490" class="l"><a class="l" href="#1490">1490: </a><span class="php-comment">     * 
</span></span><span id="1491" class="l"><a class="l" href="#1491">1491: </a><span class="php-comment">     * @param array $data
</span></span><span id="1492" class="l"><a class="l" href="#1492">1492: </a><span class="php-comment">     * @return InputfieldWrapper
</span></span><span id="1493" class="l"><a class="l" href="#1493">1493: </a><span class="php-comment">     * 
</span></span><span id="1494" class="l"><a class="l" href="#1494">1494: </a><span class="php-comment">     */</span>
</span><span id="1495" class="l"><a class="l" href="#1495">1495: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_getModuleConfigInputfields" href="#_getModuleConfigInputfields">getModuleConfigInputfields</a>(<span class="php-keyword1">array</span> <span class="php-var">$data</span>) {
</span><span id="1496" class="l"><a class="l" href="#1496">1496: </a>        <span class="php-var">$inputfields</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-keyword1">new</span> InputfieldWrapper());
</span><span id="1497" class="l"><a class="l" href="#1497">1497: </a>        <span class="php-var">$data</span> = <span class="php-keyword2">array_merge</span>(self::<span class="php-var">$defaultConfig</span>, <span class="php-var">$data</span>); 
</span><span id="1498" class="l"><a class="l" href="#1498">1498: </a>        
</span><span id="1499" class="l"><a class="l" href="#1499">1499: </a>        <span class="php-var">$f</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldCheckbox'</span>); 
</span><span id="1500" class="l"><a class="l" href="#1500">1500: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'name'</span>, <span class="php-quote">'hidpiDefault'</span>); 
</span><span id="1501" class="l"><a class="l" href="#1501">1501: </a>        <span class="php-var">$f</span>-&gt;label = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'HiDPI/Retina checkbox default checked?'</span>); 
</span><span id="1502" class="l"><a class="l" href="#1502">1502: </a>        <span class="php-var">$f</span>-&gt;description = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Check this box to have the HiDPI/Retina checkbox checked by default for newly inserted images.'</span>); 
</span><span id="1503" class="l"><a class="l" href="#1503">1503: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword1">empty</span>(<span class="php-var">$data</span>[<span class="php-quote">'hidpiDefault'</span>])) <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'checked'</span>, <span class="php-quote">'checked'</span>); 
</span><span id="1504" class="l"><a class="l" href="#1504">1504: </a>        <span class="php-var">$f</span>-&gt;columnWidth = <span class="php-num">50</span>;
</span><span id="1505" class="l"><a class="l" href="#1505">1505: </a>        <span class="php-var">$inputfields</span>-&gt;add(<span class="php-var">$f</span>); 
</span><span id="1506" class="l"><a class="l" href="#1506">1506: </a>        
</span><span id="1507" class="l"><a class="l" href="#1507">1507: </a>        <span class="php-var">$f</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldCheckbox'</span>); 
</span><span id="1508" class="l"><a class="l" href="#1508">1508: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'name'</span>, <span class="php-quote">'noThumbs'</span>); 
</span><span id="1509" class="l"><a class="l" href="#1509">1509: </a>        <span class="php-var">$f</span>-&gt;label = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Do not generate thumbnail images'</span>); 
</span><span id="1510" class="l"><a class="l" href="#1510">1510: </a>        <span class="php-var">$f</span>-&gt;description = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'When checked, image selection will use full-size images rather than thumbnail images.'</span>); 
</span><span id="1511" class="l"><a class="l" href="#1511">1511: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword1">empty</span>(<span class="php-var">$data</span>[<span class="php-quote">'noThumbs'</span>])) <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'checked'</span>, <span class="php-quote">'checked'</span>);
</span><span id="1512" class="l"><a class="l" href="#1512">1512: </a>        <span class="php-var">$f</span>-&gt;columnWidth = <span class="php-num">50</span>;
</span><span id="1513" class="l"><a class="l" href="#1513">1513: </a>        <span class="php-var">$inputfields</span>-&gt;add(<span class="php-var">$f</span>); 
</span><span id="1514" class="l"><a class="l" href="#1514">1514: </a>
</span><span id="1515" class="l"><a class="l" href="#1515">1515: </a>        <span class="php-var">$f</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldText'</span>); 
</span><span id="1516" class="l"><a class="l" href="#1516">1516: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'name'</span>, <span class="php-quote">'skipFields'</span>); 
</span><span id="1517" class="l"><a class="l" href="#1517">1517: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'value'</span>, <span class="php-keyword1">isset</span>(<span class="php-var">$data</span>[<span class="php-quote">'skipFields'</span>]) ? <span class="php-var">$data</span>[<span class="php-quote">'skipFields'</span>] : <span class="php-quote">''</span>); 
</span><span id="1518" class="l"><a class="l" href="#1518">1518: </a>        <span class="php-var">$f</span>-&gt;label = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Field names to skip for selection'</span>); 
</span><span id="1519" class="l"><a class="l" href="#1519">1519: </a>        <span class="php-var">$f</span>-&gt;description = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Enter the names of any image fields (separated by a space) that you do not want to allow for selection with this module.'</span>); 
</span><span id="1520" class="l"><a class="l" href="#1520">1520: </a>        <span class="php-var">$inputfields</span>-&gt;add(<span class="php-var">$f</span>); 
</span><span id="1521" class="l"><a class="l" href="#1521">1521: </a>
</span><span id="1522" class="l"><a class="l" href="#1522">1522: </a>        <span class="php-var">$f</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldCheckbox'</span>);
</span><span id="1523" class="l"><a class="l" href="#1523">1523: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'name'</span>, <span class="php-quote">'noSizeAttrs'</span>); 
</span><span id="1524" class="l"><a class="l" href="#1524">1524: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'value'</span>, <span class="php-num">1</span>);
</span><span id="1525" class="l"><a class="l" href="#1525">1525: </a>        <span class="php-keyword1">if</span>(!<span class="php-keyword1">empty</span>(<span class="php-var">$data</span>[<span class="php-quote">'noSizeAttrs'</span>])) <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'checked'</span>, <span class="php-quote">'checked'</span>);
</span><span id="1526" class="l"><a class="l" href="#1526">1526: </a>        <span class="php-var">$f</span>-&gt;label = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Skip width attributes on image tags?'</span>); <span class="php-comment">// noSizeAttr label</span>
</span><span id="1527" class="l"><a class="l" href="#1527">1527: </a>        <span class="php-var">$f</span>-&gt;description = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'By default, this module will include width attributes in the img tag. If you are using responsive images, you might want to disable this behavior. Check the box to disable width and height attributes.'</span>); <span class="php-comment">// noSizeAttr description</span>
</span><span id="1528" class="l"><a class="l" href="#1528">1528: </a>        <span class="php-var">$f</span>-&gt;notes = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'We do not recommend checking this box as it will interfere with some features (like use of HiDPI/retina images).'</span>); 
</span><span id="1529" class="l"><a class="l" href="#1529">1529: </a>        <span class="php-var">$inputfields</span>-&gt;add(<span class="php-var">$f</span>);
</span><span id="1530" class="l"><a class="l" href="#1530">1530: </a>
</span><span id="1531" class="l"><a class="l" href="#1531">1531: </a>        <span class="php-var">$notes</span> = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Recommended value:'</span>) . <span class="php-quote">' '</span>;
</span><span id="1532" class="l"><a class="l" href="#1532">1532: </a>        <span class="php-var">$f</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldText'</span>); 
</span><span id="1533" class="l"><a class="l" href="#1533">1533: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'name'</span>, <span class="php-quote">'alignLeftClass'</span>);
</span><span id="1534" class="l"><a class="l" href="#1534">1534: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'value'</span>, <span class="php-var">$data</span>[<span class="php-quote">'alignLeftClass'</span>]); 
</span><span id="1535" class="l"><a class="l" href="#1535">1535: </a>        <span class="php-var">$f</span>-&gt;label = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Align Image Left Class'</span>); 
</span><span id="1536" class="l"><a class="l" href="#1536">1536: </a>        <span class="php-var">$f</span>-&gt;notes = <span class="php-var">$notes</span> . <span class="php-quote">'**align_left**'</span>;
</span><span id="1537" class="l"><a class="l" href="#1537">1537: </a>        <span class="php-var">$f</span>-&gt;columnWidth = <span class="php-num">33</span>; 
</span><span id="1538" class="l"><a class="l" href="#1538">1538: </a>        <span class="php-var">$inputfields</span>-&gt;add(<span class="php-var">$f</span>);
</span><span id="1539" class="l"><a class="l" href="#1539">1539: </a>        
</span><span id="1540" class="l"><a class="l" href="#1540">1540: </a>        <span class="php-var">$f</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldText'</span>); 
</span><span id="1541" class="l"><a class="l" href="#1541">1541: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'name'</span>, <span class="php-quote">'alignCenterClass'</span>);
</span><span id="1542" class="l"><a class="l" href="#1542">1542: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'value'</span>, <span class="php-var">$data</span>[<span class="php-quote">'alignCenterClass'</span>]); 
</span><span id="1543" class="l"><a class="l" href="#1543">1543: </a>        <span class="php-var">$f</span>-&gt;label = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Align Image Center Class'</span>);
</span><span id="1544" class="l"><a class="l" href="#1544">1544: </a>        <span class="php-var">$f</span>-&gt;notes = <span class="php-var">$notes</span> . <span class="php-quote">'**align_center**'</span>;
</span><span id="1545" class="l"><a class="l" href="#1545">1545: </a>        <span class="php-var">$f</span>-&gt;columnWidth = <span class="php-num">34</span>; 
</span><span id="1546" class="l"><a class="l" href="#1546">1546: </a>        <span class="php-var">$inputfields</span>-&gt;add(<span class="php-var">$f</span>);
</span><span id="1547" class="l"><a class="l" href="#1547">1547: </a>        
</span><span id="1548" class="l"><a class="l" href="#1548">1548: </a>        <span class="php-var">$f</span> = <span class="php-var">$this</span>-&gt;wire(<span class="php-quote">'modules'</span>)-&gt;get(<span class="php-quote">'InputfieldText'</span>);
</span><span id="1549" class="l"><a class="l" href="#1549">1549: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'name'</span>, <span class="php-quote">'alignRightClass'</span>);
</span><span id="1550" class="l"><a class="l" href="#1550">1550: </a>        <span class="php-var">$f</span>-&gt;attr(<span class="php-quote">'value'</span>, <span class="php-var">$data</span>[<span class="php-quote">'alignRightClass'</span>]);
</span><span id="1551" class="l"><a class="l" href="#1551">1551: </a>        <span class="php-var">$f</span>-&gt;label = <span class="php-var">$this</span>-&gt;_(<span class="php-quote">'Align Image Right Class'</span>);
</span><span id="1552" class="l"><a class="l" href="#1552">1552: </a>        <span class="php-var">$f</span>-&gt;notes = <span class="php-var">$notes</span> . <span class="php-quote">'**align_right**'</span>;
</span><span id="1553" class="l"><a class="l" href="#1553">1553: </a>        <span class="php-var">$f</span>-&gt;columnWidth = <span class="php-num">33</span>;
</span><span id="1554" class="l"><a class="l" href="#1554">1554: </a>        <span class="php-var">$inputfields</span>-&gt;add(<span class="php-var">$f</span>);
</span><span id="1555" class="l"><a class="l" href="#1555">1555: </a>
</span><span id="1556" class="l"><a class="l" href="#1556">1556: </a>        <span class="php-keyword1">return</span> <span class="php-var">$inputfields</span>;
</span><span id="1557" class="l"><a class="l" href="#1557">1557: </a>    }
</span><span id="1558" class="l"><a class="l" href="#1558">1558: </a>
</span><span id="1559" class="l"><a class="l" href="#1559">1559: </a>}
</span><span id="1560" class="l"><a class="l" href="#1560">1560: </a>
</span><span id="1561" class="l"><a class="l" href="#1561">1561: </a></span></code></pre>

	<div id="footer">
		ProcessWire 3 API (master branch) API documentation generated by <a href="http://apigen.org">ApiGen 2.8.0</a>
	</div>
</div>
</div>
</body>
</html>
